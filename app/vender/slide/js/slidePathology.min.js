/**
 * Pathology - 1.0.0
 * @email v
 * @author 
 */

function AjxResult(e,t){this.resultCode="undefined"!=typeof e?e:ResultType.Success,this.Info="undefined"!=typeof t?t:null}window.Slide||(window.Slide={});var Slide=window.Slide,SlideBrowser=Slide.Browser={UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},SlideUtils=Slide.Utils=function(){function e(e,t){return t&&e!==document.body?document.body:e.offsetParent}var t=this,i=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"],n={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},o=SlideBrowser.UNKNOWN,a=0,r=!1,l={};!function(){var e=navigator.appName,t=navigator.appVersion,i=navigator.userAgent;if("Microsoft Internet Explorer"===e&&window.attachEvent&&window.ActiveXObject){var n=i.indexOf("MSIE");o=SlideBrowser.IE,a=parseFloat(i.substring(n+5,i.indexOf(";",n)));var s=document.documentMode;"undefined"!=typeof s&&(a=s)}else if("Netscape"===e&&window.addEventListener){var d=i.indexOf("Firefox"),u=i.indexOf("Safari"),c=i.indexOf("Chrome");if(d>=0)o=SlideBrowser.FIREFOX,a=parseFloat(i.substring(d+8));else if(u>=0){var h=i.substring(0,u).lastIndexOf("/");o=c>=0?SlideBrowser.CHROME:SlideBrowser.SAFARI,a=parseFloat(i.substring(h+1,u))}else"Opera"===e&&window.opera&&window.attachEvent&&(o=SlideBrowser.OPERA,a=parseFloat(t));for(var f=window.location.search.substring(1),p=f.split("&"),g=0;g<p.length;g++){var v=p[g],m=v.indexOf("=");m>0&&(l[v.substring(0,m)]=decodeURIComponent(v.substring(m+1)))}r=o===SlideBrowser.IE&&a<9||o===SlideBrowser.CHROME&&a<2}}(),this.getBrowser=function(){return o},this.getBrowserVersion=function(){return a},this.getElement=function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},this.getElementPosition=function(i){i=t.getElement(i);for(var n="fixed"===t.getElementStyle(i).position,o=e(i,n),a=new SlidePoint;o;)a.x+=i.offsetLeft,a.y+=i.offsetTop,n&&(a=a.plus(t.getPageScroll())),i=o,n="fixed"===t.getElementStyle(i).position,o=e(i,n);return a},this.getElementSize=function(e){return e=t.getElement(e),new SlidePoint(e.clientWidth,e.clientHeight)},this.getElementStyle=function(e){return e=t.getElement(e),e.currentStyle?e.currentStyle:window.getComputedStyle?window.getComputedStyle(e,""):void SlideDebug.fail("Unknown element style, no known technique.")},this.getEvent=function(e){return e?e:window.event},this.getMousePosition=function(e){e=t.getEvent(e);var i=new SlidePoint;return"DOMMouseScroll"===e.type&&o===SlideBrowser.FIREFOX&&a<3?(i.x=e.screenX,i.y=e.screenY):"number"==typeof e.pageX?(i.x=e.pageX,i.y=e.pageY):"number"==typeof e.clientX?(i.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop):SlideDebug.fail("Unknown event mouse position, no known technique."),i},this.getMouseScroll=function(e){e=t.getEvent(e);var i=0;return"number"==typeof e.wheelDelta?i=e.wheelDelta:"number"==typeof e.detail?i=1*e.detail:SlideDebug.fail("Unknown event mouse scroll, no known technique."),i?i/Math.abs(i):0},this.getPageScroll=function(){var e=new SlidePoint,t=document.body||{},i=document.documentElement||{};return"number"==typeof window.pageXOffset?(e.x=window.pageXOffset,e.y=window.pageYOffset):t.scrollLeft||t.scrollTop?(e.x=t.scrollLeft,e.y=t.scrollTop):i.scrollLeft||i.scrollTop?(e.x=i.scrollLeft,e.y=i.scrollTop):SlideDebug.fail("Unknown page scroll, no known technique."),e},this.getWindowSize=function(){var e=new SlidePoint,t=document.body||{},i=document.documentElement||{};return"number"==typeof window.innerWidth?(e.x=window.innerWidth,e.y=window.innerHeight):i.clientWidth||i.clientHeight?(e.x=i.clientWidth,e.y=i.clientHeight):t.clientWidth||t.clientHeight?(e.x=t.clientWidth,e.y=t.clientHeight):SlideDebug.fail("Unknown window size, no known technique."),e},this.imageFormatSupported=function(e){return e=e?e:"",!!n[e.toLowerCase()]},this.makeCenteredNode=function(e){e=t.getElement(e);var i=t.makeNeutralElement("div"),n=[];n.push('<div style="display:table; height:100%; width:100%;'),n.push("border:none; margin:0px; padding:0px;"),n.push('#position:relative; overflow:hidden; text-align:left;">'),n.push('<div style="#position:absolute; #top:50%; width:100%; '),n.push("border:none; margin:0px; padding:0px;"),n.push('display:table-cell; vertical-align:middle;">'),n.push('<div style="#position:relative; #top:-50%; width:100%; '),n.push("border:none; margin:0px; padding:0px;"),n.push('text-align:center;"></div></div></div>'),i.innerHTML=n.join(""),i=i.firstChild;for(var o=i,a=i.getElementsByTagName("div");a.length>0;)o=a[0],a=o.getElementsByTagName("div");return o.appendChild(e),i},this.makeNeutralElement=function(e){var t=document.createElement(e);return t.style.margin="0px",t.style.border="none",t.style.padding="0px",t.style.position="static",t.style.background="transparent none",t},this.makeTransparentImage=function(e){var i=null,n=t.makeNeutralElement("img");return o===SlideBrowser.IE&&a<7?(i=t.makeNeutralElement("span"),i.style.display="inline-block",n.onload=function(){i.style.width=i.style.width||n.width+"px",i.style.height=i.style.height||n.height+"px",n.onload=null,n=null},n.src=e,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')"):(i=n,i.src=e),i},this.setElementOpacity=function(e,i,n){e=t.getElement(e),n&&r&&(i=Math.round(i)),i<1?e.style.opacity=i:e.style.opacity="";var o=e.style.filter||"";if(e.style.filter=o.replace(/[\s]*alpha\(.*?\)[\s]*/g,""),!(i>1)){var a=Math.round(100*i),l=" alpha(opacity="+a+") ";e.style.filter+=l}},this.addEvent=function(e,i,n,o){e=t.getElement(e),e.addEventListener?("mousewheel"===i&&e.addEventListener("DOMMouseScroll",n,o),e.addEventListener(i,n,o)):e.attachEvent?(e.attachEvent("on"+i,n),o&&e.setCapture&&e.setCapture()):SlideDebug.fail("Unable to attach event handler, no known technique.")},this.removeEvent=function(e,i,n,o){e=t.getElement(e),e.removeEventListener?("mousewheel"===i&&e.removeEventListener("DOMMouseScroll",n,o),e.removeEventListener(i,n,o)):e.detachEvent?(e.detachEvent("on"+i,n),o&&e.releaseCapture&&e.releaseCapture()):SlideDebug.fail("Unable to detach event handler, no known technique.")},this.cancelEvent=function(e){e=t.getEvent(e),e.preventDefault&&e.preventDefault(),e.cancel=!0,e.returnValue=!1},this.stopEvent=function(e){e=t.getEvent(e),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},this.createCallback=function(e,t){for(var i=[],n=2;n<arguments.length;n++)i.push(arguments[n]);return function(){for(var n=i.concat([]),o=0;o<arguments.length;o++)n.push(arguments[o]);return t.apply(e,n)}},this.getUrlParameter=function(e){var t=l[e];return t?t:null},this.iconUrl=function(e,t,i){return i=i?i:"png",[SlideConfig.imagePath,e,"_",t,".",i].join("")},this.cursorUrl=function(e){return[SlideConfig.imagePath,e,".cur"].join("")},this.setMouseCursor=function(e,i){e=t.getElement(e),e.style.cursor="url('"+i+"'), auto"},this.removeMouseCursor=function(e){e=t.getElement(e),e.style.cursor="default"},this.makeAjaxRequest=function(e,n){var o=null,a="function"==typeof n;if(a){var r=n;n=function(){window.setTimeout(t.createCallback(null,r,o),1)}}if(window.ActiveXObject)for(var l=0;l<i.length;l++)try{o=new ActiveXObject(i[l]);break}catch(e){continue}else window.XMLHttpRequest&&(o=new XMLHttpRequest);o||SlideDebug.fail("Browser doesn't support XMLHttpRequest."),SlideConfig.proxyUrl&&(e=SlideConfig.proxyUrl+e),a&&(o.onreadystatechange=function(){4===o.readyState&&(o.onreadystatechange=new Function,n())});try{o.open("GET",e,a),o.send(null)}catch(e){SlideDebug.log(e.name+" while making AJAX request: "+e.message),o.onreadystatechange=null,o=null,a&&n()}return a?null:o},this.parseXml=function(e){var t=null;if(window.ActiveXObject)try{t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e)}catch(e){SlideDebug.log(e.name+" while parsing XML (ActiveX): "+e.message)}else if(window.DOMParser)try{var i=new DOMParser;t=i.parseFromString(e,"text/xml")}catch(e){SlideDebug.log(e.name+" while parsing XML (DOMParser): "+e.message)}else SlideDebug.fail("Browser doesn't support XML DOM.");return t}};SlideUtils=Slide.Utils=new SlideUtils;var SlideExtend=Slide.Extend;!function(){function e(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?o[a.call(e)]||"object":typeof e}function t(e){return null!=e&&e===e.window}function i(t){return"function"===e(t)}function n(i){return"object"===e(i)&&!i.nodeType&&!t(i)&&!(i.constructor&&!r.call(i.constructor.prototype,"isPrototypeOf"))}var o={},a=o.toString,r=o.hasOwnProperty,l=Array.isArray;SlideExtend=Slide.Extend=function(){var e,t,o,a,r,s,d=arguments[0]||{},u=1,c=arguments.length,h=!1;for("boolean"==typeof d&&(h=d,d=arguments[u]||{},u++),"object"==typeof d||i(d)||(d={}),u===c&&(d=this,u--);u<c;u++)if(null!=(e=arguments[u]))for(t in e)o=d[t],a=e[t],d!==a&&(h&&a&&(n(a)||(r=l(a)))?(r?(r=!1,s=o&&l(o)?o:[]):s=o&&n(o)?o:{},d[t]=SlideExtend(h,s,a)):void 0!==a&&(d[t]=a));return d}}();var SlideButton=Slide.Button;!function(){var e={NORMAL:0,FOCUS:1,HOVER:2,DOWN:3,HOLD:4};SlideButton=Slide.Button=function(t){function i(t){t<=e.DOWN&&P===e.HOLD&&(y.style.visibility="hidden",P=e.DOWN),t<=e.HOVER&&P===e.DOWN&&(S.style.visibility="hidden",P=e.HOVER),t<=e.FOCUS&&P===e.HOVER&&(m.style.visibility="hidden",P=e.FOCUS),t<=e.NORMAL&&P===e.FOCUS&&(o(),P=e.NORMAL)}function n(t){t>=e.FOCUS&&P===e.NORMAL&&(a(),P=e.FOCUS),t>=e.HOVER&&P===e.FOCUS&&(m.style.visibility="",P=e.HOVER),t>=e.DOWN&&P===e.HOVER&&(S.style.visibility="",P=e.DOWN),t>=e.HOLD&&P===e.DOWN&&(y.style.visibility="",P=e.HOLD)}function o(){C=!0,T=(new Date).getTime()+b,window.setTimeout(r,b)}function a(){C=!1,SlideUtils.setElementOpacity(v,1,!0)}function r(){window.setTimeout(l,20)}function l(){if(C){var e=(new Date).getTime(),t=e-T,i=1-t/M;i=Math.min(1,i),i=Math.max(0,i),SlideUtils.setElementOpacity(v,i,!0),i>0&&r()}}function s(){f.canHold&&(p=!p),n(e.DOWN),f.onPress&&f.onPress()}function d(t,o,a,r){a&&r?(i(e.HOVER),f.onRelease&&f.onRelease()):a?i(e.FOCUS):n(e.HOVER)}function u(e,t,i,n){f.onClick&&i&&f.onClick()}function c(t,i,o,a){o?(n(e.DOWN),f.onEnter&&f.onEnter()):a&&n(e.HOVER)}function h(t,n,o,a){i(e.FOCUS),f.onExit&&o&&f.onExit()}SlideExtend(!0,this,{canHold:!1,tooltip:null,srcNormal:null,srcFocus:null,srcHover:null,srcDown:null,srcHold:null,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null},t);var f=this,p=!1,g=SlideUtils.makeTransparentImage(f.srcNormal),v=SlideUtils.makeTransparentImage(f.srcFocus),m=SlideUtils.makeTransparentImage(f.srcHover),S=SlideUtils.makeTransparentImage(f.srcDown),y=f.canHold?SlideUtils.makeTransparentImage(f.srcHold):SlideUtils.makeTransparentImage(f.srcDown),w=SlideUtils.makeNeutralElement("span"),x=new SlideMouseTracker(w),P=e.FOCUS,b=0,M=2e3,T=null,C=!1;this.elmt=w,function(){w.title=f.tooltip,w.style.position="relative",w.style.display="inline-block",w.appendChild(g),w.appendChild(v),w.appendChild(m),w.appendChild(S),w.appendChild(y);var t=v.style,n=m.style,o=S.style,a=y.style;t.position=n.position="absolute",o.position=a.position="absolute",t.top=n.top="0px",o.top=a.top="0px",t.left=n.left="0px",o.left=a.left="0px",n.visibility=o.visibility=a.visibility="hidden",SlideUtils.getBrowser()===SlideBrowser.FIREFOX&&SlideUtils.getBrowserVersion()<3&&(t.top=n.top=o.top=a.top=""),x.pressHandler=s,x.releaseHandler=d,x.clickHandler=u,x.enterHandler=c,x.exitHandler=h,x.setTracking(!0),i(e.NORMAL)}(),this.notifyEnter=function(){n(e.FOCUS)},this.notifyExit=function(){p?n(e.HOLD):i(e.NORMAL)},this.resetState=function(){p=!1,f.notifyExit()},this.setHoldState=function(){p=!0,f.notifyExit()}}}();var SlideButtonGroup=Slide.ButtonGroup;!function(){SlideButtonGroup=Slide.ButtonGroup=function(e){function t(){for(var t=0;t<e.length;t++)e[t].notifyEnter()}function i(t,i,n,o){if(!n)for(var a=0;a<e.length;a++)e[a].notifyExit()}function n(t,i,n,o){if(!o)for(var a=0;a<e.length;a++)e[a].notifyExit()}var o=SlideUtils.makeNeutralElement("span"),e=e.concat([]),a=new SlideMouseTracker(o);this.elmt=o,function(){o.style.display="inline-block";for(var r=0;r<e.length;r++)o.appendChild(e[r].elmt);a.enterHandler=t,a.exitHandler=i,a.releaseHandler=n,a.setTracking(!0)}(),this.emulateEnter=function(){t()},this.emulateExit=function(){i()}}}();var SlideConfig=Slide.Config;!function(){SlideConfig||(SlideConfig=Slide.Config={debugMode:!0,proxyUrl:null,imagePath:"../../Areas/Platform/www/Client/kit/slideKit/img/coreImg/",clickTimeThreshold:200,clickDistThreshold:5,animationTime:1.5,springStiffness:5,imageLoaderLimit:2,logarithmicZoom:!0,constrainDuringPan:!0,drawSwitchPerTime:40,zoomPerClick:2,zoomPerScroll:Math.pow(2,1/3),autoHideControls:!0,minZoomDimension:null,minZoomImageRatio:.8,maxZoomPixelRatio:2,visibilityRatio:.8,wrapHorizontal:!1,wrapVertical:!1,blendTime:.5,immediateRender:!1,alwaysBlend:!1,wrapOverlays:!1,transformOverlays:!1,showNavBtnGroup:!0,zoomPerSecond:2})}();var SlideControlAnchor=Slide.ControlAnchor,SlideControl=Slide.Control;!function(){SlideControlAnchor=Slide.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4},SlideControl=Slide.Control=function(e,t,i,n){function o(e,t,i){t===SlideControlAnchor.TOP_RIGHT||t===SlideControlAnchor.BOTTOM_RIGHT?i.insertBefore(e,i.firstChild):i.appendChild(e)}var a=SlideUtils.makeNeutralElement("span");this.viewer=e,this.elmt=t,this.anchor=i,this.container=n,this.wrapper=a,function(){a.style.display="inline-block",a.appendChild(t),i===SlideControlAnchor.NONE&&(a.style.width=a.style.height="100%"),o(a,i,n)}()};var e=SlideControl.prototype;e.destroy=function(){this.wrapper.removeChild(this.elmt),this.container.removeChild(this.wrapper)},e.isVisible=function(){return"none"!==this.wrapper.style.display},e.setVisible=function(e){this.wrapper.style.display=e?"inline-block":"none"},e.setOpacity=function(e){this.elmt[this.SIGNAL]&&SlideUtils.getBrowser()===SlideBrowser.IE?SlideUtils.setElementOpacity(this.elmt,e,!0):SlideUtils.setElementOpacity(this.wrapper,e,!0)}}();var SlideDebug=Slide.Debug=function(){this.log=function(e,t){var i=window.console||{},n=SlideConfig.debugMode;n&&i.log||n&&t&&alert(e)},this.error=function(e,t){var i=window.console||{},n=SlideConfig.debugMode;if(n&&i.error||n&&alert(e),n)throw t||new Error(e)},this.fail=function(e){throw alert(SlideStrings.getString("Errors.Failure")),new Error(e)}};SlideDebug=new SlideDebug;var SlideSource=Slide.Source;!function(){SlideSource=Slide.Source=function(e,t,i,n,o,a,r){var l=this,s=t/e;this.width=e,this.height=t,this.aspectRatio=e/t,this.dimensions=new SlidePoint(e,t),this.number=i,this.minLevel="number"==typeof a?a:0,this.maxLevel="number"==typeof r?r:Math.ceil(Math.log(Math.max(e,t))/Math.log(2)),this.tileSize=n?n:0,this.tileOverlap=o?o:0,this.getLevelScale=function(e){return 1/(1<<l.maxLevel-e)},this.getPixelRatio=function(e){var t=l.dimensions.times(l.getLevelScale(e)),i=1/t.x,n=1/t.y;return new Point(i,n)},this.getSlideBounds=function(){},this.getSlideUrl=function(e){throw new Error("Method not implemented.")},this.slideExists=function(i){return Math.abs(i%l.number)<=l.number||(this.getNumTiles=function(i){var n=l.getLevelScale(i),o=Math.ceil(n*e/l.tileSize),a=Math.ceil(n*t/l.tileSize);return new SlidePoint(o,a)},this.getTileAtPoint=function(e,t){var i,n,o=l.dimensions.times(l.getLevelScale(e)),a=t.times(o.x);return i=t.x>=0&&t.x<=1?Math.floor(a.x/l.tileSize):Math.ceil(o.x/l.tileSize)*Math.floor(a.x/o.x)+Math.floor((o.x+a.x%o.x)%o.x/l.tileSize),n=t.y>=0&&t.y<=s?Math.floor(a.y/l.tileSize):Math.ceil(o.y/l.tileSize)*Math.floor(a.y/o.y)+Math.floor((o.y+a.y%o.y)%o.y/l.tileSize),new SlidePoint(i,n)},this.getTileBounds=function(e,t,i){var n=l.dimensions.times(l.getLevelScale(e)),o=0===t?0:l.tileSize*t-l.tileOverlap,a=0===i?0:l.tileSize*i-l.tileOverlap,r=l.tileSize+(0===t?1:2)*l.tileOverlap,s=l.tileSize+(0===i?1:2)*l.tileOverlap;r=Math.min(r,n.x-o),s=Math.min(s,n.y-a);var d=1/n.x;return new SlideRect(o*d,a*d,r*d,s*d)},this.getTileUrl=function(e,t,i){throw new Error("Method not implemented.")},this.tileExists=function(e,t,i){var n=l.getNumTiles(e);return e>=l.minLevel&&e<=l.maxLevel&&t>=0&&i>=0&&t<n.x&&i<n.y},!1)},this.getNumTiles=function(i){var n=l.getLevelScale(i),o=Math.ceil(n*e/l.tileSize),a=Math.ceil(n*t/l.tileSize);return new SlidePoint(o,a)},this.getTileAtPoint=function(e,t){var i,n,o=l.dimensions.times(l.getLevelScale(e)),a=t.times(o.x);return i=t.x>=0&&t.x<=1?Math.floor(a.x/l.tileSize):Math.ceil(o.x/l.tileSize)*Math.floor(a.x/o.x)+Math.floor((o.x+a.x%o.x)%o.x/l.tileSize),n=t.y>=0&&t.y<=s?Math.floor(a.y/l.tileSize):Math.ceil(o.y/l.tileSize)*Math.floor(a.y/o.y)+Math.floor((o.y+a.y%o.y)%o.y/l.tileSize),new SlidePoint(i,n)},this.getTileBounds=function(e,t,i){var n=l.dimensions.times(l.getLevelScale(e)),o=0===t?0:l.tileSize*t-l.tileOverlap,a=0===i?0:l.tileSize*i-l.tileOverlap,r=l.tileSize+(0===t?1:2)*l.tileOverlap,s=l.tileSize+(0===i?1:2)*l.tileOverlap;r=Math.min(r,n.x-o),s=Math.min(s,n.y-a);var d=1/n.x;return new SlideRect(o*d,a*d,r*d,s*d)},this.getTileUrl=function(e,t,i){throw new Error("Method not implemented.")},this.tileExists=function(e,t,i){var n=l.getNumTiles(e);return e>=l.minLevel&&e<=l.maxLevel&&t>=0&&i>=0&&t<n.x&&i<n.y}}}();var SlideMultiDrawer=Slide.MultiDrawer;!function(){function e(e,t,i,n){this.index=e,this.bounds=t,this.exists=i,this.url=n,this.elmt=null,this.image=null,this.loaded=!1,this.loading=!1,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.visibility=null,this.beingDrawn=!1,this.lastDrawnTime=0,this.lastTouchTime=0}for(var t,i,n=100,o=SlideUtils.getBrowser(),a=SlideUtils.getBrowserVersion(),r=!!document.createElement("canvas").getContext,l=document.documentElement||{},s=l.style||{},d=!1,u=["msTransform","WebkitTransform","MozTransform"];t=u.shift();)if("undefined"!=typeof s[t]){d=!0,i=/webkit/i.test(t);break}var c="WebkitTransition",h=("undefined"!=typeof s[c],"progid:DXImageTransform.Microsoft.Matrix"),f=(new RegExp(h+"\\(.*?\\)","g"),function(){try{return o===SlideBrowser.IE&&!!document.documentElement.filters}catch(e){return!1}}(),o===SlideBrowser.SAFARI&&a<4),p=r&&!f,g=!p&&d,v=!1,m="undefined"!=typeof document.documentMode?"bicubic":"nearest-neighbor";e.prototype.toString=function(){return this.index},e.prototype.unload=function(){this.elmt&&this.elmt.parentNode&&this.elmt.parentNode.removeChild(this.elmt),this.elmt=null,this.image=null,this.loaded=!1,this.loading=!1},e.prototype.drawCanvas=function(e){if(!this.loaded)return void SlideDebug.error("图像: "+this.toString()+"还没有加载就开始绘制!");var t=this.size,i=this.position;e.globalAlpha=this.opacity,e.drawImage(this.image,i.x,i.y,t.x,t.y)},e.prototype.drawHTML=function(e){if(!this.loaded)return void SlideDebug.error("图像: "+this.toString()+"还没有加载就开始绘制!");this.elmt||(this.elmt=SlideUtils.makeNeutralElement("img"),this.elmt.src=this.url,this.style=this.elmt.style,this.style.position="absolute",this.style.msInterpolationMode=m,g&&(this.style[t+"Origin"]="0px 0px"));var n=this.elmt,o=this.image,a=this.style,r=this.position,l=this.size;if(n.parentNode!==e&&e.appendChild(n),g)a[t]=["matrix(",(l.x/o.width).toFixed(8),",0,0,",(l.y/o.height).toFixed(8),",",r.x.toFixed(8),i?",":"px,",r.y.toFixed(8),i?")":"px)"].join("");else if(v){var s=e.clientWidth,d=e.clientHeight;a.width=s+"px",a.height=d+"px",a.filter=["progid:DXImageTransform.Microsoft.Matrix(","M11=",(l.x/s).toFixed(8),",M22=",(l.y/d).toFixed(8),",Dx=",r.x.toFixed(8),",Dy=",r.y.toFixed(8),")"].join("")}else r=r.apply(Math.floor),l=l.apply(Math.ceil),a.left=r.x+"px",a.top=r.y+"px",a.width=l.x+"px",a.height=l.y+"px",SlideUtils.setElementOpacity(n,this.opacity)},SlideMultiDrawer=Slide.MultiDrawer=function(t,i,o){function a(){P=!1;var e=u,n=c,o=p,a=S;if(a){var s=a;s.beingDrawn=!1,a=null}var d=i.getContainerSize(),h=d.x,f=d.y;o?(e.width=h,e.height=f,n.clearRect(0,0,h,f)):e.innerHTML="";var v=i.getBounds(!0),m=v.getTopLeft(),w=v.getBottomRight();if((SlideConfig.wrapHorizontal||!(w.x<0||m.x>1))&&(SlideConfig.wrapVertical||!(w.y<0||m.y>g))){var x=1e3*SlideConfig.blendTime;SlideConfig.wrapHorizontal||(m.x=Math.max(m.x,0),w.x=Math.min(w.x,1)),SlideConfig.wrapVertical||(m.y=Math.max(m.y,0),w.y=Math.min(w.y,g));for(var b=null,M=(new Date).getTime(),T=i.getCenter(),C=i.pixelFromPoint(T),A=t.number-1;A>=0;A--){var s=r(A,M);if(s.exists){var E=s.bounds.getTopLeft(),U=s.bounds.getSize(),k=i.pixelFromPoint(E,!0),L=i.deltaPixelsFromPoints(U,!0),O=i.pixelFromPoint(E,!1),R=i.deltaPixelsFromPoints(U,!1),B=O.plus(R.divide(2));C.distanceTo(B);if(s.position=k,s.size=L,s.visibility=1,s.opacity=1,s.loaded){s.blendStart||(s.blendStart=M);var D=M-s.blendStart,I=0===x?1:Math.min(1,D/x);s.opacity=I,i.getSlide(!0)===A&&(S=s),D<x&&(P=!0)}else s.loading||(b=s)}}S&&(o?S.drawCanvas(n):S.drawHTML(e),S.beingDrawn=!0),b&&(l(b,M),P=!0),y=M}}function r(n,o){if(!v[n]){var a=i.getImageBounds(),r=t.slideExists(n),l=t.getSlideUrl(n);v[n]=new e(n,a,r,l)}var s=v[n];return s.lastTouchTime=o,s}function l(e,t){e.loading=f.loadImage(e.url,SlideUtils.createCallback(null,s,e,t))}function s(e,t,i){if(e.loading=!1,!x){if(!i)return void(e.exists=!1);if(!(t<w)){e.loaded=!0,e.image=i;var o=m.length;m.length>=n,m[o]=e,P=!0}}}var d=SlideUtils.getElement(o),u=SlideUtils.makeNeutralElement(p?"canvas":"div"),c=p?u.getContext("2d"):null,h=new SlideProfiler,f=new SlideImgLoader,g=t.height/t.width,v={},m=[],S=null,y=0,w=0,x=!1,P=!0;this.elmt=d,this.profiler=h,function(){u.style.width="100%",u.style.height="100%",u.style.position="absolute",u.style.textAlign="left",d.appendChild(u)}(),this.needsUpdate=function(){return P},this.idle=function(){},this.update=function(){h.beginUpdate(),x=!0,a(),x=!1,h.endUpdate()}}}();var SlideSingleDrawer=Slide.SingleDrawer,SlideSingleOverlayPlacement;!function(){function e(e,t,i,n,o,a){this.level=e,this.x=t,this.y=i,this.bounds=n,this.exists=o,this.url=a,this.elmt=null,this.image=null,this.loaded=!1,this.loading=!1,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.distance=null,this.visibility=null,this.beingDrawn=!1,this.lastDrawnTime=0,this.lastTouchTime=0}function t(e){switch(e){case SlideSingleOverlayPlacement.TOP_LEFT:return function(e,t){};case SlideSingleOverlayPlacement.TOP:return function(e,t){e.x-=t.x/2};case SlideSingleOverlayPlacement.TOP_RIGHT:return function(e,t){e.x-=t.x};case SlideSingleOverlayPlacement.RIGHT:return function(e,t){e.x-=t.x,e.y-=t.y/2};case SlideSingleOverlayPlacement.BOTTOM_RIGHT:return function(e,t){e.x-=t.x,e.y-=t.y};case SlideSingleOverlayPlacement.BOTTOM:return function(e,t){e.x-=t.x/2,e.y-=t.y};case SlideSingleOverlayPlacement.BOTTOM_LEFT:return function(e,t){e.y-=t.y};case SlideSingleOverlayPlacement.LEFT:return function(e,t){e.y-=t.y/2};case SlideSingleOverlayPlacement.CENTER:default:return function(e,t){e.x-=t.x/2,e.y-=t.y/2}}}function i(e,i,n){this.elmt=e,this.scales=i instanceof SlideRect,this.bounds=new SlideRect(i.x,i.y,i.width,i.height),this.adjust=t(i instanceof SlidePoint?n:SlideSingleOverlayPlacement.TOP_LEFT),this.position=new SlidePoint(i.x,i.y),this.size=new SlidePoint(i.width,i.height),this.style=e.style,this.naturalSize=new SlidePoint(e.clientWidth,e.clientHeight)}for(var n,o,a=100,r=.5,l=SlideUtils.getBrowser(),s=SlideUtils.getBrowserVersion(),d=(navigator.userAgent,!!document.createElement("canvas").getContext),u=document.documentElement||{},c=u.style||{},h=!1,f=["msTransform","WebkitTransform","MozTransform"];n=f.shift();)if("undefined"!=typeof c[n]){h=!0,o=/webkit/i.test(n);break}var p="WebkitTransition",g=("undefined"!=typeof c[p],"progid:DXImageTransform.Microsoft.Matrix"),v=(new RegExp(g+"\\(.*?\\)","g"),function(){try{return l==SlideBrowser.IE&&!!document.documentElement.filters}catch(e){return!1}}(),l==SlideBrowser.SAFARI&&s<4),m=d&&!v,S=!m&&h,y=!1,w="undefined"!=typeof document.documentMode?"bicubic":"nearest-neighbor";e.prototype.toString=function(){return this.level+"/"+this.x+"_"+this.y},e.prototype.drawHTML=function(e){if(!this.loaded)return void SlideDebug.error("Attempting to draw tile "+this.toString()+" when it's not yet loaded.");this.elmt||(this.elmt=SlideUtils.makeNeutralElement("img"),this.elmt.src=this.url,this.style=this.elmt.style,this.style.position="absolute",this.style.msInterpolationMode=w,S&&(this.style[n+"Origin"]="0px 0px"));var t=this.elmt,i=this.image,a=this.style,r=this.position,l=this.size;if(t.parentNode!=e&&e.appendChild(t),S)a[n]=["matrix(",(l.x/i.width).toFixed(8),",0,0,",(l.y/i.height).toFixed(8),",",r.x.toFixed(8),o?",":"px,",r.y.toFixed(8),o?")":"px)"].join("");else if(y){var s=e.clientWidth,d=e.clientHeight;a.width=s+"px",a.height=d+"px",a.filter=["progid:DXImageTransform.Microsoft.Matrix(","M11=",(l.x/s).toFixed(8),",M22=",(l.y/d).toFixed(8),",Dx=",r.x.toFixed(8),",Dy=",r.y.toFixed(8),")"].join("")}else r=r.apply(Math.floor),l=l.apply(Math.ceil),a.left=r.x+"px",a.top=r.y+"px",a.width=l.x+"px",a.height=l.y+"px";SlideUtils.setElementOpacity(t,this.opacity)},e.prototype.drawCanvas=function(e){if(!this.loaded)return void SlideDebug.error("Attempting to draw tile "+this.toString()+" when it's not yet loaded.");var t=this.position,i=this.size;e.globalAlpha=this.opacity,e.drawImage(this.image,t.x,t.y,i.x,i.y)},e.prototype.unload=function(){this.elmt&&this.elmt.parentNode&&this.elmt.parentNode.removeChild(this.elmt),this.elmt=null,this.image=null,this.loaded=!1,this.loading=!1},SlideSingleOverlayPlacement=Slide.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8},i.prototype.destroy=function(){var e=this.elmt,t=this.style;e.parentNode&&e.parentNode.removeChild(e),t.top="",t.left="",t.position="",this.scales&&(t.width="",t.height="")},i.prototype.drawHTML=function(e){var t=this.elmt,i=this.style,o=this.scales,a=this.naturalSize;t.parentNode!=e&&(e.appendChild(t),i.position="absolute",a.x=t.clientWidth,a.y=t.clientHeight);var r=this.position,l=this.size;if(o||(l.x=a.x=a.x||t.clientWidth,l.y=a.y=a.y||t.clientHeight),this.adjust(r,l),SlideConfig.transformOverlays&&h)i[n+"Origin"]="0px 0px",i[n]=["translate(",r.x.toFixed(8),"px,",r.y.toFixed(8),"px)"].join(""),o&&(t.clientWidth||(i.width="100%"),t.clientHeight||(i.height="100%"),i[n]+=[" scale(",(l.x/t.clientWidth).toFixed(8),",",(l.y/t.clientHeight).toFixed(8),")"].join(""));else if(SlideConfig.transformOverlays&&y){var s=e.clientWidth,d=e.clientHeight;i.width=s+"px",i.height=d+"px",i.filter=["progid:DXImageTransform.Microsoft.Matrix(","M11=",(l.x/s).toFixed(8),",M22=",(l.y/d).toFixed(8),",Dx=",r.x.toFixed(8),",Dy=",r.y.toFixed(8),")"].join("")}else r=r.apply(Math.floor),l=l.apply(Math.ceil),i.left=r.x+"px",i.top=r.y+"px",o&&(i.width=l.x+"px",i.height=l.y+"px")},i.prototype.update=function(e,i){this.scales=e instanceof SlideRect,this.bounds=new SlideRect(e.x,e.y,e.width,e.height),this.adjust=t(e instanceof SlidePoint?i:SlideSingleOverlayPlacement.TOP_LEFT)},SlideSingleDrawer=Slide.SingleDrawer=function(t,n,o){function s(e){return O[e]||(O[e]=t.getNumTiles(e)),O[e]}function d(e){return R[e]||(R[e]=t.getPixelRatio(e)),R[e]}function u(i,n,o,a,r,l){if(B[i]||(B[i]={}),B[i][n]||(B[i][n]={}),!B[i][n][o]){var s=(r+n%r)%r,d=(l+o%l)%l,u=t.getTileBounds(i,s,d),c=t.tileExists(i,s,d),h=t.getTileUrl(i,s,d);u.x+=1*(n-s)/r,u.y+=L*(o-d)/l,B[i][n][o]=new e(i,n,o,u,c,h)}var f=B[i][n][o];return f.lastTouchTime=a,f}function c(e,t){e.loading=T.loadImage(e.url,SlideUtils.createCallback(null,h,e,t))}function h(e,t,i){if(e.loading=!1,$)return void SlideDebug.error("Tile load callback in middle of drawing routine.");if(!i)return SlideDebug.log("Tile "+e+" failed to load: "+e.url),void(e.exists=!1);if(t<H)return void SlideDebug.log("Ignoring tile "+e+" loaded before reset: "+e.url);e.loaded=!0,e.image=i;var n=D.length;if(D.length>=a){for(var o=Math.ceil(Math.log(U)/Math.log(2)),r=null,l=-1,s=D.length-1;s>=0;s--){var d=D[s];if(!(d.level<=o||d.beingDrawn))if(r){var u=d.lastTouchTime,c=r.lastTouchTime,h=d.level,f=r.level;(u<c||u==c&&h>f)&&(r=d,l=s)}else r=d,l=s}r&&l>=0&&(r.unload(),n=l)}D[n]=e,W=!0}function f(){B={},D=[]}function p(e,t,i){if(!I[e])return!1;if(void 0===t||void 0===i){var n=I[e];for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];for(var r in a)if(a.hasOwnProperty(r)&&!a[r])return!1}return!0}return void 0===I[e][t]||void 0===I[e][t][i]||I[e][t][i]===!0}function g(e,t,i){return void 0===t||void 0===i?p(e+1):p(e+1,2*t,2*i)&&p(e+1,2*t,2*i+1)&&p(e+1,2*t+1,2*i)&&p(e+1,2*t+1,2*i+1)}function v(e,t,i,n){return I[e]?(I[e][t]||(I[e][t]={}),void(I[e][t][i]=n)):void SlideDebug.error("Setting coverage for a tile before its level's coverage has been reset: "+e)}function S(e){I[e]={}}function y(e,t){return e?t.visibility>e.visibility?t:t.visibility==e.visibility&&t.distance<e.distance?t:e:t}function w(e){for(var t=F.length-1;t>=0;t--)if(F[t].elmt==e)return t;return-1}function x(){W=!1;for(var e=b,i=M,o=m,a=z;a.length>0;){var h=a.pop();h.beingDrawn=!1}var f=n.getContainerSize(),w=f.x,x=f.y;o?(e.width=w,e.height=x,i.clearRect(0,0,w,x)):e.innerHTML="";var T=n.getBounds(!0),C=T.getTopLeft(),U=T.getBottomRight();if((SlideConfig.wrapHorizontal||!(U.x<0||C.x>1))&&(SlideConfig.wrapVertical||!(U.y<0||C.y>L))){var O=s,R=d,B=u,D=g,I=v,H=S,$=p,j=k,G=N,V=l===SlideBrowser.CHROME,Z=Math.abs,X=(Math.ceil,Math.floor),_=Math.log,Y=Math.max,q=Math.min,K=n.deltaPixelsFromPoints,J=n.pixelFromPoint,Q=t.getTileAtPoint,ee=SlideConfig.alwaysBlend,te=1e3*SlideConfig.blendTime,ie=SlideConfig.immediateRender,ne=SlideConfig.minZoomDimension,oe=(SlideConfig.minImageRatio,SlideConfig.wrapHorizontal),ae=SlideConfig.wrapVertical,re=SlideConfig.wrapOverlays;oe||(C.x=Y(C.x,0),U.x=q(U.x,1)),ae||(C.y=Y(C.y,0),U.y=q(U.y,L));var le=null,se=!1,de=(new Date).getTime(),ue=n.getCenter(),ce=J(ue),he=K(R(0),!1).x,fe=ie?1:he;ne=ne||64;var pe=Y(A,X(_(ne)/_(2))),ge=K(R(0),!0).x,ve=q(E,X(_(ge/r)/_(2)));pe=q(pe,ve);for(var me=ve;me>=pe;me--){var Se=!1,ye=K(R(me),!0).x;if(!se&&ye>=r||me==pe)Se=!0,se=!0;else if(!se)continue;H(me);var we=q(1,(ye-.5)/.5),xe=K(R(me),!1).x,Pe=fe/Z(fe-xe),be=Q(me,C),Me=Q(me,U),Te=O(me),Ce=Te.x,Ae=Te.y;oe||(Me.x=q(Me.x,Ce-1)),ae||(Me.y=q(Me.y,Ae-1));for(var Ee=be.x;Ee<=Me.x;Ee++)for(var Ue=be.y;Ue<=Me.y;Ue++){var h=B(me,Ee,Ue,de,Ce,Ae),ke=Se;if(I(me,Ee,Ue,!1),h.exists&&(se&&!ke&&(D(me,Ee,Ue)?I(me,Ee,Ue,!0):ke=!0),ke)){var Le=h.bounds.getTopLeft(),Oe=h.bounds.getSize(),Re=J(Le,!0),Be=K(Oe,!0);j||(Be=Be.plus(new SlidePoint(1,1)));var De=J(Le,!1),Ie=K(Oe,!1),Fe=De.plus(Ie.divide(2)),ze=ce.distanceTo(Fe);if(h.position=Re,h.size=Be,h.distance=ze,h.visibility=Pe,h.loaded){h.blendStart||(h.blendStart=de);var Ne=de-h.blendStart,He=0===te?1:q(1,Ne/te);ee&&(He*=we),h.opacity=He,a.push(h),He>=1?(I(me,Ee,Ue,!0),V&&h.lastDrawnTime!==G&&I(me,Ee,Ue,!1)):Ne<te&&(W=!0),h.lastDrawnTime=de}else h.loading||(le=y(le,h))}}if($(me))break}for(var $e=a.length-1;$e>=0;$e--){var h=a[$e];o?h.drawCanvas(i):h.drawHTML(e),h.beingDrawn=!0}for(var We=F.length,$e=0;$e<We;$e++){var je=F[$e],Ge=je.bounds,Ve=Ge.getTopLeft();re&&oe&&(Ve.x+=X(ue.x)),je.position=J(Ve,!0),je.size=K(Ge.getSize(),!0),je.drawHTML(P)}le&&(c(le,de),W=!0),N=de}}var P=SlideUtils.getElement(o),b=SlideUtils.makeNeutralElement(m?"canvas":"div"),M=m?b.getContext("2d"):null,T=new SlideImgLoader,C=new SlideProfiler,A=t.minLevel,E=t.maxLevel,U=t.tileSize,k=t.tileOverlap,L=t.height/t.width,O={},R={},B={},D=[],I={},F=[],z=[],N=0,H=0,$=!1,W=!0;this.elmt=P,this.profiler=C,function(){b.style.width="100%",b.style.height="100%",b.style.position="absolute",P.style.textAlign="left",P.appendChild(b)}(),this.addOverlay=function(e,t,n){var e=SlideUtils.getElement(e);w(e)>=0||(F.push(new i(e,t,n)),W=!0)},this.updateOverlay=function(e,t,i){var e=SlideUtils.getElement(e),n=w(e);n>=0&&(F[n].update(t,i),W=!0)},this.removeOverlay=function(e){var e=SlideUtils.getElement(e),t=w(e);t>=0&&(F[t].destroy(),F.splice(t,1),W=!0)},this.clearOverlays=function(){for(;F.length>0;)F.pop().destroy(),W=!0},this.needsUpdate=function(){return W},this.numTilesLoaded=function(){return D.length},this.reset=function(){f(),H=(new Date).getTime(),W=!0},this.update=function(){C.beginUpdate(),$=!0,x(),$=!1,C.endUpdate()},this.idle=function(){},this.useCanvas=function(){return m},this.getCanvas=function(){
return b}}}();var SlideEvtManage=Slide.EvtManage=function(){var e={};this.addListener=function(t,i){"function"==typeof i&&(e[t]||(e[t]=[]),e[t].push(i))},this.removeListener=function(t,i){var n=e[t];if("function"==typeof i&&n)for(var o=0;o<n.length;o++)if(i===n[o])return void n.splice(o,1)},this.clearListeners=function(t){e[t]&&delete e[t]},this.trigger=function(t){var i=e[t],n=[];if(i){for(var o=1;o<arguments.length;o++)n.push(arguments[o]);for(var o=0;o<i.length;o++)try{i[o].apply(window,n)}catch(e){SlideDebug.error(e.name+" while executing "+t+" handler: "+e.message,e)}}}},SlideImgLoader=Slide.ImgLoader;!function(){function e(e,i){function n(t){o.onload=null,o.onabort=null,o.onerror=null,a&&window.clearTimeout(a),window.setTimeout(function(){i(e,t?o:null)},1)}var o=null,a=null;this.start=function(){function i(){n(!0)}function r(){n(!1)}function l(){SlideDebug.log("Image timed out: "+e),n(!1)}o=new Image,o.onload=i,o.onabort=r,o.onerror=r,a=window.setTimeout(l,t),o.src=e}}var t=15e3;SlideImgLoader=Slide.ImgLoader=function(){function t(e,t,n){if(i--,"function"==typeof e)try{e(n)}catch(e){SlideDebug.error(e.name+" while executing "+t+" callback: "+e.message,e)}}var i=0;this.loadImage=function(n,o){if(i>=SlideConfig.imageLoaderLimit)return!1;var a=SlideUtils.createCallback(null,t,o),r=new e(n,a);return i++,r.start(),!0}}}();var SlideMouseTracker=Slide.MouseTracker;!function(){function e(){n=!0}function t(){n=!1}if(!SlideMouseTracker){var i=SlideUtils.getBrowser()===SlideBrowser.IE&&SlideUtils.getBrowserVersion()<9,n=!1,o=!1,a={},r=[];!function(){i?(SlideUtils.addEvent(document,"mousedown",e,!1),SlideUtils.addEvent(document,"mouseup",t,!1)):(SlideUtils.addEvent(window,"mousedown",e,!0),SlideUtils.addEvent(window,"mouseup",t,!0))}(),SlideMouseTracker=Slide.MouseTracker=function(e){function t(e,t){for(var i=document.body;t&&e!==t&&i!==t;)try{t=t.parentNode}catch(e){return!1}return e===t}function l(e,t){var i=SlideUtils.getMousePosition(e),n=SlideUtils.getElementPosition(t);return i.minus(n)}function s(e){return SlideUtils.getMousePosition(e)}function d(){U||(SlideUtils.addEvent(e,"mouseover",g,!1),SlideUtils.addEvent(e,"mouseout",v,!1),SlideUtils.addEvent(e,"mousedown",m,!1),SlideUtils.addEvent(e,"mouseup",S,!1),SlideUtils.addEvent(e,"click",w,!1),SlideUtils.addEvent(e,"mousewheel",x,!1),U=!0,a[E]=A)}function u(){U&&(SlideUtils.removeEvent(e,"mouseover",g,!1),SlideUtils.removeEvent(e,"mouseout",v,!1),SlideUtils.removeEvent(e,"mousedown",m,!1),SlideUtils.removeEvent(e,"mouseup",S,!1),SlideUtils.removeEvent(e,"click",w,!1),SlideUtils.removeEvent(e,"mousewheel",x,!1),h(),U=!1,delete a[E])}function c(){k||(i?(SlideUtils.removeEvent(e,"mouseup",S,!1),SlideUtils.addEvent(e,"mouseup",P,!0),SlideUtils.addEvent(e,"mousemove",b,!0)):(SlideUtils.addEvent(window,"mouseup",M,!0),SlideUtils.addEvent(window,"mousemove",T,!0)),k=!0)}function h(){k&&(i?(SlideUtils.addEvent(e,"mouseup",S,!1),SlideUtils.removeEvent(e,"mouseup",P,!0),SlideUtils.removeEvent(e,"mousemove",b,!0)):(SlideUtils.removeEvent(window,"mouseup",M,!0),SlideUtils.removeEvent(window,"mousemove",T,!0)),k=!1)}function f(){return O}function p(e,t){var i=a;for(var n in i)i.hasOwnProperty(n)&&E!==n&&i[n][e](t)}function g(o){o=SlideUtils.getEvent(o),i&&k&&!t(o.srcElement,e)&&p("onMouseOver",o);var a=o.target?o.target:o.srcElement,r=o.relatedTarget?o.relatedTarget:o.fromElement;if(t(e,a)&&!t(e,r)&&(O=!0,"function"==typeof C.enterHandler))try{C.enterHandler(C,l(o,e),L,n)}catch(e){SlideDebug.error(e.name+" while executing enter handler: "+e.message,e)}}function v(o){o=SlideUtils.getEvent(o),i&&k&&!t(o.srcElement,e)&&p("onMouseOut",o);var a=o.target?o.target:o.srcElement,r=o.relatedTarget?o.relatedTarget:o.toElement;if(t(e,a)&&!t(e,r)&&(O=!1,"function"==typeof C.exitHandler))try{C.exitHandler(C,l(o,e),L,n)}catch(e){SlideDebug.error(e.name+" while executing exit handler: "+e.message,e)}}function m(t){if(t=SlideUtils.getEvent(t),2!==t.button){if(L=!0,R=s(t),D=R,B=(new Date).getTime(),"function"==typeof C.pressHandler)try{C.pressHandler(C,l(t,e))}catch(e){SlideDebug.error(e.name+" while executing press handler: "+e.message,e)}(C.pressHandler||C.dragHandler)&&SlideUtils.cancelEvent(t),i&&o?i&&r.push(A):(c(),o=!0,r=[A])}}function S(t){if(t=SlideUtils.getEvent(t),2!==t.button){var i=L,n=O;if(L=!1,"function"==typeof C.releaseHandler)try{C.releaseHandler(C,l(t,e),i,n)}catch(e){SlideDebug.error(e.name+" while executing release handler: "+e.message,e)}i&&n&&y(t)}}function y(t){if(t=SlideUtils.getEvent(t),2!==t.button){var i=(new Date).getTime()-B,n=s(t),o=D.distanceTo(n),a=i<=SlideConfig.clickTimeThreshold&&o<=SlideConfig.clickDistThreshold;if("function"==typeof C.clickHandler)try{C.clickHandler(C,l(t,e),a,t.shiftKey)}catch(e){SlideDebug.error(e.name+" while executing click handler: "+e.message,e)}}}function w(e){C.clickHandler&&SlideUtils.cancelEvent(e)}function x(t){if(t=SlideUtils.getEvent(t),"function"==typeof C.scrollHandler){var i=SlideUtils.getMouseScroll(t);if(i)try{C.scrollHandler(C,l(t,e),i,t.shiftKey)}catch(e){SlideDebug.error(e.name+" while executing scroll handler: "+e.message,e)}SlideUtils.cancelEvent(t)}}function P(e){if(e=SlideUtils.getEvent(e),2!==e.button){for(var t=0;t<r.length;t++){var i=r[t];i.hasMouse()&&i.onMouseUp(e)}h(),o=!1,e.srcElement.fireEvent("on"+e.type,document.createEventObject(e)),SlideUtils.stopEvent(e)}}function b(e){for(var t=0;t<r.length;t++)r[t].onMouseMove(e);SlideUtils.stopEvent(e)}function M(e){O||S(e),h()}function T(t){t=SlideUtils.getEvent(t);var i=s(t),n=i.minus(R);if(R=i,"function"==typeof C.dragHandler){try{C.dragHandler(C,l(t,e),n,t.shiftKey)}catch(e){SlideDebug.error(e.name+" while executing drag handler: "+e.message,e)}SlideUtils.cancelEvent(t)}}var C=this,e=SlideUtils.getElement(e),A=null,E=Math.random(),U=!1,k=!1,L=!1,O=!1,R=null,B=null,D=null;this.target=e,this.enterHandler=null,this.exitHandler=null,this.pressHandler=null,this.releaseHandler=null,this.clickHandler=null,this.dragHandler=null,this.scrollHandler=null,function(){A={hasMouse:f,onMouseOver:g,onMouseOut:v,onMouseUp:S,onMouseMove:T}}(),this.isTracking=function(){return U},this.setTracking=function(e){e?d():u()}}}}();var SlidePoint=Slide.Point;!function(){if(!SlidePoint){SlidePoint=Slide.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0};var e=SlidePoint.prototype;e.plus=function(e){return new SlidePoint(this.x+e.x,this.y+e.y)},e.minus=function(e){return new SlidePoint(this.x-e.x,this.y-e.y)},e.times=function(e){return new SlidePoint(this.x*e,this.y*e)},e.divide=function(e){return new SlidePoint(this.x/e,this.y/e)},e.multiPoint=function(e){return new SlidePoint(this.x*e.x,this.y*e.y)},e.dividePoint=function(e){if(0!==e.x&&0!==e.y)return new SlidePoint(this.x/e.x,this.y/e.y)},e.negate=function(){return new SlidePoint((-this.x),(-this.y))},e.distanceTo=function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},e.apply=function(e){return"function"==typeof e?new SlidePoint(e(this.x),e(this.y)):new SlidePoint(this.x,this.y)},e.equals=function(e){return e instanceof SlidePoint&&this.x==e.x&&this.y==e.y},e.toString=function(){return"("+this.x+","+this.y+")"}}}();var SlideProfiler=Slide.Profiler=function(){var e=this,t=!1,i=0,n=null,o=null,a=1/0,r=0,l=0,s=1/0,d=0,u=0;this.getAvgUpdateTime=function(){return r},this.getMinUpdateTime=function(){return a},this.getMaxUpdateTime=function(){return l},this.getAvgIdleTime=function(){return d},this.getMinIdleTime=function(){return s},this.getMaxIdleTime=function(){return u},this.isMidUpdate=function(){return t},this.getNumUpdates=function(){return i},this.beginUpdate=function(){if(t&&e.endUpdate(),t=!0,n=(new Date).getTime(),!(i<1)){var a=n-o;d=(d*(i-1)+a)/i,a<s&&(s=a),a>u&&(u=a)}},this.endUpdate=function(){if(t){o=(new Date).getTime(),t=!1;var e=o-n;i++,r=(r*(i-1)+e)/i,e<a&&(a=e),e>l&&(l=e)}},this.clearProfile=function(){t=!1,i=0,n=null,o=null,a=1/0,r=0,l=0,s=1/0,d=0,u=0}},SlideRect=Slide.Rect;!function(){if(!SlideRect){SlideRect=Slide.Rect=function(e,t,i,n){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0};var e=SlideRect.prototype;e.getAspectRatio=function(){return this.width/this.height},e.getTopLeft=function(){return new SlidePoint(this.x,this.y)},e.getBottomRight=function(){return new SlidePoint(this.x+this.width,this.y+this.height)},e.getCenter=function(){return new SlidePoint(this.x+this.width/2,this.y+this.height/2)},e.getSize=function(){return new SlidePoint(this.width,this.height)},e.equals=function(e){return e instanceof SlideRect&&this.x==e.x&&this.y==e.y&&this.width==e.width&&this.height==e.height},e.toString=function(){return"["+this.x+","+this.y+","+this.width+"x"+this.height+"]"}}}();var SlideSpring=Slide.Spring=function(e){function t(e){var t=SlideConfig.springStiffness;return 1-Math.exp(-e*t)/(1-Math.exp(-t))}var i="number"==typeof e?e:0,n=i,o=i,a=(new Date).getTime(),r=a,l=a;this.getCurrent=function(){return i},this.getTarget=function(){return o},this.resetTo=function(e){o=e,l=a,n=o,r=l},this.springTo=function(e){n=i,r=a,o=e,l=r+1e3*SlideConfig.animationTime},this.shiftBy=function(e){n+=e,o+=e},this.update=function(){a=(new Date).getTime(),i=a>=l?o:n+(o-n)*t((a-r)/(l-r))}},SlideStrings=Slide.Strings;!function(){SlideStrings||(SlideStrings=Slide.Strings={Errors:{Failure:"Sorry, but Seadragon Ajax can't run on your browser!\nPlease try using IE 8 or Firefox 3.\n",Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Empty:"You asked us to open nothing, so we did just that.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",Unknown:"Whoops, something inexplicably went wrong. Sorry!"},Messages:{Loading:"Loading..."},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in (you can also use your mouse's scroll wheel)",ZoomOut:"Zoom out (you can also use your mouse's scroll wheel)",slideSpin:"Spin slide image",slidePan:"pan slide image",PrevSlide:"",NextSlide:""}},SlideStrings.getString=function(e){for(var t=e.split("."),i=SlideStrings,n=0;n<t.length;n++)i=i[t[n]]||{};"string"!=typeof i&&(i="");var o=arguments;return i.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/))+1;return t<o.length?o[t]:""})},SlideStrings.setString=function(e,t){for(var i=e.split("."),n=SlideStrings,o=0;o<i.length-1;o++)n[i[o]]||(n[i[o]]={}),n=n[i[o]];n[i[o]]=t})}();var SlideUi=Slide.Ui;!function(){SlideUi=Slide.Ui=function(e){function t(){m.emulateEnter(),m.emulateExit(),S.emulateEnter(),S.emulateExit()}function i(){var t=e.viewport.getContainerSize();G.elmt.style.left=t.x-4*w-4+"px",v()}function n(){e.viewport&&(e.viewport.panTo(e.viewport.getHomeCenter(),!0),window.setTimeout(function(){e.viewport.goHome()},10))}function o(){e.setFullPage(!e.isFullPage()),m.emulateExit(),S.emulateExit(),v(),e.viewport&&e.viewport.applyConstraints()}function a(){A=(new Date).getTime(),C=SlideConfig.zoomPerSecond,T=!0,s()}function r(){A=(new Date).getTime(),C=1/SlideConfig.zoomPerSecond,T=!0,s()}function l(){T=!1}function s(){window.setTimeout(d,10)}function d(){if(T&&e.viewport){var t=(new Date).getTime(),i=t-A,n=Math.pow(C,i/1e3);e.viewport.zoomBy(n),e.viewport.applyConstraints(),A=t,s()}}function u(){e.viewport&&(T=!1,e.viewport.zoomBy(SlideConfig.zoomPerClick/1),e.viewport.applyConstraints())}function c(){e.viewport&&(T=!1,e.viewport.zoomBy(1/SlideConfig.zoomPerClick),e.viewport.applyConstraints())}function h(){W.resetState(),e.isSwitchSlide()||e.setSwitchSlide(!0)}function f(){$.resetState(),e.isSwitchSlide()&&e.setSwitchSlide(!1)}function p(){if(e.viewport){var t=e.viewport,i=t.getSlide()-1;i<0&&(i=e.source.number-1),t.slideTo(i,!0)}}function g(){if(e.viewport){var t=e.viewport,i=t.getSlide()+1;i>=e.source.number&&(i=0),t.slideTo(i,!0)}}function v(){if(e.viewport){var t=e.viewport.getContainerSize();j.elmt.style.left="4px",j.elmt.style.top=parseInt(t.y/2)-42+"px",G.elmt.style.left=t.x-168-4+"px",G.elmt.style.top=parseInt(t.y/2)-42+"px"}}var m=null,S=null,y=!0,w=42,x="home",P="fullpage",b="zoomin",M="zoomout",T=!1,C=null,A=null,E="slidespin",U="slidepan",k="slideprev",L="slidenext",O="normal",R="focus",B="hover",D="down",I="hold",F=new SlideButton({tooltip:SlideStrings.getString("Tooltips.Home"),srcNormal:SlideUtils.iconUrl(x,O),srcFocus:SlideUtils.iconUrl(x,R),srcHover:SlideUtils.iconUrl(x,B),srcDown:SlideUtils.iconUrl(x,D),onRelease:n}),z=new SlideButton({tooltip:SlideStrings.getString("Tooltips.FullPage"),srcNormal:SlideUtils.iconUrl(P,O),srcFocus:SlideUtils.iconUrl(P,R),srcHover:SlideUtils.iconUrl(P,B),srcDown:SlideUtils.iconUrl(P,D),onRelease:o}),N=new SlideButton({tooltip:SlideStrings.getString("Tooltips.ZoomIn"),srcNormal:SlideUtils.iconUrl(b,O),srcFocus:SlideUtils.iconUrl(b,R),srcHover:SlideUtils.iconUrl(b,B),srcDown:SlideUtils.iconUrl(b,D),onPress:a,onRelease:l,onClick:u,onEnter:a,onExit:l}),H=new SlideButton({tooltip:SlideStrings.getString("Tooltips.ZoomOut"),srcNormal:SlideUtils.iconUrl(M,O),srcFocus:SlideUtils.iconUrl(M,R),srcHover:SlideUtils.iconUrl(M,B),srcDown:SlideUtils.iconUrl(M,D),onPress:r,onRelease:l,onClick:c,onEnter:r,onExit:l}),$=new SlideButton({canHold:!0,tooltip:SlideStrings.getString("Tooltips.slideSpin"),srcNormal:SlideUtils.iconUrl(E,O),srcFocus:SlideUtils.iconUrl(E,R),srcHover:SlideUtils.iconUrl(E,B),srcDown:SlideUtils.iconUrl(E,D),srcHold:SlideUtils.iconUrl(E,I),onPress:h}),W=new SlideButton({canHold:!0,tooltip:SlideStrings.getString("Tooltips.slidePan"),srcNormal:SlideUtils.iconUrl(U,O),srcFocus:SlideUtils.iconUrl(U,R),srcHover:SlideUtils.iconUrl(U,B),srcDown:SlideUtils.iconUrl(U,D),srcHold:SlideUtils.iconUrl(U,I),onPress:f}),j=new SlideButton({tooltip:SlideStrings.getString("Tooltips.PrevSlide"),srcNormal:SlideUtils.iconUrl(k,O),srcFocus:SlideUtils.iconUrl(k,R),srcHover:SlideUtils.iconUrl(k,B),srcDown:SlideUtils.iconUrl(k,D),onRelease:p}),G=new SlideButton({tooltip:SlideStrings.getString("Tooltips.NextSlide"),srcNormal:SlideUtils.iconUrl(L,O),srcFocus:SlideUtils.iconUrl(L,R),srcHover:SlideUtils.iconUrl(L,B),srcDown:SlideUtils.iconUrl(L,D),onRelease:g});m=new SlideButtonGroup([F,z,N,H]),m.elmt[e.SIGNAL]=!0,$.setHoldState(),S=new SlideButtonGroup([$,W]),S.elmt[e.SIGNAL]=!0,S.elmt.style.marginLeft="4px",S.elmt.style.marginBottom="4px",e.addControl(S.elmt,SlideControlAnchor.BOTTOM_LEFT);var V=e.viewport.getContainerSize(),Z=new SlideButtonGroup([j,G]);Z.elmt[e.SIGNAL]=!0,j.elmt.position="absolute",j.elmt.style.left="4px",j.elmt.style.top=parseInt(V.y/2)-w+"px",G.elmt.position="absolute",G.elmt.style.left=V.x-4*w-4+"px",G.elmt.style.top=parseInt(V.y/2)-w+"px",e.isMulti===!1&&(j.elmt.style.display="none",G.elmt.style.display="none",S.elmt.style.display="none"),e.addControl(Z.elmt,SlideControlAnchor.NONE),e.addEventListener("open",t),e.addEventListener("resize",i),this.addNavControl=function(){var t=m.elmt;t.style.marginLeft="4px",t.style.marginTop="4px",e.addControl(t,SlideControlAnchor.TOP_LEFT)},this.removeNavControl=function(){m&&e.removeControl(m.elmt)},this.setSwitchBtnEnabel=function(t){"boolean"!=typeof t||t!==!0||y?(y=!1,e.removeControl(Z.elmt),e.removeControl(S.elmt)):(y=!0,e.addControl(Z.elmt,SlideControlAnchor.NONE),e.addControl(S.elmt,SlideControlAnchor.BOTTOM_LEFT))}}}();var SlideViewport=Slide.Viewport;!function(){SlideViewport=Slide.Viewport=function(e,t){function i(e){return Math.pow(2,e)}function n(e){return Math.log(e)/m}function o(e,t,i){return Math.min(Math.max(e,t),i)}function a(e,t){var i=e.x,n=e.y,a=o(i,t.x,t.x+t.width),r=o(n,t.y,t.y+t.height);return i===a&&n===r?e:new SlidePoint(a,r)}function r(e){var t=l.getZoom(e),i=1/t,n=i/l.getAspectRatio(),o=SlideConfig.visibilityRatio,a=(o-.5)*i,r=(o-.5)*n,s=1-2*a,u=d-2*r;return s<0&&(a+=.5*s,s=0),u<0&&(r+=.5*u,u=0),new SlideRect(a,r,s,u)}var l=this,s=t.x/t.y,d=t.y/t.x,u=new SlideSpring(0),c=new SlideSpring(0),h=new SlideSpring(0),f=new SlideSpring(SlideConfig.logarithmicZoom?0:1),p=null,g=new SlideRect(0,0,1,d),v=g.getCenter(),m=Math.LN2;e=new SlidePoint(e.x,e.y),this.goHome=function(e){var t=l.getCenter();SlideConfig.wrapHorizontal&&(t.x=(1+t.x%1)%1,c.resetTo(t.x),c.update()),SlideConfig.wrapVertical&&(t.y=(d+t.y%d)%d,h.resetTo(t.y),h.update()),l.fitBounds(g,e)},this.fitBounds=function(t,i){var n=l.getAspectRatio(),o=t.getCenter(),a=new SlideRect(t.x,t.y,t.width,t.height);a.getAspectRatio()>=n?(a.height=t.width/n,a.y=o.y-a.height/2):(a.width=t.height*n,a.x=o.x-a.width/2),l.panTo(l.getCenter(!0),!0),l.zoomTo(l.getZoom(!0),null,!0);var r=l.getBounds(),s=l.getZoom(),d=1/a.width;if(d==s||a.width==r.width)return void l.panTo(o,i);var u=r.getTopLeft().times(e.x/r.width).minus(a.getTopLeft().times(e.x/a.width)).divide(e.x/r.width-e.x/a.width);l.zoomTo(d,u,i)},this.panTo=function(t,i){if(i)return c.resetTo(t.x),void h.resetTo(t.y);if(!p)return c.springTo(t.x),void h.springTo(t.y);var n=l.getZoom(),o=1/n,a=o/l.getAspectRatio(),r=c.getCurrent()-o/2,s=h.getCurrent()-a/2,d=new SlideRect(r,s,o,a),u=l.pixelFromPoint(p,!0),f=p.minus(d.getTopLeft()).times(e.x/d.width),g=f.minus(u),v=g.divide(e.x*n),m=t.minus(v);c.springTo(m.x),h.springTo(m.y)},this.zoomTo=function(e,t,i){i?f.resetTo(SlideConfig.logarithmicZoom?n(e):e):f.springTo(SlideConfig.logarithmicZoom?n(e):e),p=t instanceof SlidePoint?t:null},this.slideTo=function(e,t){t?u.resetTo(e):u.springTo(e)},this.panBy=function(e,t){l.panTo(l.getCenter().plus(e),t)},this.zoomBy=function(e,t,i){l.zoomTo(l.getZoom()*e,t,i)},this.slideBy=function(e,t){l.slideTo(l.getSlide()+e,t)},this.update=function(){var e,t=c.getCurrent(),i=h.getCurrent(),n=f.getCurrent(),o=u.getCurrent();if(p&&(e=l.pixelFromPoint(p,!0)),f.update(),p&&f.getCurrent()!==n){var a=l.pixelFromPoint(p,!0),r=a.minus(e),s=l.deltaPointsFromPixels(r,!0);c.shiftBy(s.x),h.shiftBy(s.y)}else p=null;return c.update(),h.update(),u.update(),c.getCurrent()!==t||h.getCurrent()!==i||f.getCurrent()!==n||u.getCurrent()!==o},this.resize=function(t,i){var n=l.getBounds(),o=n,a=t.x/e.x;e=new SlidePoint(t.x,t.y),i&&(o.width=n.width*a,o.height=o.width/l.getAspectRatio()),l.fitBounds(o,!0)},this.applyConstraints=function(e){var t=l.getZoom(),i=o(t,l.getMinZoom(),l.getMaxZoom());t!=i&&l.zoomTo(i,p,e);var n=l.getCenter(),s=a(n,r());if(SlideConfig.wrapHorizontal&&(s.x=n.x),SlideConfig.wrapVertical&&(s.y=n.y),!n.equals(s)){var d=1/i,u=d/l.getAspectRatio(),c=s.x-.5*d,h=s.y-.5*u;l.fitBounds(new SlideRect(c,h,d,u),e)}},this.ensureVisible=function(e){l.applyConstraints(e)},this.getCenter=function(t){var i=new SlidePoint(c.getCurrent(),h.getCurrent()),n=new SlidePoint(c.getTarget(),h.getTarget());if(t)return i;if(!p)return n;var o=l.getZoom(),a=1/o,r=a/l.getAspectRatio(),s=i.x-.5*a,d=i.y-.5*r,u=new SlideRect(s,d,a,r),f=l.pixelFromPoint(p,!0),g=p.minus(u.getTopLeft()).times(e.x/u.width),v=g.minus(f),m=v.divide(e.x*o);return n.plus(m)},this.getZoom=function(e){if(e){var t=f.getCurrent();return SlideConfig.logarithmicZoom?i(t):t}var t=f.getTarget();return SlideConfig.logarithmicZoom?i(t):t},this.getSlide=function(e){return e?Math.abs(parseInt(u.getCurrent())):Math.abs(parseInt(u.getTarget()))},this.getAspectRatio=function(){return e.x/e.y},this.getBounds=function(e){var t=l.getCenter(e),i=1/l.getZoom(e),n=i/l.getAspectRatio(),o=t.x-.5*i,a=t.y-.5*n;return new SlideRect(o,a,i,n)},this.getImageBounds=function(e){var t=l.getBounds(e),i=l.getCenter(e),n=l.getAspectRatio(),o=new SlideRect(t.x,t.y,t.width,t.height);return s>=n?(o.height=t.width/s,o.y=i.y-o.height/2):(o.width=t.height*s,o.x=i.x-o.width/2),o},this.getContainerSize=function(){return new SlidePoint(e.x,e.y)},this.getMinZoom=function(){var i,n=l.getHomeZoom();return i=SlideConfig.minZoomDimension?t.x<=t.y?SlideConfig.minZoomDimension/e.x:SlideConfig.minZoomDimension/(e.x*d):SlideConfig.minZoomImageRatio*n,Math.min(i,n)},this.getMaxZoom=function(){var i=t.x*SlideConfig.maxZoomPixelRatio/e.x;return Math.max(i,l.getHomeZoom())},this.getHomeZoom=function(){var e=s/l.getAspectRatio();return e>=1?1:e},this.getMinCenter=function(e){return r(e).getTopLeft()},this.getMaxCenter=function(e){return r(e).getBottomRight()},this.getHomeCenter=function(){return v},this.getHomeBounds=function(){var e=l.getAspectRatio(),t=new SlideRect(g.x,g.y,g.width,g.height);return s>=e?(t.height=g.width/e,t.y=v.y-t.height/2):(t.width=g.height*e,t.x=v.x-t.width/2),t},this.pixelFromPoint=function(t,i){var n=l.getBounds(i);return t.minus(n.getTopLeft()).times(e.x/n.width)},this.pointFromPixel=function(t,i){var n=l.getBounds(i);return t.divide(e.x/n.width).plus(n.getTopLeft())},this.deltaPointsFromPixels=function(t,i){return t.divide(e.x*l.getZoom(i))},this.deltaPixelsFromPoints=function(t,i){return t.times(e.x*l.getZoom(i))},function(){l.goHome(!0),l.update()}()}}();var SlideViewer=Slide.Viewer;!function(){var e="----seadragon----";SlideViewer=Slide.Viewer=function(t){function i(){var e=U.style,i=t.style,n=k.style,h=L.style,f=O.style,p=R.style;e.top="0px",e.left="0px",e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",i.width="100%",i.height="100%",i.position="relative",i.left="0px",i.top="0px",i.textAlign="left",n.position="absolute",h.position="absolute",f.position="absolute",p.position="absolute",n.top=h.top="0px",n.left=p.left="0px",h.right=f.right="0px",p.bottom=f.bottom="0px",p.zIndex=f.zIndex=1,n.zIndex=h.zIndex=1,N.clickHandler=o,N.scrollHandler=a,N.pressHandler=r,N.dragHandler=l,N.releaseHandler=s,N.setTracking(!0),H.enterHandler=d,H.exitHandler=u,H.releaseHandler=c,H.setTracking(!0),window.setTimeout(y,1),t.appendChild(U),t.appendChild(k),t.appendChild(L),t.appendChild(O),t.appendChild(R),E.innerHTML="",E.appendChild(t)}function n(e){var t=document.createTextNode(e);U.innerHTML="",U.appendChild(SlideUtils.makeCenteredNode(t));var i=t.parentNode.style;i.fontFamily="verdana",i.fontSize="13px",i.fontSizeAdjust="none",i.fontStyle="normal",i.fontStretch="normal",i.fontVariant="normal",i.fontWeight="normal",i.lineHeight="1em",i.textAlign="center",i.textDecoration="none"}function o(e,t,i,n){if(I&&i){var o=SlideConfig.zoomPerClick,a=n?1/o:o;I.zoomBy(a,I.pointFromPixel(t,!0)),I.applyConstraints()}}function a(e,t,i,n){if(I){var o=Math.pow(SlideConfig.zoomPerScroll,i);I.zoomBy(o,I.pointFromPixel(t,!0)),I.applyConstraints()}}function r(e,t){I&&(ie=t,ne=I.getCenter(),re?SlideUtils.setMouseCursor(U,SlideUtils.cursorUrl("closedhand")):SlideUtils.setMouseCursor(U,SlideUtils.cursorUrl("closedhand360")))}function l(e,t,i,n){if(I)if(re)if(SlideConfig.constrainDuringPan){var o=t.minus(ie),a=I.deltaPointsFromPixels(o.negate(),!0);I.panTo(ne.plus(a)),I.applyConstraints()}else I.panBy(I.deltaPointsFromPixels(i.negate(),!0));else ae||(ae=window.setTimeout(function(){ae=null;var e=t.minus(ie).x;ie=t,oe=e?e/Math.abs(e):0;var i=I.getSlide()+oe;i<0&&(i+=B.number),i>=B.number&&(i-=B.number),I.slideTo(i,!0),I.applyConstraints()},SlideConfig.drawSwitchPerTime))}function s(e,t,i,n){i&&I&&(I.applyConstraints(),SlideUtils.removeMouseCursor(U))}function d(){Z=!0,w(),I&&(re?SlideUtils.setMouseCursor(U,SlideUtils.cursorUrl("openhand")):SlideUtils.setMouseCursor(U,SlideUtils.cursorUrl("openhand360")))}function u(e,t,i,n){i||(Z=!1,le||y())}function c(e,t,i,n){n||(Z=!1,le||y()),I&&(re?SlideUtils.setMouseCursor(U,SlideUtils.cursorUrl("openhand")):SlideUtils.setMouseCursor(U,SlideUtils.cursorUrl("openhand360")))}function h(e){e=SlideUtils.getEvent(e),27===e.keyCode&&A.setFullPage(!1)}function f(){return B&&p(),ee=(new Date).getTime(),window.setTimeout(function(){ee>te&&n(Strings.getString("Messages.Loading"))},2e3),ee}function p(){A.source=B=null,A.viewport=I=null,A.drawer=D=null,A.profiler=F=null,U.innerHTML=""}function g(e,i,o){if(te=(new Date).getTime(),e<ee)SlideDebug.log("Ignoring out-of-date open."),z.trigger("ignore",A);else if(!i)return n(o),void z.trigger("error",A);return U.innerHTML="",Q=SlideUtils.getElementSize(t),0===Q.x||0===Q.y?void window.setTimeout(function(){g(e,i,o)},10):(B=i,I=new SlideViewport(Q,B.dimensions),D=1===B.number?new SlideSingleDrawer(B,I,U):new SlideMultiDrawer(B,I,U),F=new SlideProfiler,A.source=B,A.viewport=I,A.drawer=D,A.profiler=F,X||(X=new SlideUi(A)),le=!1,se=!0,v(m),void z.trigger("open",A))}function v(e,t){if(le)return window.setTimeout(e,1);var i=(new Date).getTime();t=t?t:i;var n=t+1e3/60,o=Math.max(1,n-i);return window.setTimeout(e,o)}function m(){B&&(S(),v(arguments.callee,(new Date).getTime()))}function S(){if(B){F.beginUpdate();var e=SlideUtils.getElementSize(t);!e.equals(Q)&&e.x>0&&e.y>0&&(I.resize(e,!0),Q=e,z.trigger("resize",A));var i=I.update();!le&&i&&(z.trigger("animationstart",A),w()),i?(D.update(),z.trigger("animation",A)):se||D.needsUpdate()?(D.update(),se=!1):D.idle(),le&&!i&&(z.trigger("animationfinish",A),Z||y()),le=i,F.endUpdate()}}function y(){SlideConfig.autoHideControls&&(V=!0,G=(new Date).getTime()+W,window.setTimeout(x,W))}function w(){V=!1;for(var e=$.length-1;e>=0;e--)$[e].setOpacity(1)}function x(){window.setTimeout(P,20)}function P(){if(V){var e=(new Date).getTime(),t=e-G,i=1-t/j;i=Math.min(1,i),i=Math.max(0,i);for(var n=$.length-1;n>=0;n--)$[n].setOpacity(i);i>0&&x()}}function b(e,i){if(e=SlideUtils.getElement(e),!(C(e)>=0)){var n=null;switch(i){case SlideControlAnchor.TOP_RIGHT:n=L,e.style.position="relative";break;case SlideControlAnchor.BOTTOM_RIGHT:n=O,e.style.position="relative";break;case SlideControlAnchor.BOTTOM_LEFT:n=R,e.style.position="relative";break;case SlideControlAnchor.TOP_LEFT:n=k,e.style.position="relative";break;case SlideControlAnchor.NONE:default:n=t,e.style.position="absolute"}$.push(new SlideControl(A,e,i,n))}}function M(e){e=SlideUtils.getElement(e);var t=C(e);t>=0&&($[t].destroy(),$.splice(t,1))}function T(){for(;$.length>0;)$.pop().destroy()}function C(e){for(var t=$.length-1;t>=0;t--)if($[t].elmt===e)return t;return-1}var A=this,E=SlideUtils.getElement(t),t=SlideUtils.makeNeutralElement("div"),U=SlideUtils.makeNeutralElement("div"),k=SlideUtils.makeNeutralElement("div"),L=SlideUtils.makeNeutralElement("div"),O=SlideUtils.makeNeutralElement("div"),R=SlideUtils.makeNeutralElement("div"),B=null,D=null,I=null,F=null,z=new SlideEvtManage,N=new SlideMouseTracker(U),H=new SlideMouseTracker(t),$=[],W=1e3,j=2e3,G=null,V=!1,Z=!1,X=null,_=document.body.style.width,Y=document.body.style.height,q=document.body.style.overflow,K=document.documentElement.style.overflow,J=new SlidePoint(1,1),Q=null,ee=0,te=0,ie=null,ne=null,oe=0,ae=null,re=!0,le=!1,se=!1;this.container=t,this.elmt=t,this.source=null,this.drawer=null,this.viewport=null,this.profiler=null,this.tracker=N,this.SIGNAL=e,function(){i()}(),this.setFocus=function(){d()},this.isOpen=function(){return!!B},this.openSource=function(e){var t=f();window.setTimeout(function(){g(t,e)},1)},this.close=function(){B&&p()},this.addControl=function(e,t){return b(e,t)},this.removeControl=function(e){return M(e)},this.clearControls=function(){return T()},this.isFullPage=function(){return t.parentNode===document.body},this.setFullPage=function(e){if(!e||!A.isFullPage()){var i=document.body,n=i.style,o=document.documentElement.style,a=t.style,r=U.style;if(e?(q=n.overflow,K=o.overflow,n.overflow="hidden",o.overflow="hidden",_=n.width,Y=n.height,n.width="100%",n.height="100%",r.backgroundColor="#ffffff",r.color="white",a.position="fixed",a.zIndex="99999999",i.appendChild(t),Q=SlideUtils.getWindowSize(),SlideUtils.addEvent(document,"keydown",h),d()):(n.overflow=q,o.overflow=K,n.width=_,n.height=Y,r.backgroundColor="",r.color="",a.position="relative",a.zIndex="",E.appendChild(t),Q=SlideUtils.getElementSize(E),SlideUtils.removeEvent(document,"keydown",h),u()),I){var l=I.getBounds();I.resize(Q);var s=I.getBounds();e?J=new SlidePoint(s.width/l.width,s.height/l.height):(I.update(),I.zoomBy(Math.max(J.x,J.y),null,!0)),se=!0,z.trigger("resize",A),S()}}},this.isMouseNavEnabled=function(){return N.isTracking()},this.setMouseNavEnabled=function(e){N.setTracking(e)},this.isVisible=function(){return"hidden"!==t.style.visibility},this.setVisible=function(e){t.style.visibility=e?"":"hidden"},this.showMessage=function(e,t){return t?void window.setTimeout(function(){A.isOpen()||n(e)},t):void n(e)},this.isSwitchSlide=function(){return!re},this.setSwitchSlide=function(e){re="boolean"!=typeof e||!e},this.setNavControl=function(){X&&X.addNavControl()},this.removeNavControl=function(){X&&X.removeNavControl()},this.addEventListener=function(e,t){z.addListener(e,t)},this.removeEventListener=function(e,t){z.removeListener(e,t)},this.trigger=function(){z.trigger.apply(A,arguments)}}}(),window.SL=window.SL||{};var Debug=SL.Debug=Slide.Debug,Extend=SL.Extend=Slide.Extend,Point=SL.Point=Slide.Point,Rect=SL.Rect=Slide.Rect,Dom=SL.Dom;!function(){Dom=SL.Dom=function(){var e=this;this.rnotwhite=/\S+/g,this.rclass=/[\t\r\n\f]/g,this.rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,this.trim=function(t){return null===t?"":(t+"").replace(e.rtrim,"")},this.isDOM=function(e){return"object"==typeof HTMLElement?function(e){return e instanceof HTMLElement}:function(){return e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName}},this.addClass=function(t,i){if(e.isDOM(t)){var n="string"==typeof i&&i;if(n){var o=(i||"").match(e.rnotwhite)||[],a=1===t.nodeType&&(t.className?(" "+t.className+" ").replace(e.rclass," "):" ");if(a){for(var r=0,l=null;l=o[r++];)a.indexOf(" "+l+" ")<0&&(a+=l+" ");var s=e.trim(a);t.className!==s&&(t.className=s)}}}},this.removeClass=function(t,i){if(e.isDOM(t)){var n=1===arguments.length||"string"==typeof i&&i;if(n){var o=(i||"").match(e.rnotwhite)||[],a=1===t.nodeType&&(t.className?(" "+t.className+" ").replace(e.rclass," "):" ");if(a){for(var r=0,l=null;l=o[r++];)for(;a.indexOf(" "+l+" ")>=0;)a=a.replace(" "+l+" "," ");var s=i?e.trim(a):"";t.className!==s&&(t.className=s)}}}},this.toggleClass=function(t,i,n){if(e.isDOM(t)){if("boolean"==typeof n&&"string"==typeof i)return n?e.addClass(t,i):e.removeClass(t,i);if("string"==typeof i)for(var o,a=0,r=i.match(e.rnotwhite)||[];o=r[a++];)e.hasClass(t,o)?e.removeClass(t,o):e.addClass(t,o);else"undefined"!=typeof i&&"boolean"!=typeof i||(t.className&&(t.__className__=t.className),t.className=t.className||i===!1?"":t.__className__||"")}},this.hasClass=function(t,i){if(!e.isDOM(t))return!1;var n=" "+i+" ";return 1===t.nodeType&&(" "+t.className+" ").replace(e.rclass," ").indexOf(n)>=0},this.show=function(t){if(e.isDOM(t)){var i=t.style.display;t.olddisplay||"none"!==i||(i=t.style.display=""),"none"===i&&""===i||(t.olddisplay=i),"none"!==i&&""!==i||(t.style.display=t.olddisplay||"")}},this.hide=function(t){if(e.isDOM(t)){var i=t.style.display;"none"===i||t.olddisplay||(t.olddisplay=i),t.style.display="none"}}}}(),Dom=SL.Dom=new Dom;var ResultType={Success:0,NoImage:1,NoPermission:2,Failed:3},SlideInfo=SL.SlideInfo=function(e,t,i,n,o,a,r,l,s,d,u,c,h,f){this.id="undefined"!=typeof e?e:0,this.name="undefined"!=typeof t?t:"",this.url="undefined"!=typeof i?i:"",this.description="undefined"!=typeof n?n:"",this.calibration="undefined"!=typeof o?o:1,this.width="undefined"!=typeof a?a:0,this.height="undefined"!=typeof r?r:0,this.number="undefined"!=typeof l?l:0,this.hasAnnotations="undefined"!=typeof s&&s,this.annotations="undefined"!=typeof d?d:[],this.deviceId="undefined"!=typeof u?u:0,this.priority="undefined"!=typeof c?c:0,this.sign="undefined"!=typeof h?h:"",this.scanObjective="undefined"!=typeof f?f:0,this.tileSize=256},AnnotationInfo=SL.AnnotationInfo=function(e,t,i,n,o,a,r,l,s,d,u,c,h,f,p,g,v,m,S,y,w,x){this.id="undefined"!=typeof e?e:0,this.guid="undefined"!=typeof t?t:"",this.imageId="undefined"!=typeof i?i:0,this.name="undefined"!=typeof n?n:"",this.description="undefined"!=typeof o?o:"",this.imageIndex="undefined"!=typeof a?a:0,this.scale="undefined"!=typeof r?r:0,this.width="undefined"!=typeof l?l:0,this.type="undefined"!=typeof s?s:"",this.region="undefined"!=typeof d?d:new Rect,this.fontUnderLine="undefined"!=typeof u&&u,
this.fontSize="undefined"!=typeof c&&c,this.fontFamily="undefined"!=typeof h&&h,this.fontItalic="undefined"!=typeof f&&f,this.fontBold="undefined"!=typeof p&&p,this.visible="undefined"!=typeof g&&g,this.color="undefined"!=typeof v?v:0,this.measurement="undefined"!=typeof m&&m,this.radius="undefined"!=typeof S?S:0,this.arcLength="undefined"!=typeof y?y:0,this.angle="undefined"!=typeof w?w:0,this.points="undefined"!=typeof x?x:[]},Utils=function(){function e(e){var t=e;if(/^(rgb|RGB)/.test(t)){for(var i="#",n=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),o=0;o<n.length;o++){var a=Number(n[o]).toString(16);"0"===a?a+=a:1==a.length&&(a="0"+a),i+=a}if(7!==i.length)return i=t}if(!reg.test(t))return t;var n=t.replace(/#/,"").split("");if(6===n.length)return t;if(3===n.length){for(var i="#",o=0;o<n.length;o++)i+=n[o]+n[o];return i}}var t=this;this.reg=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,this.enter="<br/>",this.HexToNumber=function(e){return parseInt(e.replace("#","0xFF"))},this.NumberToHex=function(t){var i=t>>16&255,n=t>>8&255,o=255&t,a="rgb("+i+","+n+","+o+")";return e(a)},this.calcCenterX=function(e,t,i,n,o,a){return((e*e+t*t)*(n-a)-(i*i+n*n)*(n-a)-(i*i+n*n)*(t-n)+(o*o+a*a)*(t-n))/(2*((e-i)*(n-a)-(i-o)*(t-n)))},this.calcCenterY=function(e,i,n,o,a,r){var l=t.calcCenterX(e,i,n,o,a,r);return(n*n+o*o-(a*a+r*r)-2*l*(n-a))/(2*(o-r))},this.calcCenterPoint=function(e,i,n){var o=t.calcCenterX(e.x,e.y,i.x,i.y,n.x,n.y),a=t.calcCenterY(e.x,e.y,i.x,i.y,n.x,n.y);return new Point(o,a)},this.calcTwoCenterPoint=function(e,t){return e.plus(t).divide(2)},this.calcTwoPointDistance=function(e,t){return e.distanceTo(t)},this.calcRadius=function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},this.angleDegreeS=function(e,t,i,n,o,a){var r=Math.atan2(t-n,e-i),l=Math.atan2(a-n,o-i),s=(l-r)/Math.PI*180;return s<0?360+s:s},this.angleRadianS=function(e,t,i,n,o,a){var r=Math.atan2(t-n,e-i),l=Math.atan2(a-n,o-i);return l-r},this.angleRadian=function(e,i,n){return t.angleRadianS(e.x,e.y,i.x,i.y,n.x,n.y)},this.angleDegree=function(e,i,n){return t.angleDegreeS(e.x,e.y,i.x,i.y,n.x,n.y)},this.radianOfTwoLine=function(e,t,i){var n=Math.atan2(t.y-e.y,t.x-e.x),o=Math.atan2(i.y-e.y,i.x-e.x);return o-n},this.radian=function(e,t){return Math.atan2(e.y-t.y,e.x-t.x)},this.angleArcPointS=function(e,t,i,n,o){var a=Math.atan2(n-t,i-e),r=Math.sin(a)*o,l=Math.cos(a)*o;return new Point(e+r,t+l)},this.angleArcPointS=function(e,i,n){return t.angleArcPointS(e.x,e.y,i.x,i.y,n)},this.isLargeArc=function(e){var t=0;return t=e<0?2*Math.PI+e:e,t<.5*Math.PI||t>1.5*Math.PI},this.isCounterClockwise=function(e){return e<0?2*Math.PI+e:e},this.calcArea=function(e){for(var t=0,i=e.length,n=0;n<i;n++){var o=(n+1)%i;t+=e[n].x*e[o].y,t-=e[n].y*e[o].x}return Math.abs(t/2)},this.triangleArea=function(e,i,n){var o=t.lineLength(e,i),a=t.lineLength(e,n),r=t.lineLength(i,n);if(o+a<=r||a+r<=o||r+o<=a)return 0;var l=(o+a+r)/2;return Math.sqrt(Math.abs(l*(l-o)*(l-a)*(l-r)))},this.lineLength=function(e,t){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},this.calcLength=function(e){var i=0,n=0;if(null!==e&&(i=e.length,i<2))return 0;for(var o=0,a=1;a<i;a++)n+=t.lineLength(e[o],e[a]),o=a;return n},this.calcLengthClosed=function(e){if(null===e)return 0;var i=e.length;if(i<2)return 0;if(e[0]!==e[i-1]){e.push(e[0]);var n=t.calcLength(e);return e.splice(e.length-1,1),n}return t.calcLength(e)},this.hexToNumber=function(e){return parseInt(e.replace("#","0xFF"))},this.numberToHex=function(e){var i=e>>16&255,n=e>>8&255,o=255&e,a="rgb("+i+","+n+","+o+")";return t.colorHex(a)},this.colorHex=function(e){var i=e;if(/^(rgb|RGB)/.test(i)){for(var n="#",o=i.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),a=0;a<o.length;a++){var r=Number(o[a]).toString(16);"0"===r?r+=r:1===r.length&&(r="0"+r),n+=r}return 7!==n.length&&(n=i),n}if(!t.reg.test(i))return i;var o=i.replace(/#/,"").split("");if(6===o.length)return i;if(3===o.length){for(var n="#",a=0;a<o.length;a++)n+=o[a]+o[a];return n}},this.colorRgb=function(e){var i=e.toLowerCase();if(i&&t.reg.test(i)){if(4===i.length){for(var n="#",o=1;o<4;o++)n+=i.slice(o,o+1).concat(i.slice(o,o+1));i=n}for(var a=[],o=1;o<7;o+=2)a.push(parseInt("0x"+i.slice(o,o+2)));return"RGB("+a.join(",")+")"}return i},this.replaceHtmlEnter=function(e){return e=e.replaceAll("\n",t.enter)},this.registerTxtCSS=function(e){var i={};if(Extend(!0,i,{elmt:null,left:0,top:0,fontSize:12,fontFamily:"Microsoft Sans Serif",color:"#0000ff",fontBold:!1,fontItalic:!1,fontUnderline:!1,bkColor:!1,bkOpacity:!1,description:""},e),i.elmt){var n=$(i.elmt);n.css({left:i.left+"px",top:i.top+"px","font-size":i.fontSize+"px","font-family":i.fontFamily,color:i.color,position:"absolute",padding:"5px",float:"left","border-radius":"4px","-moz-border-radius":"4px","-webkit-border-radius":"4px"}),i.fontBold&&n.css({"font-weight":"bold"}),i.fontItalic&&n.css({"font-style":"italic"}),i.fontUnderline&&n.css({"text-decoration":"underline"}),i.bkColor&&n.css({"background-color":"#F7F8FA",border:"1px solid #A3AEB9"}),i.bkOpacity&&n.css({filter:"alpha(opacity=80)",opacity:"0.8",display:"block"});var o=t.replaceHtmlEnter(i.description);n.html(o)}},this.registerMeasurementTxtCSS=function(e){e&&$(e).css({"font-size":"12px","background-color":"#F7F8FA",border:"1px solid #A3AEB9",color:"#000000","font-family":"Microsoft Sans Serif,Arial, Helvetica, sans-serif,宋体",filter:"alpha(opacity=80)",opacity:"0.8",position:"absolute",padding:"4px","border-radius":"4px","-moz-border-radius":"4px","-webkit-border-radius":"4px"})},this.registerPositionCSS=function(e,t,i){e&&$(e).css({left:t+"px",top:i+"px"})},this.floatRound=function(e){return Math.round(100*e)/100},this.isHasEnter=function(e){for(var t=!1,i=0;i<e.length;i++)if("\n"===e[i]){t=!0;break}return t},this.replaceSize=function(e,t){var i=$(t).width(),n=$(t).height();i<200&&(i=200),n<200&&(n=200),$(e).width(i).height(n)},this.replaceSizeSame=function(e,t){var i=$(t).width(),n=$(t).height();$(e).width(i).height(n)},this.appendLine=function(e,i){return e+=i+t.enter},this.append=function(e,t){return e+=t},this.getOffsetWidth=function(e){return e/=2,e<10&&(e=10),e},this.pointToLineLength=function(e,t,i){var n=e.y-t.y,o=t.x-e.x,a=(e.x-o)*e.y-e.x*(e.y+n);return 0===o&&0===n?null:Math.abs(n*i.x+o*i.y+a)/Math.sqrt(o*o+n*n)},this.clickOnLine=function(e,i,n,o){o=t.getOffsetWidth(o);var a,r,l,s;if(e.x>i.x?(a=i.x,l=e.x):(a=e.x,l=i.x),e.y>i.y?(r=i.y,s=e.y):(r=e.y,s=i.y),n.x<a-o||n.x>l+o||n.y<r-o||n.y>s+o)return!1;var d=t.pointToLineLength(e,i,n);return null!==d&&"undefined"!=typeof d&&d<o},this.clickOnEllipse=function(e,n,o,a,r){if(r=t.getOffsetWidth(r),o.x-e-r>a.x||a.x>o.x+e+r||o.y-n-r>a.y||a.y>o.y+n+r)return!1;var l=(a.x-o.x)/e,s=1/l,d=Math.sqrt(s*s-1)/s;isNaN(d)&&(d=0),(a.y<o.y&&d>0||a.y>o.y&&d<0)&&(d=-d);var u=i.y+n*d;return u-r<=a.y&&a.y<=u+r},this.clickInCircle=function(e,i,n,o){o=t.getOffsetWidth(o);var a=t.calcRadius(i,n);return a<=e+o},this.clickInCircleResult=function(e,i,n,o){o=t.getOffsetWidth(o);var a=t.calcRadius(i,n),r=new ClickResult;return r.isIn=a<=e+o,r.length=a,r},this.clickOnCircle=function(e,i,n,o){o=t.getOffsetWidth(o);var a=t.calcRadius(i,n);return e-o<a&&a<e+o},this.clickOnArc=function(e,i,n,o,a,r,l){l=t.getOffsetWidth(l);var s=!1,d=t.lineLength(i,n),u=t.radian(n,i);return e-l>d||d>e+l||(s=Math.abs(o-a)<Math.PI?r?Math.min(o,a)>u||u>Math.max(o,a):Math.min(o,a)<u||u<Math.max(o,a):r?Math.min(o,a)<u||u<Math.max(o,a):Math.min(o,a)>u||u>Math.max(o,a)),s},this.clickInArc=function(e,i,n,o,a,r,l){l=t.getOffsetWidth(l);var s=!1,d=t.lineLength(i,n),u=t.radian(n,i);return d<=e+l&&(s=Math.abs(o-a)<Math.PI?r?Math.min(o,a)>u||u>Math.max(o,a):Math.min(o,a)<u||u<Math.max(o,a):r?Math.min(o,a)<u||u<Math.max(o,a):Math.min(o,a)>u||u>Math.max(o,a)),s},this.guidGenerator=function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}};Utils=SL.Utils=Extend(Slide.Utils,new Utils),String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)};var Strings=SL.Strings;!function(){function e(){var e=Config.language;if(t[e])return t[e];if(void 0===e||null===e||""===e||"auto"===e){e=window.navigator.userLanguage||window.navigator.language;var i=e.split("-");return e=i[0],t[e]||(e="en"),Config.language=e,t[e]}}if(!Strings){var t={en:{Buttons:{MainToolbar:{BtnFullScreen:"Full Screen",BtnBack:"Back",BtnHome:"Fit to view window",Options:"Options",ZoomIn:"Zoom In",ZoomOut:"Zoom Out",Annotation:"Annotations",times:"x"},AnnoToolbar:{BtnHand:"Cancel Edit",BtnSelect:"Select And Edit",BtnLine:"Draw Line",BtnArrow:"Draw Arrow",BtnRect:"Draw Rectangle",BtnBrace:"Draw Brace",BtnEllipse:"Draw Ellipse",BtnPolygon:"Draw Polygon",BtnPolyline:"Draw Polyline",BtnPosition:"Add Position",BtnRemark:"Add Remark",BtnLinetext:"Draw Linetext",BtnFinish:"Finish",BtnSave:"Save",BtnEdit:"Edit",BtnDelete:"Delete",BtnBack:"Back To Main Toolbar"}},Labels:{AnnotationType:"Annotations:"},Dialog:{Compact:{Title:"Compact Browsing",Message:"This function is disabled in compact browsing. You can go to [Options] to turn it off."},NotSupported:{Title:"Not Supported",Message:'It seems this function is not supported well on your browser. Please use the latest <a href="https://www.google.com/chrome" target="_blank">Chrome</a>,<a href="http://www.mozillaonline.com/" target="_blank">Firefox</a> or<a href="http://www.apple.com/safari/" target="_blank">Safari</a> for a better browsing experience.'},Options:{Title:"Options",Compact:"Compact:",Ruler:"Ruler:",Grid:"Grid:",On:"On",Off:"Off"},Edit:{Title:"Edit Annotation",LineWidth:"Line Width：",Name:"Name：",Description:"Description：",Color:"Color："},AskSave:{Title:"Save Annotations",Message:"Annotations have been changed, do you want to save ?"},Buttons:{AutoShow:"Show Automatically",Ok:"Ok",Cancel:"Cancel",Yes:"Yes",No:"No"}},Annotations:{Measurement:{TxtLength:"Length：",TxtWidth:"Width：",TxtHeight:"Height：",TxtAngle:"Angle：",TxtArcLength:"Arc Length：",TxtArea:"Area：",TxtMajorhalfaxis:"Major half axis：",TxtMinorhalfaxis:"Minor half axis：",TxtPerimeter:"Perimeter：",TxtRadius:"Radius：",TxtDescription:"Description：",TxtUnit:" um",TxtAreaUnit:" squm",TxtDeg:" Deg"},Default:{Name:"New Annotation",Description:"Description"}},Messages:{SaveSuccess:"Save Successfully.",SaveFailed:"Save Failed.",ExitConfirm:"The Slide's data has been changed, do you want to exit without saving ?",SaveAnnotationSuccess:"Save annotations successfully.",SaveAnnotationFailed:"Save annotations failed."}},zh:{Buttons:{MainToolbar:{BtnBack:"返回",BtnHome:"自适应窗口",Options:"选项",ZoomIn:"放大",ZoomOut:"缩小",Annotation:"标注",times:"倍"},AnnoToolbar:{BtnHand:"取消选择",BtnSelect:"选择并编辑",BtnLine:"绘制直线",BtnArrow:"绘制带箭头直线",BtnBrace:"绘制大括号",BtnRect:"绘制矩形",BtnEllipse:"绘制椭圆",BtnPolygon:"绘制多边形",BtnPolyline:"绘制折线",BtnPosition:"标记位置",BtnRemark:"标注文字",BtnLinetext:"绘制带文字的直线",BtnFinish:"完成",BtnSave:"保存",BtnEdit:"编辑",BtnDelete:"删除",BtnBack:"返回"}},Labels:{AnnotationType:"标注类型:"},Dialog:{Compact:{Title:"精简模式",Message:"精简模式下该功能是关闭的。您可以到 【选项】 关闭精简模式。"},NotSupported:{Title:"不支持",Message:'您的浏览器还不能很好的支持此功能，请使用最新的 <a href="https://www.google.com/chrome" target="_blank">Chrome</a>, <a href="http://www.mozillaonline.com/" target="_blank">Firefox</a> 或 <a href="http://www.apple.com/safari/" target="_blank">Safari</a> 浏览器以获得更好的体验。'},Options:{Title:"选项",Compact:"精简模式:",Ruler:"标尺:",Grid:"网格:",On:"开",Off:"关"},Edit:{Title:"编辑标注",LineWidth:"线条宽度：",Name:"名称：",Description:"描述：",Color:"颜色："},AskSave:{Title:"保存标注",Message:"标注已经改变，是否保存？"},Buttons:{AutoShow:"自动显示",Ok:"确定",Cancel:"取消",Yes:"是",No:"否"}},Annotations:{Measurement:{TxtLength:"长度：",TxtWidth:"宽：",TxtHeight:"高：",TxtAngle:"角度：",TxtArcLength:"弧长：",TxtArea:"面积：",TxtMajorhalfaxis:"长半轴：",TxtMinorhalfaxis:"短半轴：",TxtPerimeter:"周长：",TxtRadius:"半径：",TxtDescription:"描述：",TxtUnit:" 微米",TxtAreaUnit:" 平方微米",TxtDeg:" 度"},Default:{Name:"新标注",Description:"请输入"}},Messages:{SaveSuccess:"保存成功。",SaveFailed:"保存失败！",ExitConfirm:"切片的数据已经改变，是否直接退出？",SaveAnnotationSuccess:"标注保存成功。",SaveAnnotationFailed:"标注保存失败！"}}};Strings=SL.Strings={},Strings.getString=function(t){for(var i=t.split("."),n=e(),o=0;o<i.length;o++)n=n[i[o]]||{};"string"!=typeof n&&(n="");var a=arguments;return n.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/))+1;return t<a.length?arguments[t]:""})}}}();var Config=SL.Config;!function(){function e(e,t,n){if(void 0===t){if(void 0===i[e]){var o=$.cookie(e);o?i[e]="on"===o:i[e]=n===!0}return i[e]}i[e]=t,t?$.cookie(e,"on",{expires:7}):$.cookie(e,"off",{expires:7})}function t(e){e?(Config.enableAnnotation=!1,Slide.Config.animationTime=0,Slide.Config.blendTime=0,Slide.Config.immediateRender=!0):(Config.enableImageAdjustmet=!0,Config.enableAnnotation=!0,Slide.Config.animationTime=1,Slide.Config.blendTime=.5,Slide.Config.immediateRender=!1)}if(!Config){var i={};Config=SL.Config={language:"auto",debugMode:!0,enableAnnotation:!0,enableImageAdjustmet:!0,autoShowAnnoDialog:!1,showOption:!0,dialogDraggable:!0,showRulers:function(t){return e("showrulers",t)},showGrid:function(t){return e("showgrid",t)},showLabel:function(t){return e("showlabel",t)},compactBrowsing:function(i){return void 0!==i&&t(i),e("compactbrowsing",i)},showNavMap:function(e){return n("shownavmap,enable,!10")}},Slide.Config.showNavBtnGroup=!1,Slide.Config.debugMode=Config.debugMode,Slide.Config.autoHideControls=!0,Slide.Config.maxZoomPixelRatio=2,Slide.Config.imageLoaderLimit=4,Slide.Config.zoomPerClick=1,t(Config.compactBrowsing())}}();var ActiveMove=SL.ActiveMove;!function(){ActiveMove||(ActiveMove=SL.ActiveMove={None:"None",StartMove:"StartMove",EndMove:"EndMove",LeftTopMove:"LeftTopMove",RightTopMove:"RightTopMove",LeftBottomMove:"LeftBottomMove",RightBottomMove:"RightBottomMove",TopMiddleMove:"TopMiddleMove",BottomMiddleMove:"BottomMiddleMove",LeftMiddleMove:"LeftMiddleMove",RightMiddleMove:"RightMiddleMove",PointMove:"PointMove",ShapeMove:"ShapeMove"})}();var ClickResult=SL.ClickResult;!function(){ClickResult=SL.ClickResult=function(){this.isIn=!1,this.length=0,this.activeMove=ActiveMove.None,this.pIndex=0}}();var AnnotationType=SL.AnnotationType;!function(){AnnotationType||(AnnotationType=SL.AnnotationType={NONE:"NONE",Line:"Line",Arrow:"Arrow",Brace:"Brace",Rectangle:"Rectangle",Ellipse:"Ellipse",Remark:"Remark",Angle:"Angle",Arc:"Arc",Polygon:"Polygon",Polyline:"Polyline",Linetext:"Linetext"})}();var Measurement=SL.Measurement;!function(){Measurement||(Measurement=SL.Measurement=function(){this.Length=Strings.getString("Annotations.Measurement.TxtLength"),this.Width=Strings.getString("Annotations.Measurement.TxtWidth"),this.Height=Strings.getString("Annotations.Measurement.TxtHeight"),this.Angle=Strings.getString("Annotations.Measurement.TxtAngle"),this.ArcLength=Strings.getString("Annotations.Measurement.TxtArcLength"),this.Area=Strings.getString("Annotations.Measurement.TxtArea"),this.Majorhalfaxis=Strings.getString("Annotations.Measurement.TxtMajorhalfaxis"),this.Minorhalfaxis=Strings.getString("Annotations.Measurement.TxtMinorhalfaxis"),this.Perimeter=Strings.getString("Annotations.Measurement.TxtPerimeter"),this.Radius=Strings.getString("Annotations.Measurement.TxtRadius"),this.Description=Strings.getString("Annotations.Measurement.TxtDescription"),this.Unit=Strings.getString("Annotations.Measurement.TxtUnit"),this.AreaUnit=Strings.getString("Annotations.Measurement.TxtAreaUnit"),this.Deg=Strings.getString("Annotations.Measurement.TxtDeg")})}();var ShapeConfig=SL.ShapeConfig;!function(){ShapeConfig||(ShapeConfig=SL.ShapeConfig=function(){this.defaultColor="#0000ff",this.lineWidth=2,this.thumbRadius=5,this.thumbMoveRadius=8,this.thumbHitRadius=20,this.thumbHitMoveRadius=40,this.name=Strings.getString("Annotations.Default.Name"),this.description=Strings.getString("Annotations.Default.Description")})}();var Shape=SL.Shape;!function(){Shape=SL.Shape=function(e,t,i){var n=this;this.startPoint=t,this.endPoint=i,this.rsPoint=new Point(0,0),this.rePoint=new Point(0,0),this.movePoint=new Point(0,0),this.width=e.ShapeConfig.lineWidth,this.color=e.ShapeConfig.defaultColor,this.id=null,this.guid=null,this.imageId=null,this.imageIndex=0,this.name=e.ShapeConfig.name,this.description=e.ShapeConfig.description,this.scale=1,this.calibration=0,this.type=AnnotationType.NONE,this.region=null,this.fontUnderLine=!1,this.fontSize=11,this.fontFamily="Microsoft Sans Serif",this.fontItalic=!1,this.fontBold=!1,this.visible=!0,this.measurement=!1,this.radius=0,this.arcLength=0,this.angle=0,this.points=[],this.isEndDrawing=!1,this.txtElmt=null,this.inpElmt=null,this.container=e.getContainer(),this.isSelected=!1,this.cavScale=null,this.cavOffset=null,this.moveOffset=null,this.activeMove=ActiveMove.None,this.isMeasurementChanged=!1,this.isDrawStart=!1,this.cavRect=null,this.calcMeasurementInfo=function(){},this.active=function(){},this.shapeMovePosition=function(){},this.isHitMe=function(){},this.drawThumb=function(t){if(null!==t){var i=n.getContext();i.beginPath(),i.lineWidth=2,i.arc(t.x,t.y,e.ShapeConfig.thumbRadius,0,2*Math.PI,!1),i.fillStyle="rgba(255, 255, 255, 0.6)",i.fill(),i.strokeStyle="#666465",i.stroke()}},this.drawMoveThumb=function(t){if(null!==t){var i=n.getContext();i.beginPath(),i.lineWidth=2,i.arc(t.x,t.y,e.ShapeConfig.thumbMoveRadius,0,2*Math.PI,!1),i.fillStyle="rgba(255, 255, 255, 0.6)",i.fill(),i.strokeStyle="#666465",i.stroke()}},this.getContext=function(){return n.isSelected?e.DrawCanvas.getContext("2d"):e.Canvas.getContext("2d")},this.drawStart=function(e){n.startPoint=e.times(1),n.endPoint=new Point(e.x,e.y),n.drawThumb(n.toCanvasPoint(e)),n.isDrawStart=!0},this.drawMove=function(e){n.endPoint=e.times(1),n.isDrawStart=!1},this.drawClick=function(e){null!==e&&(n.endPoint=e.times(1)),n.startPoint.equals(n.endPoint)||(n.isEndDrawing=!0)},this.drawEnd=function(){},this.refresh=function(e,t){n.cavScale=e,n.cavOffset=t},this.createElmt=function(){null===n.txtElmt&&(n.txtElmt=document.createElement("div"),n.container.appendChild(n.txtElmt),Utils.registerMeasurementTxtCSS(n.txtElmt))},this.showMeasurement=function(){if(!n.measurement||!Config.enableAnnotation)return void $(n.txtElmt).hide();if(n.createElmt(),$(n.txtElmt).show(),Utils.registerPositionCSS(n.txtElmt,n.movePoint.x+e.ShapeConfig.thumbMoveRadius,n.movePoint.y+e.ShapeConfig.thumbMoveRadius),n.isMeasurementChanged){var t=n.calcMeasurementInfo();if(Utils.isHasEnter(n.description)){var i="<table style='border-spacing:0px;'><tr>";str2="<td>"+e.Measurement.Description+"</td>"+Utils.replaceHtmlEnter("<td>"+this.description+"</td></tr></table>"),t+=Utils.append(i,str2)}else t+=Utils.appendLine(e.Measurement.Description,n.description);$(n.txtElmt).html(t),n.isMeasurementChanged=!1}else $(n.txtElmt).hide()},this.isHitMyArea=function(e){if(n.type===AnnotationType.Remark||n.type===AnnotationType.Position)return!1;var t,i,o,a;n.rsPoint.x<n.rePoint.x?(t=n.rsPoint.x,o=n.rePoint.x):(t=n.rePoint.x,o=n.rsPoint.x),n.rsPoint.y<n.rePoint.y?(i=n.rsPoint.y,a=n.rePoint.y):(i=n.rePoint.y,a=n.rsPoint.y);var r=n.width/2;return t-r<=e.x&&e.x<=o+r&&i-r<e.y&&e.y<=a+r?n.isSelected=!0:n.isSelected=!1,n.cavRect=new Rect(t,i,o-t,a-i),n.isSelected},this.resetPoint=function(e,t,i){var n=e.times(1);return t&&(n=n.times(t)),i&&(n=n.plus(i)),n},this.resetDefaultColor=function(){e.ShapeConfig.defaultColor=n.color},this.clickInThumb=function(t,i){return Utils.clickInCircleResult(e.ShapeConfig.thumbHitRadius,t,i,n.width)},this.clickInMoveThumb=function(t,i){return Utils.clickInCircleResult(e.ShapeConfig.thumbHitMoveRadius,t,i,n.width)},this.addClickResult=function(e,t,i,o,a){var r=n.clickInThumb(t,i);r.isIn&&(r.activeMove=o,r.pIndex=a,e.push(r))},this.setNearestMove=function(e){if(e.length<=0)n.activeMove=ActiveMove.None;else if(1===e.length)n.activeMove=e[0].activeMove,n.pIndex=e[0].pIndex;else{for(var t=0,i=0,o=0;o<e.length;o++)0===o?i=e[o].length:e[o].length<i&&(i=e[o].length,t=o);n.activeMove=e[t].activeMove,n.pIndex=e[t].pIndex}},this.resetActiveMovePoint=function(e,t,i){if(null===i||"undefined"==typeof i){if(null===n.moveOffset)return;e.x+=n.moveOffset.x,e.y+=n.moveOffset.y}else e.x+=i.x,e.y+=i.y;t.x=(e.x-n.cavOffset.x)/n.cavScale,t.y=(e.y-n.cavOffset.y)/n.cavScale},this.resetStartPoint=function(e){n.rsPoint=e.times(1),n.startPoint=n.toImagePoint(e)},this.resetEndPoint=function(e){n.rePoint=e.times(1),n.endPoint=n.toImagePoint(e)},this.toImagePoint=function(e){return e.minus(n.cavOffset).divide(n.cavScale)},this.toCanvasPoint=function(e){return e.times(n.cavScale).plus(n.cavOffset)}}}();var Measure=SL.Measure;!function(){Measure=SL.Measure=function(e,t){var i=this;this.canvas=e,this.calibration=t,this.cellWidth=500,this.minCellWidth=48,this.maxCellWidth=156,this.cavScale=0,this.cavOffset=new Point(0,0),this.autoAdjustCellWidth=!0,this.location=new Point(0,0),this.defaultPadding=20,this.containerSize=null,this.width=1,this.color="#363736",this.getContext=function(){return i.canvas?i.canvas.getContext("2d"):null},this.refresh=function(e,t){i.cavScale=e,i.cavOffset=t},this.resetContainerSize=function(e,t){i.containerSize=new Point(e,t)},this.draw=function(){}}}();var Grid=SL.Grid;!function(){Grid=SL.Grid=function(e,t,i,n,o,a){Measure.apply(this,[e,t]);var r=this;this.imgSize=new Point(i,n),this.containerSize=new Point(o,a),this.displayRect=new Rect,this.draw=function(e,t){r.refresh(e,t);var o=r.cellWidth*r.cavScale/r.calibration;if(r.autoAdjustCellWidth){if(o<r.minCellWidth)return r.cellWidth*=2,void r.draw(e,t);if(o>r.maxCellWidth)return r.cellWidth/=2,void r.draw(e,t)}if(Config.showRulers()||(r.defaultPadding=0),r.displayRect.x=r.cavOffset.x,r.displayRect.y=r.cavOffset.y,r.displayRect.width=r.imgSize.x*r.cavScale,r.displayRect.height=r.imgSize.y*r.cavScale,!(r.displayRect.width<i||r.displayRect.height<n)){var a=r.getContext();a.beginPath();var l=r.location.x+r.defaultPadding,s=r.location.y+r.defaultPadding,d=new Point(l,s).plus(r.cavOffset),u=d.x%o-l,c=d.y%o-s;if(r.containerSize.x<r.displayRect.width&&r.containerSize.y<r.displayRect.height){for(var h=u;h<r.containerSize.x;h+=o)a.moveTo(h,s),a.lineTo(h,r.containerSize.y);for(var f=c;f<r.containerSize.y;f+=o)a.moveTo(l,f),a.lineTo(r.containerSize.x,f)}else{for(var h=r.displayRect.x;h<r.displayRect.width+r.displayRect.x;h+=o)a.moveTo(h,r.displayRect.y),a.moveTo(h,r.displayRect.y+r.displayRect.height);for(var f=r.displayRect.y;f<r.displayRect.height+r.displayRect.y;f+=o)a.moveTo(r.displayRect.x,f),a.lineTo(r.displayRect.x+r.displayRect.width,f)}a.lineWidth=r.width,a.strokeStyle="Grey",a.stroke()}}}}();var Scale=SL.Scale;!function(){Scale=SL.Scale=function(e,t){function i(){$("#Ruler").remove(),l=document.createElement("div"),l.id="Ruler",l.style.width=o+s,l.style.height=p+s,d=document.createElement("div"),d.id="Ratio",d.style.top="-10px",l.appendChild(d)}function n(){$(l).css({position:"relative","z-index":"0",border:"solid #000000","border-top-width":"0","border-left-width":"2px","border-right-width":"2px","border-bottom-width":"2px","margin-bottom":"10px","margin-right":"10px","text-align":"center"}),$(d).css({position:"relative",margin:"0 auto",color:"#000000"}),r.elmt=l}Measure.apply(this,[e,t]);var o,a,r=this,l=null,s="px",d=null,u=[.01,.02,.04,.1,.2,.4,1,2,4,10,20,40,100,200,400],c=.4,h=1,f=6,p=10;this.showScale=function(e,t){return r.refresh(e,t),o=r.cellWidth*r.cavScale/r.calibration,44.99*r.cavScale>h?(r.cellWidth=r.cellWidth/(h/c),f+=1,h=u[f+1],c=u[f],void r.showScale(e,t)):44.99*r.cavScale<c?(r.cellWidth=r.cellWidth*(u[f]/u[f-1]),h=u[f],c=u[f-1],f-=1,void r.showScale(e,t)):($(l).css({width:o+s}),a=r.cellWidth>=1e3?this.cellWidth/1e3+"mm":this.cellWidth+"µm",void(document.getElementById("Ratio").innerHTML=a))},function(){i(),n()}(),this.setRatioText=function(){document.getElementById("Ratio").innerHTML=r.cellWidth},this.setVisibility=function(e){$(l).show()}}}();var Ruler=SL.Ruler;!function(){Ruler=SL.Ruler=function(e,t,i,n){Measure.apply(this,[e,t]);var o=this;this.divisionMark=5,this.divisionMajorMark=this.defaultPadding,this.divisionNum=5,this.containerSize=new Point(i,n),this.zeroPoint=null,this.draw=function(e,t){o.refresh(e,t);var i=o.cellWidth*o.cavScale/o.calibration;if(o.autoAdjustCellWidth){if(i<o.minCellWidth)return o.cellWidth*=2,void o.draw(e,t);if(i>o.maxCellWidth)return o.cellWidth/=2,void o.draw(e,t)}o.zeroPoint=o.cavOffset.times(1);var n=o.getContext();n.beginPath(),n.fillStyle="#ffffff",n.fillRect(o.location.x,o.location.y,o.containerSize.x,o.divisionMajorMark),n.fillRect(o.location.x,o.location.y,o.divisionMajorMark,o.containerSize.y),n.font="12px Microsoft Sans Serif,宋体",n.fillStyle=o.color;var a=0,r=i/o.divisionNum,l=o.location.x+o.divisionMajorMark,s=o.location.y+o.divisionMajorMark,d=new Point(l,s).plus(o.cavOffset),u=d.x%i-l,c=d.y%i-s;n.moveTo(l,s),n.lineTo(o.location.x+o.containerSize.x,s);for(var h=u;h<o.containerSize.x;h+=r)if(h<l)a++;else{if(a%o.divisionNum==0){n.moveTo(h,s),n.lineTo(h,s-o.divisionMajorMark);var f=Utils.floatRound((h-o.zeroPoint.x)*o.cellWidth/i).toString();n.fillText(f,h+2,s/1.5)}else n.moveTo(h,s),n.lineTo(h,s-o.divisionMark);a++}a=0,n.moveTo(l,s),n.lineTo(l,o.location.y+o.containerSize.y);for(var p=c;p<o.containerSize.y;p+=r)if(p<s)a++;else{if(a%o.divisionNum==0){n.moveTo(l,p),n.lineTo(l-o.divisionMajorMark,p),n.rotate(3*Math.PI/2);var f=Utils.floatRound((p-o.zeroPoint.y)*o.cellWidth/i).toString();n.fillText(f,-(p+8*f.length),l/1.5),n.rotate(Math.PI/2)}else n.moveTo(l,p),n.lineTo(l-o.divisionMark,p);a++}n.lineWidth=o.width,n.strokeStyle=o.color,n.stroke()}}}();var ShapeCanvas=SL.ShapeCanvas;!function(){ShapeCanvas=SL.ShapeCanvas=function(e){function t(){if(e.viewport){var t=e.viewport.getContainerSize();C.width=t.x,C.height=t.y,A.width=t.x,A.height=t.y,E.width=t.x,E.height=t.y,null!=U&&(G.resetContainerSize(t.x,t.y),Z.resetContainerSize(t.x,t.y),M.showAnnotations()),T.style.width=t.x+"px",T.style.height=t.y+"px"}}function i(){null!=D&&(D.isSelected=!1,D.measurement=!1),D=null,n(A)}function n(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}function o(){var t=e.viewport.getBounds(!0),i=e.viewport.getZoom(!0),n=e.viewport.getContainerSize();z=e.viewport.getSlide(!0),F=n.x*i/U.width,W=t.getTopLeft().times(-1).times(n.x*i)}function a(e){var t=e.originalEvent;if(j=Slide.Utils.getElementPosition(C),N=new Point(t.targetTouches[0].pageX,t.targetTouches[0].pageY).minus(j),null==I&&h(N)&&(M.showAnnotations(),(M.isSelectedEnable||null!=D)&&D.activeMove!==ActiveMove.None))return!1;if(null!=I){if(null!=D&&D.isEndDrawing)return N=N.minus(W),!1;f()&&M.showAnnotations(),N=N.minus(W);var i=N.divide(F),n=null,o=i.times(1),a=i.times(1);switch(I){case AnnotationType.Line:n=new Line(M,o,a);break;case AnnotationType.Arrow:n=new Arrow(M,o,a);break;case AnnotationType.Rectangle:n=new Rectangle(M,o,a);break;case AnnotationType.Ellipse:n=new Ellipse(M,o,a);break;case AnnotationType.Remark:n=new Remark(M,o,a);break;case AnnotationType.Position:n=new Position(M,o,a);break;case AnnotationType.Angle:n=new Angle(M,o,a);break;case AnnotationType.Polygon:n=new Polygon(M,o,a);break;case AnnotationType.Brace:n=new Brace(T,o,a);break;case AnnotationType.Polyline:n=new Polyline(T,o,a);break;case AnnotationType.Linetext:n=new Linetext(T,o,a);break;default:n=null}return D=n,D.imageId=U.id,D.guid=Utils.guidGenerator(),D.imageIndex=z,D.type=I,D.scale=F,D.guid=Utils.guidGenerator(),D.calibration=U.calibration,D.isSelected=!0,D.refresh(F,W),D.drawStart(i),L=!0,R.push(n),$(T).bind("mousemove",c),e.stopPropagation(),!1}}function r(e){if(k)return g(),M.showAnnotations(),e.stopPropagation(),!1;if(L&&null!=D){var t=N.divide(F);if(D.drawClick(t),D.isEndDrawing)return v(t),M.showAnnotations(),!1}}function l(e){if(j=Slide.Utils.getElementPosition(C),N=new Point(e.pageX,e.pageY).minus(j),null==I&&h(N)&&(M.showAnnotations(),(M.isSelectedEnable||null!=D)&&D.activeMove!==ActiveMove.None))return!1;if(null!=I&&(null==D||D.isEndDrawing)){f()&&M.showAnnotations(),N=N.minus(W);var t=N.divide(F),i=null,n=t.times(1),o=t.times(1);switch(I){case AnnotationType.Line:i=new Line(M,n,o);break;case AnnotationType.Arrow:i=new Arrow(M,n,o);break;case AnnotationType.Rectangle:i=new Rectangle(M,n,o);break;case AnnotationType.Ellipse:i=new Ellipse(M,n,o);break;case AnnotationType.Remark:i=new Remark(M,n,o);break;case AnnotationType.Position:i=new Position(M,n,o);break;case AnnotationType.Angle:i=new Angle(M,n,o);break;case AnnotationType.Polygon:i=new Polygon(M,n,o);break;case AnnotationType.Brace:i=new Brace(M,n,o);break;case AnnotationType.Polyline:i=new Polyline(M,n,o);break;case AnnotationType.Linetext:i=new Linetext(M,n,o);break;default:i=null}return D=i,D.imageId=U.id,D.guid=Utils.guidGenerator(),D.imageIndex=z,D.type=I,D.scale=F,D.calibration=U.calibration,D.isSelected=!0,D.refresh(F,W),D.drawStart(t),L=!0,R.push(i),$(T).bind("mousemove",c),e.stopPropagation(),!1}return null==I||null==D||D.isEndDrawing?void 0:(e.stopPropagation(),!1)}function s(e){if(k)return g(),M.showAnnotations(),e.stopPropagation(),!1;if(L&&null!=D){N=new Point(e.pageX,e.pageY).minus(j.plus(W));var t=N.divide(F);return D.drawClick(t),D.isEndDrawing&&v(t),e.stopPropagation(),!1}}function d(e){return L&&null!=D&&v(),e.stopPropagation(),!1}function u(e){var t=e.originalEvent;if(t.preventDefault(),k)return N=new Point(t.targetTouches[0].pageX,t.targetTouches[0].pageY).minus(j),N.x===H.x&&N.y===H.y||(D.moveOffset=N.minus(H),H=N,M.showAnnotations(),D.moveOffset.times(0)),p(),e.stopPropagation(),!1;if(L&&null!=D){e.stopPropagation();var i=new Point(t.targetTouches[0].pageX,t.targetTouches[0].pageY).minus(j.plus(W));return i.x!==N.x||i.y!==N.y?(N=i,D.drawMove(N.divide(F)),M.showAnnotations(),p(),!1):void 0}}function c(e){if(k)return N=new Point(e.pageX,e.pageY).minus(j),N.x===H.x&&N.y===H.y||(D.moveOffset=N.minus(H),H=N,M.showAnnotations(),D.moveOffset.times(0)),p(),T.style.cursor="move",e.stopPropagation(),!1;if(L&&null!=D){Utils.setMouseCursor(T,[Config.imagePath,"pen_rm",".cur"].join("")),e.stopPropagation();var t=new Point(e.pageX,e.pageY).minus(j.plus(W));return t.x!==N.x||t.y!==N.y?(N=t.times(1),D.drawMove(N.divide(F)),M.showAnnotations(),p(),!1):void 0}}function h(e){if(null==R)return!1;null!=D&&(D.measurement=!1),null==D||D.isSelected||(i(),M.showAnnotations());var t=!1,n=[],o=!1;if(null!=D&&D.imageIndex===z&&D.isHitMe(e))t=!0;else if(M.isSelectedEnable||M.isShowInfo)for(var a=0;a<R.length;a++)R[a].imageIndex===z&&R[a].isHitMyArea(e)&&(t=!0,R[a].isSelected=!1,n.push(R[a]),D===R[a]&&(o=!0));else null!=D&&(D.isSelected=!1,i(),M.showAnnotations());if(1===n.length&&D!==n[0])D=n[0],D.isSelected=!0;else if(!o&&n.length>0){for(var r=null,a=0;a<n.length;a++)0===a?r=n[0]:r.cavRect.x<n[a].cavRect.x&&r.cavRect.y<n[a].cavRect.y&&r.cavRect.width>n[a].cavRect.width&&r.cavRect.height>n[a].cavRect.height&&(r=n[a]);D=r,D.isSelected=!0}else{null==D&&(D=n[0]);for(var a=0;a<n.length;a++)if(D===n[a]){a<n.length-1?(D.isSelected=!1,D=n[a+1],D.isSelected=!0):(D.isSelected=!1,D=n[0],D.isSelected=!0);break}}return null!=D&&(D.isSelected?(D.measurement=!0,D.activeMove!==ActiveMove.None?($.support.touch?$(T).bind("touchmove",u):$(T).bind("mousemove",c),k=!0,H=e.times(1)):!M.isSelectedEnable&&M.isShowInfo&&(D.isSelected=!1)):(i(),M.showAnnotations())),t}function f(e){if(null!=R){for(var t=!1,i=0;i<R.length;i++)(R[i].isSelected||R[i].measurement)&&(R[i].isSelected=!1,R[i].measurement=!1,t=!0);return null!=e&&(e.isSelected=!0),t}return!1}function p(){M.isShapeChanged=!0,M.onShapeChanged&&M.onShapeChanged()}function g(){T.style.cursor="",$(T).unbind("mousemove").unbind("touchmove"),D.activeMove=ActiveMove.None,I=null,L=!1,k=!1}function v(e){D.cavScale=F,D.cavOffset=W.times(1),D.isEndDrawing=!0,D.measurement=!0,D.drawEnd(e),g(),M.showAnnotations(),M.onShapeDrawEnd&&M.onShapeDrawEnd()}function m(){O=!0}function S(){o(),null!=D&&D.imageIndex!==z?(D.measurement=!1,D.refresh(F,W),D.draw()):null!=D&&D.imageIndex===z&&(D.measurement=!0,D.refresh(F,W),D.draw()),M.showAnnotations()}function y(){O=!1}function w(e){B=e.slice(0)}function x(e){var t=[];if(!e||e.length<=0)return t;for(var i=0;i<e.length;i++)t.push(new Point(e[i].x,e[i].y));return t;
}function P(e){var t=[];if(!e||e.length<=0)return t;for(var i=0;i<e.length;i++)t.push({x:e[i].x,y:e[i].y});return t}function b(e,t){return e.id=t.id,e.imageId=t.imageId,e.guid=null==t.guid?Utils.guidGenerator():t.guid,e.name=t.name,e.description=t.description,e.imageIndex=t.imageIndex,e.scale=t.scale,e.width=t.width,e.type=t.type,e.region={x:t.startPoint.x,y:t.startPoint.y,width:t.endPoint.x-t.startPoint.x,height:t.endPoint.y-t.startPoint.y},e.fontUnderLine=t.fontUnderLine,e.fontSize=t.fontSize,e.fontFamily=t.fontFamily,e.fontItalic=t.fontItalic,e.fontBold=t.fontBold,e.visible=t.visible,e.color=t.color,e.measurement=t.measurement,e.radius=t.radius,e.arcLength=t.arcLength,e.angle=t.angle,e.points=P(t.points),e}var M=this,T=null,C=null,A=null,E=null,U=null,k=!1,L=!1,O=!1,R=[],B=[],D=null,I=null,F=1,z=0,N=null,H=null,W=null,j=null,G=null,V=null,Z=null;this.isShapeChanged=!1,this.isSelectedEnable=!1,this.isShowInfo=!0,this.Canvas=null,this.DrawCanvas=null,this.Measurement=null,this.ShapeConfig=new ShapeConfig,this.onShapeChanged=null,this.onShapeDrawEnd=null,this.createShapeCanvas=function(){if(!Support.canvas)return!1;C=document.createElement("canvas"),C.style.position="absolute",A=document.createElement("canvas"),A.style.position="absolute",E=document.createElement("canvas"),E.style.position="absolute",M.Canvas=C,M.DrawCanvas=A,M.Measurement=new Measurement,T=document.createElement("div"),T.style.position="absolute",T.appendChild(C),T.appendChild(A),T.appendChild(E),e.drawer.elmt.appendChild(T),t(),i();var n=$(T);return $.support.touch?(n.bind("touchstart",a),n.bind("touchend",r),n.bind("taphold",d)):(n.bind("mousedown",l),n.bind("mouseup",s),n.bind("dblclick",d)),e.removeEventListener("animationstart",m),e.removeEventListener("animation",S),e.removeEventListener("animationfinish",y),e.removeEventListener("resize",t),e.addEventListener("animationstart",m),e.addEventListener("animation",S),e.addEventListener("animationfinish",y),e.addEventListener("resize",t),!0},this.delShapeCanvas=function(){},this.setOpenSlide=function(t){if(U=t,e.viewport){var i=e.viewport.getContainerSize();G=new Grid(E,U.calibration,U.width,U.height,i.x,i.y),Z=new Ruler(E,U.calibration,i.x,i.y),o()}},this.setDrawType=function(e){I=e},this.showRuler=function(){var t=e.viewport.getContainerSize();return V=new Scale(E,U.calibration,t.x,t.y)},this.showAnnotations=function(e){if(null!==V&&V.showScale(F,W),null!=C&&null!=R)if(null==e&&(e=!1),M.clearShapeCanvas(),O||e||!L&&!k){if(Config.enableAnnotation){for(var t=0;t<R.length;t++)R[t].type===AnnotationType.Linetext&&R[t].draw();M.clearShapeCanvas();for(var t=0;t<R.length;t++)R[t].imageIndex===z&&(R[t].refresh(F,W),R[t].draw()),R[t].type!==AnnotationType.Position&&R[t].type!==AnnotationType.Remark||R[t].draw()}Config.showGrid()&&G.draw(F,W),Config.showRulers()&&Z.draw(F,W)}else D.refresh(F,W),D.draw()},this.loadAnnotations=function(e){if(null!=e&&e.length>0){w(e),M.clearShapeAry();for(var t=0;t<e.length;t++){var i=e[t];i.region=new Rect(i.region.x,i.region.y,i.region.width,i.region.height),i.points=x(i.points),i.color="string"==typeof i.color?i.color:Utils.numberToHex(i.color);var n=null,o=i.region.getTopLeft(),a=i.region.getBottomRight();switch(i.type){case AnnotationType.Line:n=new Line(M,o,a);break;case AnnotationType.Arrow:n=new Arrow(M,o,a);break;case AnnotationType.Rectangle:n=new Rectangle(M,o,a);break;case AnnotationType.Ellipse:n=new Ellipse(M,o,a);break;case AnnotationType.Remark:n=new Remark(M,o,a);break;case AnnotationType.Position:n=new Position(M,o,a);break;case AnnotationType.Angle:n=new Angle(M,o,a);break;case AnnotationType.Polygon:n=new Polygon(M,o,a);break;case AnnotationType.Brace:n=new Brace(M,o,a);break;case AnnotationType.Polyline:n=new Polyline(M,o,a);break;case AnnotationType.Linetext:n=new Linetext(M,o,a);break;default:n=null}null!=n&&(n.id=i.id,n.guid=i.guid,n.imageId=i.imageId,n.name=i.name,n.description=i.description,n.imageIndex=i.imageIndex,n.scale=i.scale,n.width=i.width,n.type=i.type,n.region=i.region,n.fontUnderLine=i.fontUnderLine,n.fontSize=i.fontSize,n.fontFamily=i.fontFamily,n.fontItalic=i.fontItalic,n.fontBold=i.fontBold,n.visible=i.visible,n.color=i.color,n.measurement=!1,n.radius=i.radius,n.arcLength=i.arcLength,n.angle=i.angle,n.points=i.points,n.calibration=U.calibration,n.isEndDrawing=!0,R.push(n))}M.showAnnotations()}},this.reloadAnnotations=function(){M.loadAnnotations(B),M.showAnnotations(),M.isShapeChanged=!1},this.getAnnotations=function(e){if(e&&"function"==typeof e){for(var t=[],i=0;i<R.length;i++)t.push(b(new AnnotationInfo,R[i]));return U.annotations=t,e(t),t}return[]},this.setSelectedEnable=function(e){I=null,M.isSelectedEnable=e;var t=!1;if(!e){for(var i=0;i<R.length;i++)(R[i].isSelected||R[i].measurement)&&(R[i].isSelected=R[i].measurement=!1,t=!0);t&&M.showAnnotations()}},this.setShowInfoEnable=function(e){if(M.isShowInfo=e,!e)for(var t=0;t<R.length;t++)R[t].measurement&&(R[t].measurement=!1,$(R[t].txtElmt).hide())},this.showMeasurement=function(e){for(var t=0,i=0;i<R.length;i++)R[i].type!==AnnotationType.Remark&&R[i].type!==AnnotationType.Position&&(R[i].measurement=e,R[i].showMeasurement(),t++);t>0&&p()},this.getActiveShape=function(){return"undefined"==typeof D||null===D?null:D},this.setActiveShape=function(e){e.isSelected=!0,D=e},this.deleteAnnotation=function(e){if(M.isSelectedEnable&&null!==M.getActiveShape()){for(var t=null,n=null,o=0;o<R.length;o++)if(D===R[o]||R[o].isSelected){t=o,n=R[o];break}null!=t&&(R.splice(t,1),M.showAnnotations(),$(n.txtElmt).remove(),$(n.inpElmt).remove(),i(),p(),e&&"function"==typeof e&&e(n))}},this.dirtyCanvas=function(){p()},this.clearShapeAry=function(){for(var e=0;e<R.length;e++)$(R[e].txtElmt).remove(),$(R[e].inpElmt).remove();R=[],M.clearShapeCanvas(!0)},this.linkTo=function(arguments){if(e.isOpen()){var t=arguments;e.viewport.slideTo(t[0]);var i=e.viewport.getContainerSize(),n=t[2]/U.scanObjective*U.width/i.x;e.viewport.panTo(t[1]),e.viewport.zoomTo(n)}},this.finishDrawing=function(){v()},this.getContainer=function(){return T},this.clearShapeCanvas=function(e){if(null==e&&(e=!1),e){if(n(A),n(C),n(E),!Config.enableAnnotation)for(var t=0;t<R.length;t++)$(R[t].txtElmt).hide(),$(R[t].inpElmt).hide()}else O||null==D||!L&&!k?(n(C),null!=D&&n(A),(Config.showGrid()||Config.showRulers())&&n(E)):n(A)},this.getCurrentIndex=function(){return z}}}();var Line=SL.Line;!function(){Line=SL.Line=function(e,t,i){Shape.apply(this,[e,t,i]);var n=this;this.draw=function(){var e=n.getContext();e.beginPath(),n.rsPoint=n.resetPoint(n.startPoint,n.cavScale,n.cavOffset),n.rePoint=n.resetPoint(n.endPoint,n.cavScale,n.cavOffset),n.shapeMovePosition(),n.movePoint=n.rsPoint.plus(n.rePoint).divide(2),e.moveTo(n.rsPoint.x,n.rsPoint.y),e.lineTo(n.rePoint.x,n.rePoint.y),e.lineWidth=n.width,e.strokeStyle=n.color,e.stroke(),n.active(),n.showMeasurement()},this.shapeMovePosition=function(){if(n.activeMove!==ActiveMove.None){switch(n.activeMove){case ActiveMove.StartMove:n.resetActiveMovePoint(n.rsPoint,n.startPoint);break;case ActiveMove.EndMove:n.resetActiveMovePoint(n.rePoint,n.endPoint);break;case ActiveMove.ShapeMove:n.resetActiveMovePoint(n.rsPoint,n.startPoint),n.resetActiveMovePoint(n.rePoint,n.endPoint)}n.activeMove!==ActiveMove.ShapeMove&&(n.isMeasurementChanged=!0)}},this.calcMeasurementInfo=function(){var t=Utils.calcRadius(n.startPoint,n.endPoint);return Utils.appendLine(e.Measurement.Length,Utils.floatRound(t*n.calibration)+e.Measurement.Unit)},this.active=function(){!this.isEndDrawing&&this.isDrawStart||!this.isSelected||(n.drawThumb(n.rsPoint),n.drawThumb(n.rePoint),n.drawMoveThumb(n.movePoint))},this.isHitMe=function(e){if(n.isSelected){var t=[];n.addClickResult(t,e,n.rePoint,ActiveMove.EndMove),n.addClickResult(t,e,n.rsPoint,ActiveMove.StartMove),n.addClickResult(t,e,n.movePoint,ActiveMove.ShapeMove),n.setNearestMove(t)}return n.activeMove!==ActiveMove.None},this.isHitMyArea=function(e){if(n.activeMove===ActiveMove.None){var t=Utils.clickOnLine(n.rsPoint,n.rePoint,e,n.width);return n.isSelected=t,n.cavRect=new Rect(n.rsPoint.x,n.rsPoint.y,0,0),t}return!0}}}();var Linetext=SL.Linetext;!function(){Linetext=SL.Linetext=function(e,t,i){function n(){var e,t=Utils.radian(a.rsPoint,a.rePoint)/(2*Math.PI)*360,i=$(a.txtElmt).width()+14,n=$(a.txtElmt).height()+14;e=t<=45&&t>-45?new Point(a.rePoint.x-i,a.rePoint.y-.5*n):t<=135&&t>45?new Point(a.rePoint.x-.5*i,a.rePoint.y-n):t<=-45&&t>-135?new Point(a.rePoint.x-.5*i,a.rePoint.y+7):new Point(a.rePoint.x+7,a.rePoint.y-.5*n),a.setCSS(e.x,e.y)}function o(t,i){if(t)Utils.replaceSizeSame(i.inpElmt,i.txtElmt),$(i.txtElmt).hide(),$(i.inpElmt).show(),$(i.inpElmt).select(),i.isSelected=!0;else{$(i.txtElmt).show();var n=$(i.inpElmt).val();i.description!==n&&e.dirtyCanvas(),$(i.txtElmt).html(Utils.replaceHtmlEnter(n)),$(i.inpElmt).hide(),i.description=n}a.imageIndex!==e.getCurrentIndex()&&($(i.txtElmt).hide(),$(i.inpElmt).hide())}Shape.apply(this,[e,t,i]);var a=this;this.draw=function(){var e=a.getContext();e.beginPath(),a.rsPoint=a.resetPoint(a.startPoint,a.cavScale,a.cavOffset),a.rePoint=a.resetPoint(a.endPoint,a.cavScale,a.cavOffset),a.shapeMovePosition(),a.movePoint=a.rsPoint.plus(a.rePoint).divide(2),e.moveTo(a.rsPoint.x,a.rsPoint.y),e.lineTo(a.rePoint.x,a.rePoint.y),e.lineWidth=a.width,e.strokeStyle=a.color,e.stroke(),n(),a.active()},this.shapeMovePosition=function(){if(a.activeMove!==ActiveMove.None){switch(a.activeMove){case ActiveMove.StartMove:a.resetActiveMovePoint(a.rsPoint,a.startPoint);break;case ActiveMove.EndMove:a.resetActiveMovePoint(a.rePoint,a.endPoint);break;case ActiveMove.ShapeMove:a.resetActiveMovePoint(a.rsPoint,a.startPoint),a.resetActiveMovePoint(a.rePoint,a.endPoint)}a.activeMove!==ActiveMove.ShapeMove&&(a.isMeasurementChanged=!0)}},this.calcMeasurementInfo=function(){var t=Utils.calcRadius(a.startPoint,a.endPoint);return Utils.appendLine(e.Measurement.Length,Utils.floatRound(t*a.calibration)+e.Measurement.Unit)},this.active=function(){!this.isEndDrawing&&this.isDrawStart||!this.isSelected||(a.drawThumb(a.rsPoint),a.drawThumb(a.rePoint),a.drawMoveThumb(a.movePoint))},this.isHitMe=function(e){if(a.isSelected){var t=[];a.addClickResult(t,e,a.rePoint,ActiveMove.EndMove),a.addClickResult(t,e,a.rsPoint,ActiveMove.StartMove),a.addClickResult(t,e,a.movePoint,ActiveMove.ShapeMove),a.setNearestMove(t)}return a.activeMove!==ActiveMove.None},this.isHitMyArea=function(e){if(a.activeMove===ActiveMove.None){var t=Utils.clickOnLine(a.rsPoint,a.rePoint,e,a.width),i=a.isHitMe(e);return a.isSelected=t||i,a.cavRect=new Rect(a.rsPoint.x,a.rsPoint.y,0,0),n(),t}return!0},this.createElmt=function(){var t=null;null===a.txtElmt&&(a.txtElmt=document.createElement("label"),a.container.appendChild(a.txtElmt),t=$(a.txtElmt),t.bind("mousedown",{owner:a},function(t){if(!e.isSelectedEnable)return!0;var i=t.data.owner;return e.setActiveShape(i),i.type===AnnotationType.Position?(i.isSelected=!0,e.showAnnotations()):o(!0,i),t.stopPropagation(),!1})),null===a.inpElmt&&(a.inpElmt=document.createElement("textarea"),a.container.appendChild(a.inpElmt),$(a.inpElmt).mousedown(function(e){e.stopPropagation()}))},this.setCSS=function(e,t){Utils.registerTxtCSS({elmt:a.txtElmt,left:e,top:t,fontSize:a.fontSize,fontFamily:a.fontFamily,color:a.color,fontBold:a.fontBold,fontItalic:a.fontItalic,fontUnderline:a.fontUnderLine,bkColor:!0,bkOpacity:!0,description:a.description}),Utils.registerTxtCSS({elmt:a.inpElmt,left:e,top:t,fontSize:a.fontSize,fontFamily:a.fontFamily,color:a.color,fontBold:a.fontBold,fontItalic:a.fontItalic,fontUnderline:a.fontUnderLine,bkColor:!0,bkOpacity:!1,description:a.description}),o(a.isSelected,a)},null!==e.getContainer()&&a.createElmt()}}();var Rectangle=SL.Rectangle;!function(){Rectangle=SL.Rectangle=function(e,t,i){Shape.apply(this,[e,t,i]);var n=this;this.leftTopPoint=null,this.leftBottomPoint=null,this.rightTopPoint=null,this.rightBottomPoint=null,this.topMiddlePoint=null,this.bottomMiddlePoint=null,this.leftMiddlePoint=null,this.rightMiddlePoint=null,this.draw=function(){var e=n.getContext();e.beginPath(),n.rsPoint=n.resetPoint(n.startPoint,n.cavScale,n.cavOffset),n.rePoint=n.resetPoint(n.endPoint,n.cavScale,n.cavOffset),n.shapeMovePosition();var t=0,i=0,o=Math.abs(n.rePoint.x-n.rsPoint.x),a=Math.abs(n.rePoint.y-n.rsPoint.y);n.rePoint.x>n.rsPoint.x&&n.rePoint.y>n.rsPoint.y?(t=n.rsPoint.x,i=n.rsPoint.y):n.rePoint.x>n.rsPoint.x&&n.rePoint.y<n.rsPoint.y?(t=n.rsPoint.x,i=n.rePoint.y):n.rePoint.x<n.rsPoint.x&&n.rePoint.y>n.rsPoint.y?(t=n.rePoint.x,i=n.rsPoint.y):n.rePoint.x<n.rsPoint.x&&n.rePoint.y<n.rsPoint.y&&(t=n.rePoint.x,i=n.rePoint.y),n.leftTopPoint=new Point(n.rsPoint.x,n.rsPoint.y),n.leftBottomPoint=new Point(n.rsPoint.x,n.rePoint.y),n.rightTopPoint=new Point(n.rePoint.x,n.rsPoint.y),n.rightBottomPoint=new Point(n.rePoint.x,n.rePoint.y),n.topMiddlePoint=new Point(t+o/2,n.rsPoint.y),n.bottomMiddlePoint=new Point(t+o/2,n.rePoint.y),n.leftMiddlePoint=new Point(n.rsPoint.x,i+a/2),n.rightMiddlePoint=new Point(n.rePoint.x,i+a/2),n.movePoint=n.rsPoint.plus(n.rePoint).divide(2),e.strokeStyle=n.color,e.lineWidth=n.width,e.strokeRect(t,i,o,a),e.stroke(),n.active(),n.showMeasurement()},this.calcMeasurementInfo=function(){var t=Math.abs(n.startPoint.x-n.endPoint.x),i=Math.abs(n.startPoint.y-n.endPoint.y),o="";return o=Utils.appendLine(o,e.Measurement.Width+Utils.floatRound(t*n.calibration)+e.Measurement.Unit),o=Utils.appendLine(o,e.Measurement.Height+Utils.floatRound(i*n.calibration)+e.Measurement.Unit),o=Utils.appendLine(o,e.Measurement.Area+Utils.floatRound(t*n.calibration*i*n.calibration)+e.Measurement.AreaUnit),o=Utils.appendLine(o,e.Measurement.Perimeter+Utils.floatRound(2*(t+i)*n.calibration)+e.Measurement.Unit)},this.active=function(){!n.isEndDrawing&&n.isDrawStart||!n.isSelected||(n.drawThumb(n.leftTopPoint),n.drawThumb(n.leftBottomPoint),n.drawThumb(n.rightTopPoint),n.drawThumb(n.rightBottomPoint),n.drawThumb(n.topMiddlePoint),n.drawThumb(n.bottomMiddlePoint),n.drawThumb(n.leftMiddlePoint),n.drawThumb(n.rightMiddlePoint),n.drawMoveThumb(n.movePoint))},this.shapeMovePosition=function(){if(null!==n.activeMove&&n.activeMove!==ActiveMove.None&&null!==n.moveOffset){var e=new Point(0,0);switch(n.activeMove){case ActiveMove.LeftTopMove:n.resetActiveMovePoint(n.rsPoint,n.startPoint);break;case ActiveMove.RightTopMove:e=new Point(0,n.moveOffset.y),n.resetActiveMovePoint(n.rsPoint,n.startPoint,e),e=new Point(n.moveOffset.x,0),n.resetActiveMovePoint(n.rePoint,n.endPoint,e);break;case ActiveMove.LeftBottomMove:e=new Point(n.moveOffset.x,0),n.resetActiveMovePoint(n.rsPoint,n.startPoint,e),e=new Point(0,n.moveOffset.y),n.resetActiveMovePoint(n.rePoint,n.endPoint,e);break;case ActiveMove.RightBottomMove:n.resetActiveMovePoint(n.rePoint,n.endPoint);break;case ActiveMove.TopMiddleMove:e=new Point(0,n.moveOffset.y),n.resetActiveMovePoint(n.rsPoint,n.startPoint,e);break;case ActiveMove.BottomMiddleMove:e=new Point(0,n.moveOffset.y),n.resetActiveMovePoint(n.rePoint,n.endPoint,e);break;case ActiveMove.LeftMiddleMove:e=new Point(this.moveOffset.x,0),n.resetActiveMovePoint(n.rsPoint,n.startPoint,e);break;case ActiveMove.RightMiddleMove:e=new Point(n.moveOffset.x,0),n.resetActiveMovePoint(n.rePoint,n.endPoint,e);break;case ActiveMove.ShapeMove:n.resetActiveMovePoint(n.rsPoint,n.startPoint),n.resetActiveMovePoint(n.rePoint,n.endPoint)}n.activeMove!==ActiveMove.ShapeMove&&(n.isMeasurementChanged=!0)}},this.getActiveMove=function(e){var t=[];n.addClickResult(t,e,n.leftTopPoint,ActiveMove.LeftTopMove),n.addClickResult(t,e,n.leftBottomPoint,ActiveMove.LeftBottomMove),n.addClickResult(t,e,n.rightTopPoint,ActiveMove.RightTopMove),n.addClickResult(t,e,n.rightBottomPoint,ActiveMove.RightBottomMove),n.addClickResult(t,e,n.topMiddlePoint,ActiveMove.TopMiddleMove),n.addClickResult(t,e,n.bottomMiddlePoint,ActiveMove.BottomMiddleMove),n.addClickResult(t,e,n.leftMiddlePoint,ActiveMove.LeftMiddleMove),n.addClickResult(t,e,n.rightMiddlePoint,ActiveMove.RightMiddleMove),n.addClickResult(t,e,n.movePoint,ActiveMove.ShapeMove),n.setNearestMove(t)},this.isHitMe=function(e){return!(!n.isSelected||(n.getActiveMove(e),n.activeMove===ActiveMove.None))}}}();var Angle=SL.Angle;!function(){Angle=SL.Angle=function(e,t,i){Shape.apply(this,[e,t,i]);var n=this;this.cavPoints=[],this.pIndex=0,this.draw=function(){var e=n.getContext();e.beginPath(),n.shapeMovePosition(),n.cavPoints=[];for(var t=0;t<n.points.length;t++){var i=n.resetPoint(n.points[t],n.cavScale,n.cavOffset);n.cavPoints.push(i)}if(n.isEndDrawing){var o=10,a=Utils.radian(n.cavPoints[0],n.cavPoints[1]),r=Utils.radian(n.cavPoints[2],n.cavPoints[1]);e.arc(n.cavPoints[1].x,n.cavPoints[1].y,o,a,r,!1),n.movePoint=n.cavPoints[0].plus(n.cavPoints[2]).divide(2)}for(var l=new Point,s=new Point,t=0;t<n.cavPoints.length;t++){var i=n.cavPoints[t];0==t?(e.moveTo(i.x,i.y),l=new Point(i.x,i.y),s=new Point(i.x,i.y)):(e.lineTo(i.x,i.y),l.x>i.x&&(l.x=i.x),l.y>i.y&&(l.y=i.y),s.x<i.x&&(s.x=i.x),s.y<i.y&&(s.y=i.y))}n.rsPoint=l,n.rePoint=s,e.lineWidth=n.width,e.strokeStyle=n.color,e.stroke(),n.active(),n.showMeasurement()},this.calcMeasurementInfo=function(){var t=Utils.angleDegree(this.cavPoints[0],this.cavPoints[1],this.cavPoints[2]);return Utils.appendLine(e.Measurement.Angle,Utils.floatRound(t)+e.Measurement.Deg)},this.active=function(){if(n.isSelected){for(var e=0;e<n.cavPoints.length;e++){var t=n.cavPoints[e];n.drawThumb(t)}this.drawMoveThumb(n.movePoint)}},this.shapeMovePosition=function(){if(null!==n.activeMove&&n.activeMove!==ActiveMove.None){switch(n.activeMove){case ActiveMove.PointMove:n.resetActiveMovePoint(n.cavPoints[n.pIndex],n.points[n.pIndex]);break;case ActiveMove.ShapeMove:for(var e=0;e<n.cavPoints.length;e++)n.resetActiveMovePoint(n.cavPoints[e],n.points[e])}n.activeMove!=ActiveMove.ShapeMove&&(n.isMeasurementChanged=!0)}},this.getActiveMove=function(e){for(var t=[],i=0;i<n.cavPoints.length;i++)n.addClickResult(t,e,n.cavPoints[i],ActiveMove.PointMove,i);n.addClickResult(t,e,n.movePoint,ActiveMove.ShapeMove),n.setNearestMove(t)},this.isHitMe=function(e){return n.isSelected&&n.getActiveMove(e),n.activeMove!==ActiveMove.None},this.drawStart=function(e){n.points.push(e)},this.drawMove=function(e){n.points.length>=0&&(n.points[n.points.length-1]=e)},this.drawClick=function(e){1==n.points.length&&n.drawThumb(n.toCanvasPoint(e)),n.points.length>=0&&(n.points[n.points.length-1]=e),n.points.length>=3?n.isEndDrawing=!0:n.points.push(e)},this.drawEnd=function(){}}}();var Arrow=SL.Arrow;!function(){Arrow=SL.Arrow=function(e,t,i){Line.apply(this,[e,t,i]);var n=this;this.draw=function(){var e=n.getContext();e.beginPath(),n.rsPoint=n.resetPoint(n.startPoint,n.cavScale,n.cavOffset),n.rePoint=n.resetPoint(n.endPoint,n.cavScale,n.cavOffset),n.shapeMovePosition(),n.movePoint=n.rsPoint.plus(n.rePoint).divide(2),e.moveTo(n.rsPoint.x,n.rsPoint.y),e.lineTo(n.rePoint.x,n.rePoint.y);var t,i,o=new Point(2*n.width,3*n.width);if(n.rsPoint.x===n.rePoint.x)n.rsPoint.y<n.rePoint.y?(t=new Point(n.rsPoint.x-o.x,n.rsPoint.y+o.y),i=new Point(n.rsPoint.x+o.x,n.rsPoint.y+o.y)):(t=new Point(n.rsPoint.x-o.x,n.rsPoint.y-o.y),i=new Point(n.rsPoint.x+o.x,n.rsPoint.y-o.y));else if(n.rsPoint.y===n.rePoint.y)n.rsPoint.x<n.rePoint.x?(t=new Point(n.rsPoint.x+o.y,n.rsPoint.y-o.x),i=new Point(n.rsPoint.x+o.y,n.rsPoint.y+o.y)):(t=new Point(n.rsPoint.x-o.y,n.rsPoint.y-o.x),i=new Point(n.rsPoint.x-o.y,n.rsPoint.y+o.x));else{var a=Math.atan2(n.rsPoint.y-n.rePoint.y,n.rsPoint.x-n.rePoint.x),r=Math.atan2(o.x,o.y),l=Math.sqrt(o.x*o.x+o.y*o.y);t=new Point(n.rsPoint.x-l*Math.cos(a+r),n.rsPoint.y-l*Math.sin(a+r)),i=new Point(n.rsPoint.x-l*Math.cos(a-r),n.rsPoint.y-l*Math.sin(a-r))}e.moveTo(t.x,t.y),e.lineTo(n.rsPoint.x,n.rsPoint.y),e.lineTo(i.x,i.y),e.lineWidth=n.width,e.strokeStyle=n.color,e.stroke(),n.active(),n.showMeasurement()}}}();var Brace=SL.Brace;!function(){Brace=SL.Brace=function(e,t,i){Line.apply(this,[e,t,i]);var n=this;this.draw=function(){var e=n.getContext();e.beginPath(),n.rsPoint=n.resetPoint(n.startPoint,n.cavScale,n.cavOffset),n.rePoint=n.resetPoint(n.endPoint,n.cavScale,n.cavOffset),n.shapeMovePosition(),n.movePoint=SlideUtils.calcTwoCenterPoint(n.rsPoint,n.rePoint);var t,i,o,a=10;t=Math.atan2(n.rsPoint.y-n.rePoint.y,n.rsPoint.x-n.rePoint.x),i=Math.cos(t),o=Math.sin(t);var r=new Point(n.rsPoint.x+a*i+a*o,n.rsPoint.y+a*o-a*i),l=new Point(n.rePoint.x+(-a*i+a*o),n.rePoint.y+(-a*i-a*o)),s=new Point((n.rsPoint.x+n.rePoint.x)/2,(n.rsPoint.y+n.rePoint.y)/2),d=new Point(s.x+a*i,s.y+a*o),u=new Point(s.x-a*i,s.y-a*o),c=new Point(s.x-a*o,s.y+a*i);e.moveTo(r.x,r.y),e.lineTo(n.rsPoint.x,n.rsPoint.y),e.lineTo(d.x,d.y),e.lineTo(c.x,c.y),e.lineTo(u.x,u.y),e.lineTo(n.rePoint.x,n.rePoint.y),e.lineTo(l.x,l.y),e.lineWidth=n.width,e.strokeStyle=n.color,e.stroke(),n.active(),n.showMeasurement()}}}();var Ellipse=SL.Ellipse;!function(){Ellipse=SL.Ellipse=function(e,t,i){function n(e,t,i,n,o){var a=.5522848,r=n/2*a,l=o/2*a,s=t+n,d=i+o,u=t+n/2,c=i+o/2;e.beginPath(),e.moveTo(t,c),e.bezierCurveTo(t,c-l,u-r,i,u,i),e.bezierCurveTo(u+r,i,s,c-l,s,c),e.bezierCurveTo(s,c+l,u+r,d,u,d),e.bezierCurveTo(u-r,d,t,c+l,t,c),e.stroke()}Rectangle.apply(this,[e,t,i]);var o=this;this.draw=function(){var e=o.getContext();o.rsPoint=o.resetPoint(o.startPoint,o.cavScale,o.cavOffset),o.rePoint=o.resetPoint(o.endPoint,o.cavScale,o.cavOffset),o.shapeMovePosition();var t=0,i=0,a=Math.abs(o.rePoint.x-o.rsPoint.x),r=Math.abs(o.rePoint.y-o.rsPoint.y);o.rePoint.x>o.rsPoint.x&&o.rePoint.y>o.rsPoint.y?(t=o.rsPoint.x,i=o.rsPoint.y):o.rePoint.x>o.rsPoint.x&&o.rePoint.y<o.rsPoint.y?(t=o.rsPoint.x,i=o.rePoint.y):o.rePoint.x<o.rsPoint.x&&o.rePoint.y>o.rsPoint.y?(t=o.rePoint.x,i=o.rsPoint.y):o.rePoint.x<o.rsPoint.x&&o.rePoint.y<o.rsPoint.y&&(t=o.rePoint.x,i=o.rePoint.y),o.leftTopPoint=new Point(o.rsPoint.x,o.rsPoint.y),o.leftBottomPoint=new Point(o.rsPoint.x,o.rePoint.y),o.rightTopPoint=new Point(o.rePoint.x,o.rsPoint.y),o.rightBottomPoint=new Point(o.rePoint.x,o.rePoint.y),o.topMiddlePoint=new Point(t+a/2,o.rsPoint.y),o.bottomMiddlePoint=new Point(t+a/2,o.rePoint.y),o.leftMiddlePoint=new Point(o.rsPoint.x,i+r/2),o.rightMiddlePoint=new Point(o.rePoint.x,i+r/2),o.movePoint=o.rsPoint.plus(o.rePoint).divide(2),e.lineWidth=o.width,e.strokeStyle=o.color,n(e,t,i,a,r),o.active(),o.showMeasurement()},this.calcMeasurementInfo=function(){var t,i,n=Math.abs(o.startPoint.x-o.endPoint.x),a=Math.abs(o.startPoint.y-o.endPoint.y),r=n/2*o.calibration,l=a/2*o.calibration,s=Math.abs(r-l)/(r+l);s*=s,t=isNaN(s)?0:Math.PI*(r+l)*(135168-85760*s-5568*s*s+3868*s*s*s)/(135168-119552*s+22208*s*s-345*s*s*s),i=Math.abs(Math.PI*n*this.calibration*a*this.calibration/4);var d="";return d=Utils.appendLine(d,e.Measurement.Majorhalfaxis+Utils.floatRound(Math.max(r,l))+e.Measurement.Unit),d=Utils.appendLine(d,e.Measurement.Minorhalfaxis+Utils.floatRound(Math.min(r,l))+e.Measurement.Unit),d=Utils.appendLine(d,e.Measurement.Area+Utils.floatRound(i)+e.Measurement.AreaUnit),d=Utils.appendLine(d,e.Measurement.Perimeter+Utils.floatRound(t)+e.Measurement.Unit)},this.isHitMe=function(e){return o.isSelected&&o.getActiveMove(e),o.activeMove!==ActiveMove.None}}}();var Polygon=SL.Polygon;!function(){Polygon=SL.Polygon=function(e,t,i){Angle.apply(this,[e,t,i]);var n=this;this.draw=function(){var e=n.getContext();e.beginPath(),n.shapeMovePosition(),n.cavPoints=[];for(var t=new Point,i=new Point,o=0;o<n.points.length;o++){var a=n.resetPoint(n.points[o],n.cavScale,n.cavOffset);n.cavPoints.push(a),0==o?(e.moveTo(a.x,a.y),n.rsPoint=a.times(1),t=a.times(1),i=a.times(1)):(e.lineTo(a.x,a.y),t.x>a.x&&(t.x=a.x),t.y>a.y&&(t.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y))}n.isEndDrawing&&n.points.length>2&&(e.lineTo(n.rsPoint.x,n.rsPoint.y),n.movePoint=t.plus(i).divide(2),n.rsPoint=t,n.rePoint=i),e.lineWidth=n.width,e.strokeStyle=n.color,e.stroke(),n.active(),n.showMeasurement()},this.calcMeasurementInfo=function(){var t="",i=Utils.calcArea(n.points)*n.calibration*n.calibration,o=Utils.calcLengthClosed(n.points)*n.calibration;return t=Utils.appendLine(t,e.Measurement.Area+Utils.floatRound(i)+e.Measurement.AreaUnit),t=Utils.appendLine(t,e.Measurement.Perimeter+Utils.floatRound(o)+e.Measurement.Unit)},this.drawMove=function(e){n.points.length>=0&&(n.points[n.points.length-1]=e)},this.drawClick=function(e){n.points.push(e)},this.drawEnd=function(){for(var e=0,t=n.points.length-1;t>0&&(Utils.floatRound(n.points[t].x)===Utils.floatRound(n.points[t-1].x)&&Utils.floatRound(n.points[t].y)===Utils.floatRound(n.points[t-1].y));t--)e=t;null!=e&&n.points.splice(e,n.points.length-e)}}}();var Polyline=SL.Polyline;!function(){Polyline=SL.Polyline=function(e,t,i){Angle.apply(this,[e,t,i]);var n=this;this.draw=function(){var e=n.getContext();e.beginPath(),n.shapeMovePosition(),n.cavPoints=[];for(var t,i,o=0;o<n.points.length;o++){var a=n.resetPoint(n.points[o],n.cavScale,n.cavOffset);n.cavPoints.push(a),0==o?(e.moveTo(a.x,a.y),n.rsPoint=a,t=new Point(a.x,a.y),i=new Point(a.x,a.y)):(e.lineTo(a.x,a.y),t.x>a.x&&(t.x=a.x),t.y>a.y&&(t.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y))}n.isEndDrawing&&n.points.length>1&&(n.movePoint=new Point((t.x+i.x)/2,(t.y+i.y)/2),n.rsPoint=t,n.rePoint=i),e.lineWidth=n.width,e.strokeStyle=n.color,e.stroke(),n.active(),n.showMeasurement()},this.calcMeasurementInfo=function(){var t="",i=Utils.calcArea(n.points)*n.calibration*n.calibration,o=Utils.calcLengthClosed(n.points)*n.calibration;return t=Utils.appendLine(t,e.Measurement.Area+Utils.floatRound(i)+e.Measurement.AreaUnit),t=Utils.appendLine(t,e.Measurement.Perimeter+Utils.floatRound(o)+e.Measurement.Unit)},this.drawMove=function(e){n.points.length>=0&&(n.points[n.points.length-1]=e)},this.drawClick=function(e){this.points.push(e)},this.drawEnd=function(){for(var e,t=n.points.length-1;t>0&&(SL.Utils.floatRound(n.points[t].x)==SL.Utils.floatRound(n.points[t-1].x)&&SL.Utils.floatRound(n.points[t].y)==SL.Utils.floatRound(n.points[t-1].y));t--)e=t;null!=e&&n.points.splice(e,n.points.length-e)}}}();var Remark=SL.Remark;!function(){Remark=SL.Remark=function(e,t,i){function n(t,i){if(t)Utils.replaceSize(i.inpElmt,i.txtElmt),$(i.txtElmt).hide(),$(i.inpElmt).show(),$(i.inpElmt).select(),i.isSelected=!0,i.active();else{$(i.txtElmt).show();var n=$(i.inpElmt).val();i.description!==n&&e.dirtyCanvas(),$(i.txtElmt).html(Utils.replaceHtmlEnter(n)),$(i.inpElmt).hide(),i.description=n}o.imageIndex!==e.getCurrentIndex()&&($(i.txtElmt).hide(),$(i.inpElmt).hide())}Shape.apply(this,[e,t,i]);var o=this;this.draw=function(){o.rsPoint=o.resetPoint(o.startPoint,o.cavScale,o.cavOffset),o.rePoint=o.resetPoint(o.endPoint,o.cavScale,o.cavOffset),o.setCSS(o.rsPoint.x,o.rsPoint.y),o.shapeMovePosition()},this.active=function(){o.isSelected&&(o.movePoint=o.rsPoint.plus(new Point(parseInt(o.inpElmt.style.width),parseInt(o.inpElmt.style.height))).divide(2),o.drawMoveThumb(o.rsPoint))},this.isHitMe=function(e){if(o.isSelected){var t=[];if(o.addClickResult(t,e,o.rsPoint,ActiveMove.ShapeMove),o.setNearestMove(t),o.activeMove===ActiveMove.ShapeMove)return!0}return!1},this.isHitMyArea=function(e){return o.isSelected=o.isHitMe(e),o.isSelected},this.shapeMovePosition=function(){null!==o.activeMove&&o.activeMove!==ActiveMove.None&&o.activeMove===ActiveMove.ShapeMove&&(o.resetActiveMovePoint(o.rsPoint,o.startPoint),o.resetActiveMovePoint(o.rePoint,o.endPoint))},this.drawStart=function(){},this.drawClick=function(){this.isEndDrawing=!0},this.createElmt=function(){var t=null;null===o.txtElmt&&(o.txtElmt=document.createElement("label"),o.container.appendChild(o.txtElmt),t=$(o.txtElmt),t.bind("mousedown",{owner:o},function(t){if(!e.isSelectedEnable)return!0;var i=t.data.owner;return e.setActiveShape(i),i.type===AnnotationType.Position?(i.isSelected=!0,e.showAnnotations()):n(!0,i),t.stopPropagation(),!1}),t.hide()),null===o.inpElmt&&(o.inpElmt=document.createElement("textarea"),o.container.appendChild(o.inpElmt),$(o.inpElmt).mousedown(function(e){e.stopPropagation()}).hide())},this.setCSS=function(e,t){Utils.registerTxtCSS({elmt:o.txtElmt,left:e,top:t,fontSize:o.fontSize,fontFamily:o.fontFamily,color:o.color,fontBold:o.fontBold,fontItalic:o.fontItalic,fontUnderline:o.fontUnderLine,bkColor:!0,bkOpacity:!0,description:o.description}),Utils.registerTxtCSS({elmt:o.inpElmt,left:e,top:t,fontSize:o.fontSize,fontFamily:o.fontFamily,color:o.color,fontBold:o.fontBold,fontItalic:o.fontItalic,fontUnderline:o.fontUnderLine,bkColor:!0,bkOpacity:!1,description:o.description}),n(o.isSelected,o)},null!==e.getContainer()&&o.createElmt()}}();var Provider=SL.Provider;!function(){Provider=SL.Provider=function(e){function t(e,t,i){if(!e)return n("Open Slide error and errMsg: Request data fail!");var o=new AjxResult,a=new SlideInfo;if(o.resultCode=e.resultCode,o.Info=e.Info,"success"===t&&r)if(o.resultCode===ResultType.Success){var l=o.Info;a.id=l.id,a.name=l.name,a.url=l.url,a.description=l.description,a.calibration=l.calibration,a.width=l.width,a.height=l.height,a.number=l.number,a.hasAnnotations=l.hasAnnotations,a.annotations=l.annotations,a.tileSize=256,a.scanObjective=l.scanObjective,r(a,ResultType.Success)}else o.resultCode===ResultType.NoImage?(r(a,ResultType.NoImage),n("Open Slide error and errMsg: No Image!")):o.resultCode===ResultType.NoPermission?(r(a,o.resultCode),n("Open Slide error and errMsg: No Permission!")):r(a,o.resultCode)}function i(e,t,i){Config.debugMode?SlideDebug.log("Open Slide error: \n  status: "+t+"\n  errMsg: "+i.message):SlideDebug.error("Open Slide error!",i),alert("Open Slide error!")}function n(e){Config.debugMode?SlideDebug.log(e):SlideDebug.error(e)}SlideExtend(!0,this,{localhost:"",slideUrl:"",getAnnoUrl:"",updateAnnoUrl:"",getPermissionUrl:""},e);var o=this,a=null,r=null;this.openSlide=function(e,n){a="number"==typeof e||"number"==typeof parseInt(e)?e:null,r="function"==typeof n?n:null;var l=""!==o.localhost?o.localhost+o.slideUrl:o.slideUrl;$.ajax({type:"GET",dataType:"json",async:!0,cache:!1,url:l,data:{slideId:a},success:t,error:i})},this.getPermission=function(e){if(null!==a&&"function"==typeof e){var t=""!==o.localhost?o.localhost+o.getPermissionUrl:o.getPermissionUrl;$.ajax({type:"GET",dataType:"json",async:!0,cache:!1,url:t+"?slideId="+a,success:function(t,i,o){if(!t)return n("Get Permission error and errMsg: Request data fail!");var a=new AjxResult;if(a.resultCode=t.resultCode,a.Info=t.Info,"success"===i)if(a.resultCode===ResultType.Success){var r=a.Info;("true"===r||"boolean"==typeof r&&r===!0)&&e(!0,a.resultCode)}else a.resultCode===ResultType.NoPermission?(e(!1,a.resultCode),n("Get Permission error and errMsg: No Permission!")):(e(!1,ResultType.Failed),n("Get Permission !"))},error:function(e,t,i){Config.debugMode?SlideDebug.log("Get Permission error: \n  status: "+t+"\n  errMsg: "+i.message):SlideDebug.error("Get Permission error!",i)}})}},this.getAnnotations=function(e){if("function"==typeof e){var t=""!==o.localhost?o.localhost+o.getAnnoUrl:o.getAnnoUrl;$.ajax({type:"GET",dataType:"json",async:!0,cache:!1,url:t+"?slideId="+a,success:function(t,i,o){if(!t)return n("Get annotations finished, But return status code is NULL!");var a=new AjxResult;return a.resultCode=t.resultCode,a.Info=t.Info?t.Info:[],"success"===i&&a.Info.length>0?void(ResultType.Success===a.resultCode?e(a.Info,ResultType.Success):ResultType.NoPermission===a.resultCode?(e(a.Info,ResultType.NoPermission),n("No Permission Get annotations!")):(e(a.Info,ResultType.Failed),n("Get annotations Failed!"))):void(Config.debugMode&&SlideDebug.log("Get annotations array length is zero!"))},error:function(e,t,i){Config.debugMode?SlideDebug.log("Get annotations error: \n  status: "+t+"\n  errMsg: "+i.message):SlideDebug.error("Get annotations error!",i)}})}},this.updateAnnotations=function(e,t,i){if(t&&"function"==typeof i){var a=""!==o.localhost?o.localhost+o.updateAnnoUrl:o.updateAnnoUrl;t=t.length>0?t:[],$.ajax({type:"POST",dataType:"json",async:!0,cache:!1,url:a,data:{slideId:e.id,annotations:t},success:function(e,t,o){if(!e)return n("Update annotations finished, But return status code is NULL!");var a=new AjxResult;a.resultCode=e.resultCode,
a.Info=e.Info,"success"===t&&(ResultType.Success===a.resultCode?i(ResultType.Success):ResultType.NoPermission===a.resultCode?(i(ResultType.NoPermission),n("No Permission Update annotations!")):(i(ResultType.Failed),n("Update annotations Failed!")))},error:function(e,t,i){Config.debugMode?SlideDebug.log("Update annotations error: \n  status: "+t+"\n  errMsg: "+i.message):SlideDebug.error("Update annotations error!",i)}})}}}}();var Source=SL.Source;!function(){Source=SL.Source=function(e,t,i,n,o,a,r,l){Slide.Source.apply(this,[i,n,l]),t=""!==e?e+"/"+t:t,this.getSlideUrl=function(e){return[t,"/",e,"?deviceId=",a,"&priority=",r,"&sign=",o].join("")}}}();var TileSource=SL.TileSource;!function(){TileSource=SL.TileSource=function(e,t,i,n,o,a,r,l,s,d){SlideSource.apply(this,[i,n,o,a,d]),t=""!==e?e+"/"+t:t,this.getTileUrl=function(e,i,n){return[t,"/0","/",e,"/",i,"-",n,"?deviceId=",l,"&priority=",s,"&sign=",r].join("")}}}();var Support=SL.Support;!function(){if(!Support){$.extend($.support,{orientation:"orientation"in window&&"onorientationchange"in window,touch:"ontouchend"in document}),Support=SL.Support={imageAdjustment:!1,canvas:!1,isAndroid:!1};var e=Slide.Utils.getBrowser(),t=navigator.userAgent.toLowerCase(),i=!!document.createElement("canvas").getContext;Support.canvas=i,i&&e!==Slide.Browser.IE&&e!==Slide.Browser.UNKNOWN&&(Support.imageAdjustment=!0),Support.isAndroid=t.indexOf("android")>-1}}();var Button=SL.Button;!function(){Button=SL.Button=function(e){function t(e){e=Utils.getEvent(e),null!==r.mouseDown&&"function"==typeof r.mouseDown&&r.mouseDown(e,r.data)}function i(e){e=Utils.getEvent(e),null!==r.mouseUp&&"function"==typeof r.mouseUp&&r.mouseUp(e,r.data)}function n(e){e=Utils.getEvent(e),null!==r.mouseEnter&&"function"==typeof r.mouseEnter&&r.mouseEnter(e,r.data)}function o(e){e=Utils.getEvent(e),null!==r.mouseLeave&&"function"==typeof r.mouseLeave&&r.mouseLeave(e,r.data)}function a(e){e=Utils.getEvent(e),null!==r.mouseClk&&"function"==typeof r.mouseClk&&r.mouseClk(e,r.data)}Extend(!0,this,{name:"",text:"",title:"",data:null,mouseDown:null,mouseUp:null,mouseEnter:null,mouseLeave:null,mouseClk:null},e);var r=this,l=!1;this.elmt=document.createElement("a"),function(){r.data={_this:r,data:r.data};var e=r.elmt,l=document.createElement("span"),s=document.createElement("span");e.title=r.title,s.innerHTML=r.text,Dom.addClass(e,"sp-btn"),Dom.addClass(l,"icon "+r.name),Dom.addClass(s,"text"),e.appendChild(l),void 0!==r.text&&null!==r.text&&""!==r.text&&e.appendChild(s),Utils.addEvent(e,"mouseover",n,!1),Utils.addEvent(e,"mouseout",o,!1),Utils.addEvent(e,"mousedown",t,!1),Utils.addEvent(e,"mouseup",i,!1),Utils.addEvent(e,"click",a,!1)}(),this.hide=function(){Dom.hide(r.elmt)},this.show=function(){Dom.show(r.elmt)},this.setSelected=function(e){"boolean"==typeof e&&e===!0?(l=!0,Dom.addClass(r.elmt,"sp-btn-selected")):(l=!1,Dom.removeClass(r.elmt,"sp-btn-selected"))},this.isSelected=function(){return l}}}();var LabelTxt=SL.LabelTxt;!function(){LabelTxt=SL.LabelTxt=function(e){Extend(!0,this,{name:"",text:"",title:"",width:0,data:null},e);var t=this;this.elmt=document.createElement("span"),function(){Dom.addClass(t.elmt,"sp-label"),Dom.addClass(t.elmt,t.name),t.title=t.title,t.elmt.innerHTML=t.text,0!==t.width&&(t.elmt.style.width=t.width)}(),this.hide=function(){Dom.hide(t.elmt)},this.show=function(){Dom.show(t.elmt)},this.setText=function(e){t.elmt.innerHTML=e},this.addItem=function(e){Dom.isDOM(e)&&t.elmt.appendChild(e)}}}();var Toolstrip=SL.Toolstrip;!function(){Toolstrip=SL.Toolstrip=function(e){var t=this,i=[];this.elmt=document.createElement("div"),function(){Dom.addClass(t.elmt,"sp-toolstrip "+e)}(),this.addItem=function(e){Dom.isDOM(e)&&(t.elmt.appendChild(e),i.push(e))},this.hide=function(){Dom.hide(t.elmt)},this.show=function(){Dom.show(t.elmt)}}}();var Toolbar=SL.Toolbar;!function(){Toolbar=SL.Toolbar=function(e){var t=this;this.elmt=document.createElement("div"),function(){Dom.addClass(t.elmt,"sp-"+e)}(),this.show=function(){t.elmt.visibility="visible"},this.hide=function(){t.elmt.visibility="hidden"},this.addToolstrip=function(e){Dom.isDOM(e)&&t.elmt.appendChild(e)}}}();var DialogEdit=SL.DialogEdit;!function(){DialogEdit=SL.DialogEdit=function(e){function t(){o=null!=e.shapeCanvas?e.shapeCanvas:null,a=null!=o?o.getActiveShape():null,$("[data-lang]",n.$dlg).html(function(){return Strings.getString($(this).attr("data-lang"))}),n.$dlg.appendTo($("body")).dialog({autoOpen:!0,resizable:!1,modal:!0,minWidth:320,minHeight:500,width:320,height:500,zIndex:1e4,dialogClass:"editClass",draggable:Config.dialogDraggable,title:Strings.getString("Dialog.Edit.Title"),open:function(e,t){$("#"+c,n.$dlg).farbtastic("#"+u),r=$.farbtastic("#"+c),$("#"+h,n.$dlg).attr("checked",Config.autoShowAnnoDialog),a&&($("#"+l,n.$dlg).val(a.width),$("#"+s,n.$dlg).val(a.name),$("#"+d,n.$dlg).val(a.description),r.setColor(a.color))},close:function(e,t){o=null,a=null,r=null,n.$dlg.remove()},buttons:[{text:Strings.getString("Dialog.Buttons.Ok"),click:function(){i(),$(this).dialog("close")}},{text:Strings.getString("Dialog.Buttons.Cancel"),click:function(){$(this).dialog("close")}}]})}function i(){var t=e.shapeCanvas.ShapeConfig;t.defaultColor=$("#"+u,n.$dlg).val(),t.lineWidth=$("#"+l,n.$dlg).val(),Config.autoShowAnnoDialog="checked"===$("#"+h,n.$dlg).attr("checked"),null!=o&&("Remark"!==a.type&&"Linetext"!==a.type||(a.fontSize=5*t.lineWidth),a.width=t.lineWidth,a.color=t.defaultColor,a.name=$("#"+s,n.$dlg).val(),a.description=$("#"+d,n.$dlg).val(),a.isMeasurementChanged=!0,o.dirtyCanvas(),o.showAnnotations())}var n=this,o=null,a=null,r=null,l="lineWidth-"+(new Date).getTime(),s="annoName-"+(new Date).getTime(),d="annoDesc-"+(new Date).getTime(),u="color-"+(new Date).getTime(),c="colorpicker-"+(new Date).getTime(),h="chkAutoShow-"+(new Date).getTime(),f='<div data-role="dialog" data-overlay-theme="e" title="Edit Annotation" class="ui-dialog-topright"><div data-role="content" data-theme="c"><div data-role="fieldcontain"><label for="'+l+'" class="ui-item-label" data-lang="Dialog.Edit.LineWidth">Line Width:</label><select id="'+l+'" class="ui-item-field" ><option value="1">1</option><option value="2">2</option><option value="5" selected="selected">5</option><option value="10">10</option><option value="20">20</option></select></div><div data-role="fieldcontain"><label for="'+s+'" class="ui-item-label" data-lang="Dialog.Edit.Name">Name:</label><input type="text" id="'+s+'" class="ui-item-field" /></div><div data-role="fieldcontain"><label for="'+d+'" class="ui-item-label" data-lang="Dialog.Edit.Description">Description:</label><textarea id="'+d+'" class="ui-item-field" rows="2"></textarea></div><div data-role="fieldcontain"><label for="'+u+'" class="ui-item-label" data-lang="Dialog.Edit.Color">Color:</label><input type="text" id="'+u+'" value="#0d29e7" class="ui-item-field"/><div id="'+c+'"></div></div><div data-role="fieldcontain"><input type="checkbox" id="'+h+'"/><label for="'+h+'" data-inline="true" data-lang="Dialog.Buttons.AutoShow">Show Automatically</label></div></div></div>';this.$dlg=$(f),this.show=function(){t()}}}();var AnnoToolbar=SL.AnnoToolbar;!function(){AnnoToolbar=SL.AnnoToolbar=function(e){function t(t,i){for(var n=0;n<btnAry.length;n++)btnAry[n].setSelected(!1);var o=i._this;if(o.setSelected(!o.isSelected()),o.isSelected()&&(btnFinish.hide(),null!=e.shapeCanvas)){var a=i.data.type;switch(a){case"hand":e.shapeCanvas.setSelectedEnable(!1);break;case"select":e.shapeCanvas.setSelectedEnable(!0);break;default:a==AnnotationType.Polygon&&btnFinish.show(),e.shapeCanvas.setDrawType(a)}}}function i(){null!=e.shapeCanvas&&e.shapeCanvas.finishDrawing()}function n(){e.saveAnnotations()}function o(){e.isOpen()&&null!=e.shapeCanvas&&e.shapeCanvas.isSelectedEnable&&null!==e.shapeCanvas.getActiveShape()&&new DialogEdit(e).show()}function a(){null!==e&&e.deleteAnnotation()}function r(){s.onBack&&"function"==typeof s.onBack&&s.onBack()}var l,s=this,d=new Toolbar("annotation");btnSvEnalbe=!0,btnAry=[],btnFinish=null,btnSave=null,btnEdit=null,btnDelete=null,btnBk=null,this.elmt=d.elmt,function(){l=new DialogEdit(e);var s=new Toolstrip("left");d.addToolstrip(s.elmt);var u=new LabelTxt({name:"标注类型",text:"&nbsp;"+Strings.getString("Labels.AnnotationType")+"&nbsp;"});s.addItem(u.elmt);var c=new LabelTxt;s.addItem(c.elmt);var h=new Button({name:"hand",title:Strings.getString("Buttons.AnnoToolbar.BtnHand"),data:{type:"hand"},mouseClk:t});c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"select",title:Strings.getString("Buttons.AnnoToolbar.BtnSelect"),data:{type:"select"},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"line",title:Strings.getString("Buttons.AnnoToolbar.BtnLine"),data:{type:AnnotationType.Line},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"arrow",title:Strings.getString("Buttons.AnnoToolbar.BtnArrow"),data:{type:AnnotationType.Arrow},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"brace",title:Strings.getString("Buttons.AnnoToolbar.BtnBrace"),data:{type:AnnotationType.Brace},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"rect",title:Strings.getString("Buttons.AnnoToolbar.BtnRect"),data:{type:AnnotationType.Rectangle},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"ellipse",title:Strings.getString("Buttons.AnnoToolbar.BtnEllipse"),data:{type:AnnotationType.Ellipse},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"polygon",title:Strings.getString("Buttons.AnnoToolbar.BtnPolygon"),data:{type:AnnotationType.Polygon},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"polyline",title:Strings.getString("Buttons.AnnoToolbar.BtnPolyline"),data:{type:AnnotationType.Polyline},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"remark",title:Strings.getString("Buttons.AnnoToolbar.BtnPosition"),data:{type:AnnotationType.Remark},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h),h=new Button({name:"linetext",title:Strings.getString("Buttons.AnnoToolbar.BtnLinetext"),data:{type:AnnotationType.Linetext},mouseClk:t}),c.addItem(h.elmt),btnAry.push(h);var f=new Toolstrip("right");d.addToolstrip(f.elmt),btnBk=new Button({name:"back-to-main",title:Strings.getString("Buttons.AnnoToolbar.BtnBack"),mouseClk:r}),f.addItem(btnBk.elmt),btnDelete=new Button({name:"delete",title:Strings.getString("Buttons.AnnoToolbar.BtnDelete"),mouseClk:a}),f.addItem(btnDelete.elmt),btnEdit=new Button({name:"edit",title:Strings.getString("Buttons.AnnoToolbar.BtnEdit"),mouseClk:o}),f.addItem(btnEdit.elmt),btnSave=new Button({name:"save",title:Strings.getString("Buttons.AnnoToolbar.BtnSave"),mouseClk:n}),btnSave.hide(),btnSvEnalbe=!1,f.addItem(btnSave.elmt),btnFinish=new Button({name:"finish",title:Strings.getString("Buttons.AnnoToolbar.BtnFinish"),mouseClk:i}),btnFinish.hide(),f.addItem(btnFinish.elmt)}(),this.onBack=null,this.hide=function(){Dom.hide(s.elmt)},this.show=function(){Dom.show(s.elmt)},this.resetAnnoBtns=function(){for(var e=0;e<btnAry.length;e++)btnAry[e].setSelected(!1);btnFinish.hide()},this.setSaveBtn=function(e){"boolean"==typeof e&&e===!0?(btnSave.show(),btnSvEnalbe=!0):(btnSave.hide(),btnSvEnalbe=!1)},this.isSvBtnEnable=function(){return btnSvEnalbe},this.resetBtnStatus=function(){for(var e=0;e<btnAry.length;e++)btnAry[e].setSelected(!1)},this.showAnnotationDialog=function(){l&&l.show()}}}();var MainToolbar=SL.MainToolbar;!function(){MainToolbar=SL.MainToolbar=function(e){function t(){e&&(e.isFullPage()?e.setFullPage(!1):e.setFullPage(!0))}function i(){window.history.back(-1)}function n(){e.isOpen()&&e.viewport&&e.viewport.goHome()}function o(t,i){e&&e.zoomToObj(i.data.times)}function a(){if(e.isOpen()){var t="flip-compact-"+(new Date).getTime(),i="flip-ruler-"+(new Date).getTime(),n="flip-grid-"+(new Date).getTime(),o=$('<div title="Options" data-role="dialog"><div data-role="fieldcontain" class="option-item"><label for="'+t+'" class="option-item-label" data-lang="Dialog.Options.Compact">Compact:</label><div id="'+t+'" class="option-item-radio"><input type="radio" id="'+t+'-on" name="compact" value="on"/><label for="'+t+'-on" data-lang="Dialog.Options.On">On</label><input type="radio" id="'+t+'-off" name="compact" value="off" /><label for="'+t+'-off" data-lang="Dialog.Options.Off">Off</label></div></div><div data-role="fieldcontain" class="option-item" data-show="canvas"><label for="'+i+'" class="option-item-label" data-lang="Dialog.Options.Ruler">Ruler:</label><div id="'+i+'" class="option-item-radio"><input type="radio" id="'+i+'-on" name="ruler" value="on" /><label for="'+i+'-on" data-lang="Dialog.Options.On">On</label><input type="radio" id="'+i+'-off" name="ruler" value="off" /><label for="'+i+'-off" data-lang="Dialog.Options.Off">Off</label></div></div><div data-role="fieldcontain" class="option-item" data-show="canvas"><label for="'+n+'" class="option-item-label" data-lang="Dialog.Options.Grid">Grid:</label><div id="'+n+'" class="option-item-radio"><input type="radio" id="'+n+'-on" name="grid" value="on" /><label for="'+n+'-on" data-lang="Dialog.Options.On">On</label><input type="radio" id="'+n+'-off" name="grid" value="off" /><label for="'+n+'-off" data-lang="Dialog.Options.Off">Off</label></div></div></div>');$("[data-lang]",o).html(function(){return Strings.getString($(this).attr("data-lang"))}),$(".option-item-radio",o).buttonset(),Support.canvas||$("[data-show='canvas']",o).hide(),o.appendTo($("body")).dialog({autoOpen:!0,resizable:!1,modal:!0,draggable:Config.dialogDraggable,title:Strings.getString("Dialog.Options.Title"),open:function(e,a){Config.compactBrowsing()?$("#"+t+"-on",o).attr("checked","checked").button("refresh"):$("#"+t+"-off",o).attr("checked","checked").button("refresh"),Config.showRulers()?$("#"+i+"-on",o).attr("checked","checked").button("refresh"):$("#"+i+"-off",o).attr("checked","checked").button("refresh"),Config.showGrid()?$("#"+n+"-on",o).attr("checked","checked").button("refresh"):$("#"+n+"-off",o).attr("checked","checked").button("refresh")},close:function(e,t){o.remove()},buttons:[{text:Strings.getString("Dialog.Buttons.Ok"),click:function(){var a="checked"===$("#"+t+"-on",o).attr("checked");Config.compactBrowsing(a),a="checked"===$("#"+i+"-on",o).attr("checked"),Config.showRulers(a),a="checked"===$("#"+n+"-on",o).attr("checked"),Config.showGrid(a),e.update(),$(this).dialog("close")}},{text:Strings.getString("Dialog.Buttons.Cancel"),click:function(){$(this).dialog("close")}}]})}}function r(){if(e.isOpen()&&e.viewport){var t=Math.pow(Slide.Config.zoomPerScroll,1);e.viewport.zoomBy(t),e.viewport.applyConstraints()}}function l(){if(e.isOpen()&&e.viewport){var t=Math.pow(Slide.Config.zoomPerScroll,-1);e.viewport.zoomBy(t),e.viewport.applyConstraints()}}function s(){if(e.getShapeCanvas().setSelectedEnable(!0),Support.canvas)if(Config.compactBrowsing()){var t=$('<div data-role="dialog" class="ui-dialog-topright"><div data-role="content" data-theme="c" data-mini="true"><p>'+Strings.getString("Dialog.Compact.Message")+"</p></div></div>");t.appendTo($("body")).dialog({autoOpen:!0,resizable:!1,modal:!0,draggable:Config.dialogDraggable,title:Strings.getString("Dialog.Compact.Title"),close:function(e,i){t.remove()},buttons:[{text:Strings.getString("Dialog.Buttons.Ok"),click:function(){$(this).dialog("close")}}]})}else h.onShowAnnoToolbar&&"function"==typeof h.onShowAnnoToolbar&&h.onShowAnnoToolbar();else{var t=$('<div data-role="dialog" class="ui-dialog-topright"><div data-role="content" data-theme="c" data-mini="true"><p>'+Strings.getString("Dialog.NotSupported.Message")+"</p></div></div>");t.appendTo($("body")).dialog({autoOpen:!0,resizable:!1,modal:!0,draggable:Config.dialogDraggable,title:Strings.getString("Dialog.NotSupported.Title"),close:function(e,i){t.remove()},buttons:[{text:Strings.getString("Dialog.Buttons.Ok"),click:function(){$(this).dialog("close")}}]})}}function d(){var t=e.getCurrentSL();t&&(k.elmt.innerHTML="",k.elmt.innerHTML=t.name),t&&c(t.scanObjective),h.setArcAndZoomCnt()}function u(){h.setArcAndZoomCnt()}function c(e){for(var t=0;t<g.length;t++)g[t]>e?v[t].hide():v[t].show()}var h=this,f=new Toolbar("main"),p=Utils.getElementSize(e.containerId),g=[4,10,20,40,100],v=[],m=650,S=6,y=40,w=70,x=2,P=null,b=null,M=null,T=null,C=null,A=null,E=null,U=null,k=null,L=null,O=null,R=null,B=null;this.elmt=f.elmt,function(){var c=p.x-y*S;if(P=new Toolstrip("left"),f.addToolstrip(P.elmt),C=new Button({name:"back",title:Strings.getString("Buttons.MainToolbar.BtnBack"),mouseClk:i}),T=new Button({name:"fullScreen",title:Strings.getString("Buttons.MainToolbar.BtnFullScreen"),mouseClk:t}),P.addItem(T.elmt),A=new Button({name:"home",title:Strings.getString("Buttons.MainToolbar.BtnHome"),mouseClk:n}),P.addItem(A.elmt),B=new Button({name:"options",title:Strings.getString("Buttons.MainToolbar.Options"),mouseClk:a}),P.addItem(B.elmt),B.hide(),!e.isMulti)for(var h=0;h<g.length;h++)E=new Button({name:"times-"+g[h].toString()+"x",title:g[h].toString()+Strings.getString("Buttons.MainToolbar.times"),mouseClk:o,data:{times:g[h]}}),v.push(E),P.addItem(E.elmt);Config.showOption||B.hide(),b=new Toolstrip("center"),b.elmt.style.width=c+"px",f.addToolstrip(b.elmt),k=new LabelTxt({name:"name",text:"",width:c-w+"px"}),b.addItem(k.elmt),L=new LabelTxt({name:"zoomCount",text:"",width:w+"px"}),b.addItem(L.elmt),M=new Toolstrip("right"),f.addToolstrip(M.elmt),U=new Button({name:"zoomIn",title:Strings.getString("Buttons.MainToolbar.ZoomIn"),mouseClk:r}),M.addItem(U.elmt),O=new Button({name:"zoomOut",title:Strings.getString("Buttons.MainToolbar.ZoomOut"),mouseClk:l}),M.addItem(O.elmt),R=new Button({name:"annotation",title:Strings.getString("Buttons.MainToolbar.Annotation"),mouseClk:s}),M.addItem(R.elmt),e.isOpen()&&(d(),u()),e.addEventListener("open",d),e.addEventListener("animation",u)}(),this.onShowAnnoToolbar=null,this.resize=function(){p=Utils.getElementSize(e.containerId),p.x<m?(P.hide(),M.hide(),b.elmt.style.width=p.x+"px",k.elmt.style.width=p.x-w+"px"):(P.show(),M.show(),b.elmt.style.width=p.x-y*S-x+"px",k.elmt.style.width=p.x-y*S-w+"px")},this.hide=function(){Dom.hide(h.elmt)},this.show=function(){Dom.show(h.elmt)},this.setArcAndZoomCnt=function(){if(e.isOpen()){var t=(e.getScale(),e.getIndex()),i=e.getCurrentSL(),n=(i.scanObjective*e.getScaleP()).toFixed(2);L.elmt.style.fontSize="13px",L.elmt.innerHTML="",L.elmt.innerHTML=parseInt(t/i.number*360)+"° - "+n+"x"}}}}();var ViewToolbar=SL.ViewToolbar;!function(){ViewToolbar=SL.ViewToolbar=function(e,t){function i(){var t=Utils.getElementSize(e.containerId);t.x<650?(n.annotation.hide(),n.main.show(),n.main.resize()):n.main.resize()}var n=this,o=!0;this.elmt=Utils.getElement(t),this.main=null,this.annotation=null,function(){n.main=new MainToolbar(e),n.annotation=new AnnoToolbar(e),n.main.onShowAnnoToolbar=function(){n.main.hide(),n.annotation.show()},n.annotation.onBack=function(){n.main.show(),n.annotation.hide()},Dom.addClass(n.elmt,"sp-toolbar"),n.elmt.appendChild(n.main.elmt),n.elmt.appendChild(n.annotation.elmt),n.main.resize(),n.annotation.hide(),e.addEventListener("resize",i)}(),this.hide=function(){o=!1,Dom.hide(n.elmt)},this.show=function(){o=!0,Dom.show(n.elmt)},this.isShow=function(){return o},this.resize=function(){i()},this.resetToolbar=function(){n.annotation&&n.main&&o===!0&&(n.annotation.resetBtnStatus(),n.main.show(),n.annotation.hide())}}}();var NavigationView=SL.NavigationView;!function(){NavigationView=SL.NavigationView=function(e,t,i){function n(){$("#Thumbnail").remove(),T=document.createElement("div"),T.id="Thumbnail",T.style.width=t+L,T.style.height=i+L,T.style.top=E+L,T.style.left=A+L,Support.canvas?(b=document.createElement("canvas"),b.id="cavView",b.width=t,b.height=i,T.appendChild(b),M=new Image,M.src=e,M.onload=function(){w.refresh(),w.imgLoaded=!0}):(P=document.createElement("img"),P.id="imgView",P.src=e,P.alt="",T.appendChild(P)),p=document.createElement("div"),p.id="hLine",p.style.top=i/2+L,p.style.width=t+L,T.appendChild(p),g=document.createElement("div"),g.id="vLine",g.style.left=t/2+L,g.style.height=i+L,T.appendChild(g),C=document.createElement("div"),C.id="viewRect",C.style.top=(i-50)/2+L,C.style.left=(t-50)/2+L;var n=$(C);$.support.touch?(n.bind("touchstart",o),n.bind("touchmove",a),n.bind("touchend",r),$(T).bind("touchstart",l)):(n.mousedown(s),n.mouseup(u),n.mouseleave(c),$(T).mousedown(h)),T.appendChild(C)}function o(e){e.stopPropagation(),x=!0;var t=e.originalEvent;t.preventDefault(),v=t.targetTouches[0].pageX,m=t.targetTouches[0].pageY}function a(e){e.stopPropagation();var t=e.originalEvent;if(t.preventDefault(),x&&1==t.targetTouches.length){var i=v-t.targetTouches[0].pageX,n=m-t.targetTouches[0].pageY;if(v=t.targetTouches[0].pageX,m=t.targetTouches[0].pageY,C.style.top=parseFloat(C.style.top)-n+L,C.style.left=parseFloat(C.style.left)-i+L,p.style.top=parseFloat(p.style.top)-n+L,g.style.left=parseFloat(g.style.left)-i+L,w.onUserMove){var o=parseFloat(C.style.left)+parseFloat(C.clientWidth)/2,a=parseFloat(C.style.top)+parseFloat(C.clientHeight)/2,r=o/(parseFloat(C.style.width)*S),l=a/(parseFloat(C.style.width)*S);w.onUserMove(r,l)}}}function r(e){e.stopPropagation();var t=e.originalEvent;t.preventDefault(),x=!1}function l(e){var t=e.originalEvent;if(t.preventDefault(),v=t.targetTouches[0].pageX,m=t.targetTouches[0].pageY,p.style.top=parseFloat(m-k-O)+L,g.style.left=parseFloat(v-U-O)+L,C.style.top=parseFloat(m-k-parseFloat(C.style.height)/2-O)+L,C.style.left=parseFloat(v-U-parseFloat(C.style.height)/2-O)+L,w.onUserMove){var i=parseFloat(C.style.left)+parseFloat(C.style.width)/2,n=parseFloat(C.style.top)+parseFloat(C.style.height)/2,o=i/(parseFloat(C.style.width)*S),a=n/(parseFloat(C.style.width)*S);w.onUserMove(o,a)}return e.stopPropagation(),!1}function s(e){return e.stopPropagation(),x=!0,v=e.pageX,m=e.pageY,$(C).mousemove(d),!1}function d(e){if(e.stopPropagation(),x){var t=e.pageX,i=e.pageY,n=t-v,o=i-m;if(v=t,m=i,0==n&&0==o)return!1;if(C.style.top=parseFloat(C.style.top)+o+L,C.style.left=parseFloat(C.style.left)+n+L,p.style.top=parseFloat(p.style.top)+o+L,g.style.left=parseFloat(g.style.left)+n+L,w.onUserMove){var a=parseFloat(C.style.left)+parseFloat(C.style.width)/2,r=parseFloat(C.style.top)+parseFloat(C.style.height)/2,l=a/(parseFloat(C.style.width)*S),s=r/(parseFloat(C.style.width)*S);w.onUserMove(l,s)}}}function u(){return x=!1,$(C).mousemove(null),!1}function c(){return x=!1,!1}function h(e){if(v=e.pageX,m=e.pageY,p.style.top=parseFloat(m-k-O)+L,g.style.left=parseFloat(v-U-O)+L,C.style.top=parseFloat(m-k-parseFloat(C.style.height)/2-O)+L,C.style.left=parseFloat(v-U-parseFloat(C.style.width)/2-O)+L,w.onUserMove){var t=parseFloat(C.style.left)+parseFloat(C.style.width)/2,i=parseFloat(C.style.top)+parseFloat(C.style.height)/2,n=t/(parseFloat(C.style.width)*S),o=i/(parseFloat(C.style.width)*S);w.onUserMove(n,o)}return e.stopPropagation(),!1}function f(){$(T).css({position:"relative","z-index":"0",overflow:"hidden",border:"1px solid #319DCE"}),$(b).css({"z-index":"0",position:"absolute"}),$(P).css({"z-index":"0"}),$(p).css({height:"1px","line-height":"1px",position:"absolute",left:"0px","background-color":"#FF0000","z-index":"0"}),$(g).css({width:"1px","line-height":"1px",position:"absolute",top:"0px","background-color":"#FF0000","z-index":"0"}),$(C).css({border:"1px solid #FF0000","background-color":"#FFFFFF",position:"absolute",width:"50px",height:"50px",cursor:"pointer","z-index":"0",top:"0px",left:"0px",filter:"alpha(opacity=50)",opacity:"0.5"})}var p,g,v,m,S,y,w=this,x=!1,P=null,b=null,M=null,T=null,C=null,A=25,E=25,U=0,k=0,L="px",O=1;!function(){n(),f(),w.elmt=T}(),this.imgLoaded=!1,this.onUserMove,this.isOnDragging=function(){return x},this.setVisibility=function(e){e?$(T).show():$(T).hide()},this.refresh=function(){var e=b.getContext("2d");e.clearRect(0,0,t,i),e.drawImage(M,0,0,t,i)},this.getCanvas=function(){return b},this.UpdateViewRect=function(e,i,n,o){if(S=e,y=o,!x){var a=t/S,r=a/o,l=t*i,s=t*n;C.style.width=a+L,C.style.height=r+L,C.style.top=s+L,C.style.left=l+L,p.style.top=r/2+s+L,g.style.left=a/2+l+L}},this.UpdateThumbnailOrigin=function(e,t){U=e,k=t}}}();var Viewer=SL.Viewer;!function(){Viewer=SL.Viewer=function(e,t,i){function n(){$.support.touch,M=m.viewport.getZoom(!0),T=m.viewport.getSlide(!0),o(),a(),i.isMulti?m.setSwitchSlide(!0):(m.setSwitchSlide(!1),r(),l()),i.openCb&&i.openCb(m)}function o(){m.provider?m.provider.getPermission(function(e,t){ResultType.Success===t&&(w=e,w===!0&&y.annotation.setSaveBtn(w))}):y.annotation.setSaveBtn(m.isSave)}function a(){m.shapeCanvas||(m.shapeCanvas=new ShapeCanvas(m),m.shapeCanvas.createShapeCanvas(),m.shapeCanvas.onShapeDrawEnd=function(){y.annotation.resetAnnoBtns(),Config.autoShowAnnoDialog&&y.annotation.showAnnotationDialog()},m.shapeCanvas.onShapeChanged=function(){w&&y.annotation.setSaveBtn(!0)},m.shapeCanvas.setOpenSlide(S),Config.enableAnnotation&&!S.hasAnnotations?(m.shapeCanvas.clearShapeAry(),i.autoLoadAnnos===!0&&m.provider.getAnnotations(function(e,t){ResultType.Success===t&&m.loadAnnotations(e),S.hasAnnotations=!0})):m.shapeCanvas.loadAnnotations(S.annotations))}function r(){if(S){var e=200,t=200;S.width>S.height?t=Math.floor(e*S.height/S.width):e=Math.floor(t*S.width/S.height);var n=i.thumbnailUrl;null==n&&(n="/getThumbnail"),C=new NavigationView(n,e,t),C.onUserMove=function(e,t){m.viewport&&m.viewport.panTo(new Point(e,t))},C.setVisibility(i.isNavmap),m.addControl(C.elmt,SlideControlAnchor.TOP_LEFT),d()}}function l(){A=m.shapeCanvas.showRuler(),A.setVisibility(),m.addControl(A.elmt,SlideControlAnchor.BOTTOM_RIGHT),d(),m.shapeCanvas.showAnnotations(!0),A.setRatioText()}function s(){i.resizeCallback&&"function"==typeof i.resizeCallback&&i.resizeCallback()}function d(){if(m.viewport){var e=m.viewport.getZoom(!0),t=m.viewport.getContainerSize(),i=m.viewport.getBounds(),n=m.viewport.getAspectRatio();v=t.x*e/S.width,m.trigger("viewportchanged",{viewportWidth:e,containerSize:t,bounds:i,aspectRatio:n,scale:v}),M=(v*S.scanObjective).toFixed(2),T=m.viewport.getSlide(!0)}if(C){C.UpdateViewRect(m.viewport.getZoom(),i.x,i.y,n);var o=Utils.getElementPosition(C.elmt);C.isOnDragging()||C.UpdateThumbnailOrigin(o.x,o.y)}}function u(e){var t=e.originalEvent;if(x=new Point(t.targetTouches[0].clientX,t.targetTouches[0].clientY),m.viewport&&2==t.targetTouches.length){M=m.viewport.getZoom(!0);var i=new Point(t.targetTouches[0].clientX,t.targetTouches[0].clientY),n=new Point(t.targetTouches[1].clientX,t.targetTouches[1].clientY);P=Utils.calcTwoPointDistance(i,n)}}function c(e){var t=e.originalEvent;t.preventDefault();var i=new Point(t.targetTouches[0].clientX,t.targetTouches[0].clientY),n=x.minus(i);if(x=i.times(1),m.viewport&&1===t.targetTouches.length)if(m.isSwitchSlide()){if(b)return;b=window.setTimeout(function(){b=null;var e=-(n.x?n.x/Math.abs(n.x):0),t=m.viewport.getSlide()+e;t<0&&(t+=S.number),t>=S.number&&(t-=S.number),m.viewport.slideTo(t,!0),m.viewport.applyConstraints()},Slide.Config.drawSwitchPerTime)}else{var o=m.viewport.deltaPointsFromPixels(n,!0);m.viewport.panBy(o)}if(m.viewport&&2===t.targetTouches.length){var a=new Point(t.targetTouches[0].clientX,t.targetTouches[0].clientY),r=new Point(t.targetTouches[1].clientX,t.targetTouches[1].clientY),l=Utils.calcTwoPointDistance(a,r),s=l-P;if(Math.abs(s)<20){var o=m.viewport.deltaPointsFromPixels(n,!0);m.viewport.panBy(o)}else{var d=l/P,u=M*d;m.viewport.getMinZoom()<u&&u<m.viewport.getMaxZoom()&&m.viewport.zoomTo(u)}}}function h(e){}function f(e){m.viewport&&(M=m.viewport.getZoom(!0))}function p(e){var t=e.originalEvent;if(t.preventDefault(),e.scale<1.1){var i=m.viewport.deltaPointsFromPixels(offset,!0);m.viewport.panBy(i)}}function g(e,t){m.provider&&(m.provider.localhost=i.localhost,m.provider.slideUrl=i.slideUrl,m.provider.getAnnoUrl=i.getAnnoUrl,m.provider.updateAnnoUrl=i.updateAnnoUrl,m.provider.getPermissionUrl=i.getPermissionUrl,m.provider.openSlide(e,function(e,n){ResultType.Success===n&&(S=e,i.isMulti?m.openSource(new Source(i.localhost,S.url,S.width,S.height,S.sign,S.deviceId,S.priority,S.number)):m.openSource(new TileSource(i.localhost,S.url,S.width,S.height,S.number,S.tileSize,S.sign,S.deviceId,S.priority,0)),"function"==typeof t&&t(S))}))}SlideViewer.apply(this,[e]);var v,m=this,S=null,y=null,w=!1,x=null,P=0,b=null,M=0,T=0,C=null,A=null;this.containerId=e,this.shapeCanvas=null,i.creatPv&&(this.provider=new Provider),this.isMobile=i.isMobile,this.isMulti=i.isMulti,this.isSave=i.isSave,function(){m.addEventListener("open",n),m.addEventListener("resize",s),m.addEventListener("animation",d),$.support.touch?$("#"+e).bind({touchstart:u,touchmove:c,touchend:h,gesturestart:f,gesturechange:p}):!m.isMobile&&i.toolbarEnable&&(y=new ViewToolbar(m,t))}(),this.getDevice=function(){return m.isMobile},this.getShapeCanvas=function(){return m.shapeCanvas},this.getCanSave=function(){return(2&w)>0},this.showMessage=function(e,t){null==t&&(t=1500);var i,n,o,a=$("<div class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h1 style='font-size: 2em'>"+e+"</h1></div>");a.appendTo("body"),i=null==m.viewport?new Slide.Point($(window).width(),$(window).height()):m.viewport.getContainerSize(),o=(i.x-a.width())/2+"px",n=(i.y-a.height())/2+"px",a.css({top:n,left:o,filter:"alpha(opacity=90)",opacity:"0.9",position:"absolute",display:"block","padding-left":"12px","padding-right":"12px"}),a.delay(t).fadeOut(400,function(){$(this).remove()})},this.transAnnotations=function(e){var t=m.shapeCanvas.transAnnotations(e);return t},this.openSL=function(e,t){"number"==typeof e?g(e,t):e instanceof SlideInfo?(S=e,i.isMulti?m.openSource(new Source(i.localhost,S.url,S.width,S.height,S.sign,S.deviceId,S.priority,S.number)):m.openSource(new TileSource(i.localhost,S.url,S.width,S.height,S.number,S.tileSize,S.sign,S.deviceId,S.priority,0)),"function"==typeof t&&t(S)):SlideDebug.error("Open slide failed: id is not current!")},this.closeSL=function(e){m.close(),m.shapeCanvas.clearShapeAry(),m.shapeCanvas=null,y&&y.resetToolbar(),e&&"function"==typeof e&&e()},this.getCurrentSL=function(){return S},this.getScale=function(){return M},this.getScaleP=function(){return v},this.getIndex=function(){return T},this.getCenter=function(){if(m.isOpen())return m.viewport.getCenter()},this.isShapeChanged=function(){return!!m.shapeCanvas&&m.shapeCanvas.isShapeChanged},this.update=function(){null!==m.shapeCanvas&&(m.shapeCanvas.clearShapeCanvas(!0),m.shapeCanvas.showAnnotations(!0),C&&C.refresh())},this.saveAnnotations=function(e){i.autoSaveAnnosBySaveBtn?w===!0&&null!==m.provider&&m.shapeCanvas.getAnnotations(function(t){m.provider.updateAnnotations(S,t,function(n){ResultType.Success===n?alert(Strings.getString("Messages.SaveAnnotationSuccess")):alert(Strings.getString("Messages.SaveAnnotationFailed")),Config.enableAnnotation&&!S.hasAnnotations?(m.shapeCanvas.clearShapeAry(),i.autoLoadAnnos===!0&&m.provider.getAnnotations(function(e,t){ResultType.Success===t&&m.loadAnnotations(e)})):m.shapeCanvas.loadAnnotations(S.annotations),e&&"function"==typeof e&&e(t),i.saveAnnosCallback&&"function"==typeof i.saveAnnosCallback&&i.saveAnnosCallback(t)})}):m.shapeCanvas.getAnnotations(function(e){function t(e,t){S.annotations=t,e?m.showMessage(Strings.getString("Messages.SaveAnnotationSuccess")):m.showMessage(Strings.getString("Messages.SaveAnnotationFailed"))}i.saveAnnosCallback&&"function"==typeof i.saveAnnosCallback&&i.saveAnnosCallback(e,t)})},this.getAnnotations=function(e){return"function"==typeof e?m.shapeCanvas.getAnnotations(function(t){e(t)}):[]},this.loadAnnotations=function(e){e&&(m.shapeCanvas.loadAnnotations(e),i.loadAnnosCallback&&"function"==typeof i.loadAnnosCallback&&i.loadAnnosCallback(e))},this.reloadAnnotations=function(){m.shapeCanvas.reloadAnnotations()},this.clearShapeCanvas=function(){m.shapeCanvas.clearShapeAry()},this.deleteAnnotation=function(){null!=m.shapeCanvas&&m.shapeCanvas.deleteAnnotation(i.delAnnoCallback)},this.linkTo=function(e){m.shapeCanvas.linkTo(e)},this.resize=function(e){y.resize()},this.setTbEnabled=function(t){
var i=$("#"+e);y&&(t?(i.css({height:i.height()-30}),y.show()):(i.css({height:"100%"}),y.hide()))},this.isTbEnabled=function(){return!!y&&y.isShow()},this.setMsAndThEnable=function(e){m.setMouseNavEnabled(e)},this.isMsAndThEnable=function(){return m.isMouseNavEnabled()},this.setSvBtnEnable=function(e){i.autoSaveAnnosBySaveBtn?"boolean"==typeof e&&e===!0?w&&y.annotation.setSaveBtn(e):y.annotation.setSaveBtn(!1):y.annotation.setSaveBtn(e)},this.isSvBtnEnable=function(){return y.annotation.isSvBtnEnable()},this.fullPage=function(e){this.isOpen()&&this.viewport&&this.setFullPage(!!e)},this.goHome=function(){this.isOpen()&&this.viewport&&this.viewport.goHome()},this.zoomToObj=function(e){var t=m.viewport.getContainerSize(),i=e/S.scanObjective*S.width/t.x;m.viewport.zoomTo(i)}}}();var CreatViewer=SL.CreateViewer;!function(){CreatViewer=SL.CreateViewer=function(e){function t(){$(l).height($(a).height()-30),s&&"function"==typeof s.isTbEnabled&&!s.isTbEnabled()&&$(l).height($(l).height()+30)}function i(e){return!1}function n(e){if(o.exitConfirm&&s.isShapeChanged()&&s.isSvBtnEnable())return e=e||window.event,e.returnValue=Strings.getString("Messages.ExitConfirm"),Strings.getString("Messages.ExitConfirm")}var o=Extend(!0,{},{creatPv:!0,isMulti:!0,containerId:"",imageId:null,toolbarEnable:!0,isSave:!1,localhost:"",slideUrl:"/GetSlide",getAnnoUrl:"/GetAnnotations",updateAnnoUrl:"/UpdateAnnotations",getPermissionUrl:"/GetPermission",openCb:null,resizeCallback:null,autoLoadAnnos:!1,loadAnnosCallback:null,autoSaveAnnosBySaveBtn:!0,saveAnnosCallback:null,delAnnoCallback:null,language:"auto",debugMode:!0,enableAnnotation:!0,autoShowAnnoDialog:!1,isNavmap:!0,thumbnailUrl:"/getThumbnail",isMobile:!1,showOption:!0,exitConfirm:!0},e),a=document.getElementById(o.containerId)||document.body,r=document.createElement("div"),l=document.createElement("div");r.id=o.containerId+"_toolbar",l.id=o.containerId+"_viewer",a.appendChild(r),a.appendChild(l),Config.language=o.language,Config.debugMode=o.debugMode,Config.enableAnnotation=o.enableAnnotation,Config.autoShowAnnoDialog=o.autoShowAnnoDialog,Config.showOption=o.showOption,$(a).bind({contextmenu:i,dragstart:i,beforecopy:i,selectstart:i});var s=new Viewer(l.id,r.id,o);return null!==o.imageId&&s.openSL(o.imageId),$(window).resize(t).on("beforeunload",n),t(),s}}();
//# sourceMappingURL=slidePathology.min.js.map
